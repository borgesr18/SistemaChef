(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{24694:function(e,r,t){Promise.resolve().then(t.bind(t,91381))},91381:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return c}});var a=t(3827),o=t(64090),s=t(32278),n=t(66651),l=t(93242),i=t(14570);function c(){let{usuarioAtual:e,alterarSenha:r,editarUsuario:t}=(0,i.G)(),[c,u]=(0,o.useState)({nome:"",email:"",role:"viewer"}),[d,m]=(0,o.useState)({senha:"",confirmar:""}),[h,f]=(0,o.useState)(""),[g,p]=(0,o.useState)("");return((0,o.useEffect)(()=>{e&&u({nome:e.nome,email:e.email,role:e.role})},[e]),(0,o.useEffect)(()=>{if(!g)return;let e=setTimeout(()=>p(""),3e3);return()=>clearTimeout(e)},[g]),e)?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(l.Z,{message:g,onClose:()=>p("")}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Perfil"}),(0,a.jsxs)("form",{onSubmit:r=>{r.preventDefault(),t(e.id,c)?(p("Perfil atualizado"),f("")):f("Email j\xe1 cadastrado")},className:"space-y-4 max-w-sm",children:[(0,a.jsx)(s.Z,{label:"Nome",value:c.nome,onChange:e=>u({...c,nome:e.target.value}),required:!0,className:"h-[38px]"}),(0,a.jsx)(s.Z,{label:"Email",type:"email",value:c.email,onChange:e=>u({...c,email:e.target.value}),required:!0,className:"h-[38px]"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Perfil"}),(0,a.jsxs)("select",{value:c.role,onChange:e=>u({...c,role:e.target.value}),className:"border border-[var(--cor-borda)] rounded-md p-2 w-full h-[38px] text-sm",children:[(0,a.jsx)("option",{value:"viewer",children:"Visualizador"}),(0,a.jsx)("option",{value:"editor",children:"Editor"}),(0,a.jsx)("option",{value:"manager",children:"Gerente"}),(0,a.jsx)("option",{value:"admin",children:"Administrador"})]})]}),h&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:h}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(n.Z,{type:"submit",variant:"primary",children:"Salvar Perfil"})})]}),(0,a.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),d.senha!==d.confirmar){f("Senhas n\xe3o conferem");return}r(e.id,d.senha),m({senha:"",confirmar:""}),f(""),p("Senha alterada")},className:"space-y-4 max-w-sm",children:[(0,a.jsx)(s.Z,{label:"Nova Senha",type:"password",value:d.senha,onChange:e=>m({...d,senha:e.target.value}),required:!0,className:"h-[38px]"}),(0,a.jsx)(s.Z,{label:"Confirmar Senha",type:"password",value:d.confirmar,onChange:e=>m({...d,confirmar:e.target.value}),required:!0,className:"h-[38px]"}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(n.Z,{type:"submit",variant:"primary",children:"Alterar Senha"})})]})]}):(0,a.jsx)("p",{className:"p-4",children:"Nenhum usu\xe1rio logado."})}},66651:function(e,r,t){"use strict";var a=t(3827);t(64090),r.Z=e=>{let{children:r,variant:t="primary",size:o="md",isLoading:s=!1,fullWidth:n=!1,className:l="",disabled:i,...c}=e,u=i||s?"opacity-50 cursor-not-allowed":"";return(0,a.jsxs)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-[var(--cor-acao)] text-white hover:brightness-90 focus:ring-[var(--cor-acao)]",secondary:"bg-[var(--cor-secundaria)] text-white hover:brightness-90 focus:ring-[var(--cor-secundaria)]",success:"bg-[var(--cor-sucesso)] text-white hover:brightness-90 focus:ring-[var(--cor-sucesso)]",danger:"bg-[var(--cor-erro)] text-white hover:brightness-90 focus:ring-[var(--cor-erro)]",outline:"bg-white text-[var(--cor-texto-principal)] border border-[var(--cor-borda)] hover:bg-gray-50 focus:ring-[var(--cor-acao)]"}[t]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[o]," ").concat(n?"w-full":""," ").concat(u," ").concat(l),disabled:i||s,...c,children:[s&&(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r]})}},32278:function(e,r,t){"use strict";var a=t(3827);let o=(0,t(64090).forwardRef)((e,r)=>{let{label:t,error:o,helperText:s,className:n="",...l}=e;return(0,a.jsxs)("div",{className:"mb-4",children:[t&&(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--cor-texto-principal)"},children:t}),(0,a.jsx)("input",{ref:r,className:"w-full input ".concat(o?"border-[var(--cor-erro)]":""," ").concat(n),...l}),o&&(0,a.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-erro)"},children:o}),s&&!o&&(0,a.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-texto-secundario)"},children:s})]})});o.displayName="Input",r.Z=o},93242:function(e,r,t){"use strict";var a=t(3827),o=t(64090);r.Z=e=>{let{message:r,onClose:t}=e;return((0,o.useEffect)(()=>{if(!r)return;let e=setTimeout(t,3e3);return()=>clearTimeout(e)},[r,t]),r)?(0,a.jsx)("div",{className:"fixed top-4 right-4 bg-[var(--cor-sucesso)] text-white px-4 py-2 rounded shadow",children:r}):null}},32355:function(e,r,t){"use strict";t.d(r,{g:function(){return o}});let a=()=>localStorage.getItem("auth_token"),o=()=>{let e=a();return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}},14570:function(e,r,t){"use strict";t.d(r,{G:function(){return l}});var a=t(64090),o=t(32355);let s=async()=>{try{console.log("\uD83D\uDCE1 Fazendo chamada para /api/auth/users...");let e=await fetch("/api/auth/users",{headers:(0,o.g)()});if(console.log("\uD83D\uDCE1 Response status: ".concat(e.status)),!e.ok){let r=await e.text();throw console.error("❌ Erro na API users: ".concat(e.status," - ").concat(r)),Error("Erro ao buscar usu\xe1rios: ".concat(e.status))}let r=await e.json();return console.log("✅ Usu\xe1rios da API: ".concat(r.length)),r.map(e=>({role:"viewer",...e}))}catch(e){return console.error("❌ Erro ao buscar usu\xe1rios da API:",e),[]}},n=e=>e.filter(e=>!e.oculto),l=()=>{let[e,r]=(0,a.useState)([]),[t,l]=(0,a.useState)(null),[i,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{c(!0),console.log("\uD83D\uDD0D Carregando usu\xe1rios...");let e=localStorage.getItem("auth_token"),t=localStorage.getItem("user_data");if(console.log("\uD83D\uDD10 Auth state:",{tokenExists:!!e,userDataExists:!!t}),e&&t&&"undefined"!==t){let e=JSON.parse(t);if(console.log("✅ Usu\xe1rio atual carregado:",e.email),l(e),"admin"===e.role){let e=await s();console.log("✅ Usu\xe1rios carregados:",(null==e?void 0:e.length)||0),r(e)}else console.log("\uD83D\uDC64 User is not admin, skipping users list"),r([])}else console.log("⚠️ No valid auth token or user data found"),l(null),r([])}catch(e){console.error("❌ Erro ao carregar usu\xe1rios:",e),r([]),l(null)}finally{c(!1)}})()},[]);let u=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{6,}$/.test(e),d=async t=>{if(e.some(e=>e.email===t.email)||!u(t.senha))return null;try{let a=await fetch("/api/auth/register",{method:"POST",headers:(0,o.g)(),body:JSON.stringify(t)}),s=await a.json();if(!a.ok)return console.error("Erro no registro:",s),null;let n=[...e,s];return r(n),s}catch(e){return console.error("Erro ao registrar usu\xe1rio:",e),null}},m=()=>{l(null),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")},h=async e=>{try{if(!(await fetch("/api/auth/users/".concat(e),{method:"DELETE",headers:(0,o.g)()})).ok)throw Error("Erro ao deletar usu\xe1rio");let a=await s();return r(n(a)),(null==t?void 0:t.id)===e&&m(),!0}catch(e){return console.error("Erro ao remover usu\xe1rio:",e),!1}},f=async(e,a)=>{try{if(!(await fetch("/api/auth/users/".concat(e,"/password"),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify({novaSenha:a})})).ok)throw Error("Erro ao alterar senha");let i=await s();if(r(n(i)),(null==t?void 0:t.id)===e){let r=i.find(r=>r.id===e)||null;l(r)}return!0}catch(e){return console.error("Erro ao alterar senha:",e),!1}},g=async(e,a)=>{try{if((await s()).some(r=>r.email===a.email&&r.id!==e))return!1;if(!(await fetch("/api/auth/users/".concat(e),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify(a)})).ok)throw Error("Erro ao editar usu\xe1rio");let i=await s();if(r(n(i)),(null==t?void 0:t.id)===e){let r=i.find(r=>r.id===e)||null;l(r),localStorage.setItem("user_data",JSON.stringify(r))}return!0}catch(e){return console.error("Erro ao editar usu\xe1rio:",e),!1}};return{usuarios:e,usuarioAtual:t,isLoading:i,registrarUsuario:d,login:async(e,t)=>{try{let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,senha:t})});if(!a.ok)return null;let{user:o,token:i}=await a.json();l(o),localStorage.setItem("auth_token",i),localStorage.setItem("user_data",JSON.stringify(o));let c=await s();if(!c.find(e=>e.id===o.id)){let e=[...c,o];r(n(e))}return o}catch(e){return null}},logout:m,removerUsuario:h,alterarSenha:f,editarUsuario:g}}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=24694)}),_N_E=e.O()}]);
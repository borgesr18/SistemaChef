(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[266],{50225:function(e,r,a){Promise.resolve().then(a.bind(a,47172))},47172:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return h}});var t=a(3827),o=a(64090),n=a(57418),s=a(20200),c=a(66651),l=a(32278),i=a(79173),d=a(70492),u=a(93242),m=a(29130),x=a(27742),p=a(16297);function h(){var e;let{movimentacoes:r,isLoading:a,registrarEntrada:h,registrarSaida:f,atualizarMovimentacao:v,removerMovimentacao:g}=(0,m.H)(),{produtos:b}=(0,x.Ug)(),{fichasTecnicas:y}=(0,p.vG)(),[j,w]=(0,o.useState)({tipo:"entrada",produtoId:"",quantidade:"",preco:"",fornecedor:"",marca:""}),[N,C]=(0,o.useState)({}),[E,S]=(0,o.useState)(null),[k,q]=(0,o.useState)(""),[I,Z]=(0,o.useState)(null),{isOpen:P,openModal:M,closeModal:D}=(0,d.d)();(0,o.useEffect)(()=>{if(!k)return;let e=setTimeout(()=>q(""),3e3);return()=>clearTimeout(e)},[k]);let O=e=>{let{name:r,value:a}=e.target;w(e=>({...e,[r]:a}))},T=()=>{let e={};return j.produtoId||(e.produtoId="Produto \xe9 obrigat\xf3rio"),(!j.quantidade||isNaN(Number(j.quantidade)))&&(e.quantidade="Qtd inv\xe1lida"),"entrada"!==j.tipo||((!j.preco||isNaN(Number(j.preco.replace(",","."))))&&(e.preco="Pre\xe7o inv\xe1lido"),j.fornecedor||(e.fornecedor="Fornecedor obrigat\xf3rio")),C(e),0===Object.keys(e).length},z=e=>{var r;S({id:e.id,quantidade:String(Math.abs(e.quantidade)),preco:(null===(r=e.preco)||void 0===r?void 0:r.toString())||"",fornecedor:e.fornecedor||"",marca:e.marca||""}),M()},F=e=>new Date(e).toLocaleDateString(),L=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(u.Z,{message:k,onClose:()=>q("")}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Estoque de Insumos"}),(0,t.jsx)(n.Z,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),T()&&("entrada"===j.tipo?(h({produtoId:j.produtoId,quantidade:Number(j.quantidade),preco:Number(j.preco.replace(",",".")),fornecedor:j.fornecedor,marca:j.marca}),q("Entrada registrada")):(f({produtoId:j.produtoId,quantidade:Number(j.quantidade)}),q("Sa\xedda registrada")),w({tipo:"entrada",produtoId:"",quantidade:"",preco:"",fornecedor:"",marca:""}))},className:"flex flex-wrap items-end gap-4",children:[(0,t.jsx)(i.Z,{label:"Produto *",name:"produtoId",value:j.produtoId,onChange:O,options:b.map(e=>({value:e.id,label:e.nome})).sort((e,r)=>e.label.localeCompare(r.label)),error:N.produtoId,className:"flex-1 min-w-[150px]"}),(0,t.jsx)(i.Z,{label:"Tipo *",name:"tipo",value:j.tipo,onChange:O,options:[{value:"entrada",label:"Entrada"},{value:"saida",label:"Sa\xedda"}],className:"w-32"}),(0,t.jsx)(l.Z,{label:"Quantidade *",name:"quantidade",value:j.quantidade,onChange:O,error:N.quantidade,className:"w-28"}),"entrada"===j.tipo&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{label:"Pre\xe7o Unit\xe1rio *",name:"preco",value:j.preco,onChange:O,error:N.preco,className:"w-32"}),(0,t.jsx)(l.Z,{label:"Fornecedor *",name:"fornecedor",value:j.fornecedor,onChange:O,error:N.fornecedor,className:"flex-1 min-w-[150px]"}),(0,t.jsx)(l.Z,{label:"Marca",name:"marca",value:j.marca,onChange:O,className:"flex-1 min-w-[120px]"})]}),(0,t.jsx)("div",{className:"flex justify-end flex-1",children:(0,t.jsxs)(c.Z,{type:"submit",variant:"primary",children:["Registrar ","entrada"===j.tipo?"Entrada":"Sa\xedda"]})})]})}),(0,t.jsx)(n.Z,{children:(0,t.jsx)(s.ZP,{headers:["Data","Produto","Qtd","Pre\xe7o","Fornecedor","Marca","Tipo","A\xe7\xf5es"],isLoading:a,emptyMessage:"Nenhuma movimenta\xe7\xe3o registrada",children:r.map(e=>{let r=b.find(r=>r.id===e.produtoId),a=y.find(r=>r.id===e.produtoId);return(0,t.jsxs)(s.SC,{children:[(0,t.jsx)(s.pj,{children:F(e.data)}),(0,t.jsx)(s.pj,{children:(null==r?void 0:r.nome)||(null==a?void 0:a.nome)||"Produto removido"}),(0,t.jsx)(s.pj,{children:e.quantidade}),(0,t.jsx)(s.pj,{children:e.preco?L(e.preco):"-"}),(0,t.jsx)(s.pj,{children:e.fornecedor||"-"}),(0,t.jsx)(s.pj,{children:e.marca||"-"}),(0,t.jsx)(s.pj,{children:"entrada"===e.tipo?"\uD83D\uDCE5 Entrada":"\uD83D\uDCE4 Sa\xedda"}),(0,t.jsxs)(s.pj,{className:"relative text-right",children:[(0,t.jsx)("button",{className:"p-1 rounded hover:bg-gray-100",onClick:()=>Z(I===e.id?null:e.id),children:(0,t.jsx)("span",{className:"material-icons text-gray-600",children:"more_vert"})}),I===e.id&&(0,t.jsxs)("div",{className:"absolute right-0 mt-2 w-32 bg-white border rounded shadow z-10",children:[(0,t.jsxs)("button",{className:"block w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center",onClick:()=>{Z(null),z(e)},children:[(0,t.jsx)("span",{className:"material-icons mr-1 text-black text-sm",children:"edit"}),"Editar"]}),(0,t.jsxs)("button",{className:"block w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center text-red-600",onClick:()=>{Z(null),g(e.id)},children:[(0,t.jsx)("span",{className:"material-icons mr-1 text-black text-sm",children:"delete"}),"Excluir"]})]})]})]},e.id)})})}),(0,t.jsx)(d.Z,{isOpen:P,onClose:D,title:"Editar Movimenta\xe7\xe3o",children:E&&(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),E&&(v(E.id,{quantidade:Number(E.quantidade),preco:E.preco?Number(E.preco.replace(",",".")):void 0,fornecedor:E.fornecedor,marca:E.marca}),D())},className:"space-y-4",children:[(0,t.jsx)(l.Z,{label:"Quantidade",value:E.quantidade,onChange:e=>S({...E,quantidade:e.target.value}),required:!0}),(null===(e=r.find(e=>e.id===E.id))||void 0===e?void 0:e.tipo)==="entrada"&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{label:"Pre\xe7o Unit\xe1rio",value:E.preco,onChange:e=>S({...E,preco:e.target.value})}),(0,t.jsx)(l.Z,{label:"Fornecedor",value:E.fornecedor,onChange:e=>S({...E,fornecedor:e.target.value})}),(0,t.jsx)(l.Z,{label:"Marca",value:E.marca,onChange:e=>S({...E,marca:e.target.value})})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(c.Z,{type:"button",variant:"secondary",onClick:D,children:"Cancelar"}),(0,t.jsx)(c.Z,{type:"submit",variant:"primary",children:"Salvar"})]})]})})]})}},66651:function(e,r,a){"use strict";var t=a(3827);a(64090),r.Z=e=>{let{children:r,variant:a="primary",size:o="md",isLoading:n=!1,fullWidth:s=!1,className:c="",disabled:l,...i}=e,d=l||n?"opacity-50 cursor-not-allowed":"";return(0,t.jsxs)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-[var(--cor-acao)] text-white hover:brightness-90 focus:ring-[var(--cor-acao)]",secondary:"bg-[var(--cor-secundaria)] text-white hover:brightness-90 focus:ring-[var(--cor-secundaria)]",success:"bg-[var(--cor-sucesso)] text-white hover:brightness-90 focus:ring-[var(--cor-sucesso)]",danger:"bg-[var(--cor-erro)] text-white hover:brightness-90 focus:ring-[var(--cor-erro)]",outline:"bg-white text-[var(--cor-texto-principal)] border border-[var(--cor-borda)] hover:bg-gray-50 focus:ring-[var(--cor-acao)]"}[a]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[o]," ").concat(s?"w-full":""," ").concat(d," ").concat(c),disabled:l||n,...i,children:[n&&(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r]})}},32278:function(e,r,a){"use strict";var t=a(3827);let o=(0,a(64090).forwardRef)((e,r)=>{let{label:a,error:o,helperText:n,className:s="",...c}=e;return(0,t.jsxs)("div",{className:"mb-4",children:[a&&(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--cor-texto-principal)"},children:a}),(0,t.jsx)("input",{ref:r,className:"w-full input ".concat(o?"border-[var(--cor-erro)]":""," ").concat(s),...c}),o&&(0,t.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-erro)"},children:o}),n&&!o&&(0,t.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-texto-secundario)"},children:n})]})});o.displayName="Input",r.Z=o},70492:function(e,r,a){"use strict";a.d(r,{d:function(){return n}});var t=a(3827),o=a(64090);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],[r,a]=(0,o.useState)(e);return{isOpen:r,openModal:()=>a(!0),closeModal:()=>a(!1),toggleModal:()=>a(!r)}};r.Z=e=>{let{isOpen:r,onClose:a,title:n,children:s,footer:c,size:l="md"}=e,[i,d]=(0,o.useState)(!1);return((0,o.useEffect)(()=>(r?(d(!0),document.body.style.overflow="hidden"):(setTimeout(()=>{d(!1)},200),document.body.style.overflow="auto"),()=>{document.body.style.overflow="auto"}),[r]),i||r)?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 ".concat(r?"opacity-100":"opacity-0"," transition-opacity duration-200"),children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:a}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full ".concat({sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[l]," z-10 ").concat(r?"translate-y-0":"translate-y-4"," transition-transform duration-200"),children:[(0,t.jsxs)("div",{className:"flex justify-between items-center px-6 py-4 border-b",style:{borderColor:"var(--cor-borda)"},children:[(0,t.jsx)("h3",{className:"text-lg font-medium",style:{color:"var(--cor-texto-principal)"},children:n}),(0,t.jsxs)("button",{type:"button",className:"text-gray-400 hover:text-gray-500 focus:outline-none",onClick:a,children:[(0,t.jsx)("span",{className:"sr-only",children:"Fechar"}),(0,t.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,t.jsx)("div",{className:"px-6 py-4",children:s}),c&&(0,t.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-t flex justify-end space-x-3",style:{borderColor:"var(--cor-borda)"},children:c})]})]}):null}},79173:function(e,r,a){"use strict";var t=a(3827);let o=(0,a(64090).forwardRef)((e,r)=>{let{label:a,error:o,helperText:n,options:s,className:c="",...l}=e;return(0,t.jsxs)("div",{className:"mb-4",children:[a&&(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,t.jsxs)("select",{ref:r,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 \n            ".concat(o?"border-red-500":"border-gray-300"," \n            ").concat(c),...l,children:[(0,t.jsx)("option",{value:"",children:"Selecione..."}),s.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]}),o&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o}),n&&!o&&(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:n})]})});o.displayName="Select",r.Z=o},20200:function(e,r,a){"use strict";a.d(r,{SC:function(){return n},pj:function(){return s}});var t=a(3827),o=a(64090);let n=e=>{let{children:r,className:a="",...o}=e;return(0,t.jsx)("tr",{className:"odd:bg-gray-50 hover:bg-[var(--cor-secundaria)/10] hover:shadow-sm rounded-lg ".concat(a),...o,children:r})},s=e=>{let{children:r,className:a="",compact:o=!1}=e;return(0,t.jsx)("td",{className:"".concat(o?"px-2 py-2":"px-6 py-4"," text-sm ").concat(a),style:{color:"var(--cor-texto-secundario)"},children:r})};r.ZP=e=>{let{headers:r,children:a,className:n="",emptyMessage:s="Nenhum dado encontrado",isLoading:c=!1}=e;return(0,t.jsx)("div",{className:"w-full overflow-x-hidden rounded-lg border ".concat(n),style:{borderColor:"var(--cor-borda)"},children:(0,t.jsxs)("table",{className:"w-full table-fixed divide-y",style:{borderColor:"var(--cor-borda)"},children:[(0,t.jsx)("thead",{className:"bg-gray-100",children:(0,t.jsx)("tr",{children:r.map((e,r)=>(0,t.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--cor-texto-secundario)"},children:e},r))})}),(0,t.jsx)("tbody",{className:"bg-white divide-y",style:{borderColor:"var(--cor-borda)"},children:c?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:r.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:(0,t.jsxs)("div",{className:"flex justify-center items-center py-4",children:[(0,t.jsxs)("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,t.jsx)("span",{className:"ml-2",children:"Carregando..."})]})})}):o.Children.count(a)>0?a:(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:r.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:s})})})]})})}},93242:function(e,r,a){"use strict";var t=a(3827),o=a(64090);r.Z=e=>{let{message:r,onClose:a}=e;return((0,o.useEffect)(()=>{if(!r)return;let e=setTimeout(a,3e3);return()=>clearTimeout(e)},[r,a]),r)?(0,t.jsx)("div",{className:"fixed top-4 right-4 bg-[var(--cor-sucesso)] text-white px-4 py-2 rounded shadow",children:r}):null}},29130:function(e,r,a){"use strict";a.d(r,{H:function(){return c}});var t=a(64090),o=a(27742),n=a(32355);let s=async()=>{try{let e=await fetch("/api/estoque",{headers:(0,n.g)()});if(!e.ok)throw Error("Erro ao buscar movimenta\xe7\xf5es");return await e.json()}catch(e){return console.error("Erro ao buscar movimenta\xe7\xf5es da API:",e),[]}},c=()=>{let[e,r]=(0,t.useState)([]),[a,c]=(0,t.useState)(!0),l=async e=>{if(e.preco)try{let r=(await (0,o.k0)()).find(r=>r.id===e.produtoId);if(r){let a=r.pesoEmbalagem||1,t=a>0?(e.preco||r.preco)/a:0,o={...r,preco:e.preco||r.preco,precoUnitario:t,fornecedor:e.fornecedor||r.fornecedor,marca:e.marca||r.marca};await fetch("/api/produtos/".concat(r.id),{method:"PUT",headers:(0,n.g)(),body:JSON.stringify(o)})}}catch(e){console.error("Erro ao atualizar produto:",e)}};(0,t.useEffect)(()=>{(async()=>{c(!0),r((await s()).filter(e=>"Producao"!==e.fornecedor)),c(!1)})()},[]);let i=async a=>{try{let t=await fetch("/api/estoque",{method:"POST",headers:(0,n.g)(),body:JSON.stringify({...a,data:new Date().toISOString(),tipo:"entrada"})});if(!t.ok)throw Error("Erro ao registrar entrada");let o=await t.json(),s=[...e,o];return r(s),await l(o),o}catch(e){return console.error("Erro ao registrar entrada:",e),null}},d=async a=>{try{let t=await fetch("/api/estoque",{method:"POST",headers:(0,n.g)(),body:JSON.stringify({produtoId:a.produtoId,quantidade:-Math.abs(a.quantidade),data:new Date().toISOString(),tipo:"saida"})});if(!t.ok)throw Error("Erro ao registrar sa\xedda");let o=await t.json(),s=[...e,o];return r(s),o}catch(e){return console.error("Erro ao registrar sa\xedda:",e),null}},u=async(a,t)=>{try{let o=await fetch("/api/estoque/".concat(a),{method:"PUT",headers:(0,n.g)(),body:JSON.stringify(t)});if(!o.ok)throw Error("Erro ao atualizar movimenta\xe7\xe3o");let s=await o.json(),c=e.map(e=>e.id===a?s:e);return r(c),"entrada"===s.tipo&&await l(s),s}catch(e){return console.error("Erro ao atualizar movimenta\xe7\xe3o:",e),null}},m=async a=>{try{if(!(await fetch("/api/estoque/".concat(a),{method:"DELETE",headers:(0,n.g)()})).ok)throw Error("Erro ao deletar movimenta\xe7\xe3o");let t=e.filter(e=>e.id!==a);return r(t),!0}catch(e){return console.error("Erro ao remover movimenta\xe7\xe3o:",e),!1}},x=(0,t.useCallback)(r=>e.filter(e=>e.produtoId===r).reduce((e,r)=>e+r.quantidade,0),[e]);return{movimentacoes:e,isLoading:a,registrarEntrada:i,registrarSaida:d,atualizarMovimentacao:u,removerMovimentacao:m,obterHistoricoPorProduto:r=>e.filter(e=>e.produtoId===r),calcularEstoqueAtual:x}}}},function(e){e.O(0,[249,971,69,744],function(){return e(e.s=50225)}),_N_E=e.O()}]);
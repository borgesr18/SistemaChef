(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[151],{15790:function(e,r,a){Promise.resolve().then(a.bind(a,19551))},19551:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return h}});var t=a(3827),o=a(64090),i=a(57418),n=a(20200),c=a(66651),s=a(79173),d=a(32278),l=a(65371),u=a(16297);function h(){let{movimentacoes:e,calcularEstoqueAtual:r,registrarEntrada:a,registrarSaida:h}=(0,l.u)(),{fichasTecnicas:f}=(0,u.vG)(),[m,p]=(0,o.useState)({fichaId:"",tipo:"saida",quantidade:"",validade:""}),[g,v]=(0,o.useState)(""),x=e=>{let{name:r,value:a}=e.target;p(e=>({...e,[r]:a}))};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Estoque de Produ\xe7\xe3o"}),(0,t.jsx)(i.Z,{children:(0,t.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!m.fichaId||!m.quantidade||isNaN(Number(m.quantidade))){v("Dados inv\xe1lidos");return}"entrada"===m.tipo?a({fichaId:m.fichaId,quantidade:Number(m.quantidade),validade:m.validade}):h({fichaId:m.fichaId,quantidade:Number(m.quantidade)}),p({fichaId:"",tipo:"saida",quantidade:"",validade:""}),v("")},className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsx)(s.Z,{label:"Ficha T\xe9cnica *",name:"fichaId",value:m.fichaId,onChange:x,options:f.map(e=>({value:e.id,label:e.nome})).sort((e,r)=>e.label.localeCompare(r.label)),error:g&&!m.fichaId?g:void 0}),(0,t.jsx)(s.Z,{label:"Tipo",name:"tipo",value:m.tipo,onChange:x,options:[{value:"entrada",label:"Entrada"},{value:"saida",label:"Sa\xedda"}]}),(0,t.jsx)(d.Z,{label:"Quantidade *",name:"quantidade",value:m.quantidade,onChange:x,error:g&&!m.quantidade?g:void 0}),"entrada"===m.tipo&&(0,t.jsx)(d.Z,{label:"Validade",type:"date",name:"validade",value:m.validade,onChange:x}),(0,t.jsx)("div",{className:"flex items-end",children:(0,t.jsx)(c.Z,{type:"submit",variant:"primary",children:"Registrar"})})]})}),(0,t.jsx)(i.Z,{title:"Hist\xf3rico de Produ\xe7\xe3o",children:(0,t.jsx)(n.ZP,{headers:["Ficha T\xe9cnica","Quantidade","Data","Validade","Estoque Total"],emptyMessage:"Nenhuma movimenta\xe7\xe3o",children:(()=>{let r={};return e.slice().sort((e,r)=>e.data.localeCompare(r.data)).map(e=>{r[e.fichaId]=(r[e.fichaId]||0)+e.quantidade;let a=r[e.fichaId],o=f.find(r=>r.id===e.fichaId);return(0,t.jsxs)(n.SC,{children:[(0,t.jsx)(n.pj,{children:(null==o?void 0:o.nome)||"Ficha removida"}),(0,t.jsx)(n.pj,{children:e.quantidade}),(0,t.jsx)(n.pj,{children:new Date(e.data).toLocaleDateString()}),(0,t.jsx)(n.pj,{children:e.validade?new Date(e.validade).toLocaleDateString():"-"}),(0,t.jsx)(n.pj,{children:a})]},e.id)})})()})}),(0,t.jsx)(i.Z,{title:"Estoque Atual",children:(0,t.jsx)(n.ZP,{headers:["Ficha T\xe9cnica","Quantidade"],emptyMessage:"Nenhum produto produzido",children:f.map(e=>{let a=r(e.id);return 0===a?null:(0,t.jsxs)(n.SC,{children:[(0,t.jsx)(n.pj,{children:e.nome}),(0,t.jsx)(n.pj,{children:a})]},e.id)})})})]})}},66651:function(e,r,a){"use strict";var t=a(3827);a(64090),r.Z=e=>{let{children:r,variant:a="primary",size:o="md",isLoading:i=!1,fullWidth:n=!1,className:c="",disabled:s,...d}=e,l=s||i?"opacity-50 cursor-not-allowed":"";return(0,t.jsxs)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-[var(--cor-acao)] text-white hover:brightness-90 focus:ring-[var(--cor-acao)]",secondary:"bg-[var(--cor-secundaria)] text-white hover:brightness-90 focus:ring-[var(--cor-secundaria)]",success:"bg-[var(--cor-sucesso)] text-white hover:brightness-90 focus:ring-[var(--cor-sucesso)]",danger:"bg-[var(--cor-erro)] text-white hover:brightness-90 focus:ring-[var(--cor-erro)]",outline:"bg-white text-[var(--cor-texto-principal)] border border-[var(--cor-borda)] hover:bg-gray-50 focus:ring-[var(--cor-acao)]"}[a]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[o]," ").concat(n?"w-full":""," ").concat(l," ").concat(c),disabled:s||i,...d,children:[i&&(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r]})}},57418:function(e,r,a){"use strict";var t=a(3827);a(64090),r.Z=e=>{let{children:r,title:a,className:o="",footer:i}=e;return(0,t.jsxs)("div",{className:"card overflow-hidden ".concat(o),children:[a&&(0,t.jsx)("div",{className:"px-6 py-4 border-b",style:{borderColor:"var(--cor-borda)"},children:(0,t.jsx)("h3",{className:"text-lg font-medium",style:{color:"var(--cor-texto-principal)"},children:a})}),(0,t.jsx)("div",{className:"p-6",children:r}),i&&(0,t.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-t",style:{borderColor:"var(--cor-borda)"},children:i})]})}},32278:function(e,r,a){"use strict";var t=a(3827);let o=(0,a(64090).forwardRef)((e,r)=>{let{label:a,error:o,helperText:i,className:n="",...c}=e;return(0,t.jsxs)("div",{className:"mb-4",children:[a&&(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--cor-texto-principal)"},children:a}),(0,t.jsx)("input",{ref:r,className:"w-full input ".concat(o?"border-[var(--cor-erro)]":""," ").concat(n),...c}),o&&(0,t.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-erro)"},children:o}),i&&!o&&(0,t.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-texto-secundario)"},children:i})]})});o.displayName="Input",r.Z=o},79173:function(e,r,a){"use strict";var t=a(3827);let o=(0,a(64090).forwardRef)((e,r)=>{let{label:a,error:o,helperText:i,options:n,className:c="",...s}=e;return(0,t.jsxs)("div",{className:"mb-4",children:[a&&(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,t.jsxs)("select",{ref:r,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 \n            ".concat(o?"border-red-500":"border-gray-300"," \n            ").concat(c),...s,children:[(0,t.jsx)("option",{value:"",children:"Selecione..."}),n.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]}),o&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o}),i&&!o&&(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:i})]})});o.displayName="Select",r.Z=o},20200:function(e,r,a){"use strict";a.d(r,{SC:function(){return i},pj:function(){return n}});var t=a(3827),o=a(64090);let i=e=>{let{children:r,className:a="",...o}=e;return(0,t.jsx)("tr",{className:"odd:bg-gray-50 hover:bg-[var(--cor-secundaria)/10] hover:shadow-sm rounded-lg ".concat(a),...o,children:r})},n=e=>{let{children:r,className:a="",compact:o=!1}=e;return(0,t.jsx)("td",{className:"".concat(o?"px-2 py-2":"px-6 py-4"," text-sm ").concat(a),style:{color:"var(--cor-texto-secundario)"},children:r})};r.ZP=e=>{let{headers:r,children:a,className:i="",emptyMessage:n="Nenhum dado encontrado",isLoading:c=!1}=e;return(0,t.jsx)("div",{className:"w-full overflow-x-hidden rounded-lg border ".concat(i),style:{borderColor:"var(--cor-borda)"},children:(0,t.jsxs)("table",{className:"w-full table-fixed divide-y",style:{borderColor:"var(--cor-borda)"},children:[(0,t.jsx)("thead",{className:"bg-gray-100",children:(0,t.jsx)("tr",{children:r.map((e,r)=>(0,t.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--cor-texto-secundario)"},children:e},r))})}),(0,t.jsx)("tbody",{className:"bg-white divide-y",style:{borderColor:"var(--cor-borda)"},children:c?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:r.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:(0,t.jsxs)("div",{className:"flex justify-center items-center py-4",children:[(0,t.jsxs)("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,t.jsx)("span",{className:"ml-2",children:"Carregando..."})]})})}):o.Children.count(a)>0?a:(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:r.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:n})})})]})})}},32355:function(e,r,a){"use strict";a.d(r,{g:function(){return o}});let t=()=>localStorage.getItem("auth_token"),o=()=>{let e=t();return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}},36806:function(e,r,a){"use strict";a.d(r,{O:function(){return c},Q:function(){return s}});var t=a(64090),o=a(32355);let i=async()=>{try{console.log("\uD83D\uDD0D Buscando categorias de receitas...");let e=await fetch("/api/categorias-receitas",{headers:(0,o.g)()});if(console.log("\uD83D\uDCE1 Response status: ".concat(e.status)),!e.ok){let r=await e.text();throw console.error("❌ Erro na API categorias-receitas: ".concat(e.status," - ").concat(r)),Error("Erro ao buscar categorias de receitas: ".concat(e.status))}let r=await e.json();return console.log("✅ Categorias de receitas carregadas: ".concat(r.length)),r}catch(e){return console.error("❌ Erro ao buscar categorias de receitas:",e),[]}},n=[{id:"",nome:"Entrada"},{id:"",nome:"Prato Principal"},{id:"",nome:"Acompanhamento"},{id:"",nome:"Sobremesa"},{id:"",nome:"Bebida"},{id:"",nome:"Molho/Condimento"},{id:"",nome:"Outro"}],c=()=>{let[e,r]=(0,t.useState)([]),[a,c]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{let e=!0;return(async()=>{try{if(!e)return;c(!0);let a=await i();if(!e)return;if(0===a.length){for(let r of n){if(!e)return;try{let e=await fetch("/api/categorias-receitas",{method:"POST",headers:(0,o.g)(),body:JSON.stringify({nome:r.nome})});if(e.ok){let r=await e.json();a.push(r)}else 409===e.status&&console.log("Categoria de receita '".concat(r.nome,"' j\xe1 existe, pulando..."))}catch(e){console.error("Erro ao criar categoria de receita padr\xe3o:",e)}}e&&(a=await i())}e&&r(a)}catch(a){console.error("Erro ao carregar categorias de receitas:",a),e&&r([])}finally{e&&c(!1)}})(),()=>{e=!1}},[]),{categorias:e,isLoading:a,adicionar:async e=>{try{let a=await fetch("/api/categorias-receitas",{method:"POST",headers:(0,o.g)(),body:JSON.stringify({nome:e})});if(!a.ok)throw Error("Erro ao adicionar categoria");let t=await a.json();return r(e=>[...e,t]),t}catch(e){return console.error("Erro ao adicionar categoria:",e),null}},atualizar:async(e,a)=>{try{let t=await fetch("/api/categorias-receitas/".concat(e),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify({nome:a})});if(!t.ok)throw Error("Erro ao atualizar categoria");let i=await t.json();return r(r=>r.map(r=>r.id===e?i:r)),!0}catch(e){return console.error("Erro ao atualizar categoria:",e),!1}},remover:async e=>{try{if(!(await fetch("/api/categorias-receitas/".concat(e),{method:"DELETE",headers:(0,o.g)()})).ok)throw Error("Erro ao remover categoria");return r(r=>r.filter(r=>r.id!==e)),!0}catch(e){return console.error("Erro ao remover categoria:",e),!1}},obterPorId:r=>e.find(e=>e.id===r)}},s=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e)return"N\xe3o informado";let a=r.find(r=>r.id===e);return a?a.nome:e.length>20?"Categoria n\xe3o encontrada":e}},65371:function(e,r,a){"use strict";a.d(r,{u:function(){return n}});var t=a(64090),o=a(32355);let i=async()=>{try{let e=await fetch("/api/estoque-producao",{headers:(0,o.g)()});if(!e.ok)throw Error("Erro ao buscar movimenta\xe7\xf5es de produ\xe7\xe3o");return await e.json()}catch(e){return console.error("Erro ao buscar movimenta\xe7\xf5es de produ\xe7\xe3o da API:",e),[]}},n=()=>{let[e,r]=(0,t.useState)([]),[a,n]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{n(!0),r(await i()),n(!1)})()},[]);let c=async a=>{try{let t=await fetch("/api/estoque-producao",{method:"POST",headers:(0,o.g)(),body:JSON.stringify({...a,data:new Date().toISOString(),tipo:"entrada"})});if(!t.ok)throw Error("Erro ao registrar entrada de produ\xe7\xe3o");let i=await t.json(),n=[...e,i];return r(n),i}catch(e){return console.error("Erro ao registrar entrada de produ\xe7\xe3o:",e),null}},s=async a=>{try{let t=await fetch("/api/estoque-producao",{method:"POST",headers:(0,o.g)(),body:JSON.stringify({fichaId:a.fichaId,quantidade:-Math.abs(a.quantidade),data:new Date().toISOString(),tipo:"saida"})});if(!t.ok)throw Error("Erro ao registrar sa\xedda de produ\xe7\xe3o");let i=await t.json(),n=[...e,i];return r(n),i}catch(e){return console.error("Erro ao registrar sa\xedda de produ\xe7\xe3o:",e),null}},d=async(a,t)=>{try{let i=await fetch("/api/estoque-producao/".concat(a),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify(t)});if(!i.ok)throw Error("Erro ao atualizar movimenta\xe7\xe3o de produ\xe7\xe3o");let n=await i.json(),c=e.map(e=>e.id===a?n:e);return r(c),n}catch(e){return console.error("Erro ao atualizar movimenta\xe7\xe3o de produ\xe7\xe3o:",e),null}},l=async a=>{try{if(!(await fetch("/api/estoque-producao/".concat(a),{method:"DELETE",headers:(0,o.g)()})).ok)throw Error("Erro ao deletar movimenta\xe7\xe3o de produ\xe7\xe3o");let t=e.filter(e=>e.id!==a);return r(t),!0}catch(e){return console.error("Erro ao remover movimenta\xe7\xe3o de produ\xe7\xe3o:",e),!1}};return{movimentacoes:e,isLoading:a,registrarEntrada:c,registrarSaida:s,calcularEstoqueAtual:r=>e.filter(e=>e.fichaId===r).reduce((e,r)=>e+r.quantidade,0),atualizarMovimentacao:d,removerMovimentacao:l}}},16297:function(e,r,a){"use strict";a.d(r,{Gm:function(){return l},IO:function(){return h},N2:function(){return p},Q_:function(){return i.Q},eW:function(){return f},gZ:function(){return g},lB:function(){return s},vG:function(){return u},vT:function(){return v},zP:function(){return c}});var t=a(64090),o=a(32355),i=a(36806);let n={g:{tipo:"peso",fator:1},kg:{tipo:"peso",fator:1e3},ml:{tipo:"volume",fator:1},l:{tipo:"volume",fator:1e3},un:{tipo:"unidade",fator:1},cx:{tipo:"unidade",fator:1},pct:{tipo:"unidade",fator:1}},c=(e,r,a)=>{let t=n[r],o=n[a];return t&&o&&t.tipo===o.tipo?e*t.fator/o.fator:e},s=async()=>{try{let e=await fetch("/api/fichas-tecnicas",{headers:(0,o.g)()});if(!e.ok)throw Error("Erro ao buscar fichas t\xe9cnicas: ".concat(e.status));return await e.json()}catch(e){return console.error("Error loading fichas t\xe9cnicas:",e),[]}},d=(e,r)=>e.reduce((e,a)=>{var t,o;let i=r.find(e=>e.id===a.produtoId);if(!i)return e;let s=a.unidade||i.unidadeMedida,d=null===(t=n[s])||void 0===t?void 0:t.tipo;if("peso"===d)return e+c(a.quantidade,s,"g");if("volume"===d)return e+c(a.quantidade,s,"ml");{let r=i.pesoEmbalagem||(null===(o=n[i.unidadeMedida])||void 0===o?void 0:o.fator)||1;return e+c(a.quantidade,s,i.unidadeMedida)*r}},0),l=(e,r,a)=>{var t;let o=null===(t=n[r])||void 0===t?void 0:t.tipo;return"peso"===o||"volume"===o?c(d(e,a),"peso"===o?"g":"ml",r):e.reduce((e,t)=>{let o=a.find(e=>e.id===t.produtoId),i=t.unidade||(null==o?void 0:o.unidadeMedida)||"un";return e+c(t.quantidade,i,r)},0)},u=()=>{let[e,r]=(0,t.useState)([]),[a,o]=(0,t.useState)(!1);return{fichasTecnicas:e,isLoading:a,setFichasTecnicas:r,setIsLoading:o,obterFichaTecnicaPorId:r=>e.find(e=>e.id===r),calcularRendimentoTotal:l,atualizarFichaTecnica:m,removerFichaTecnica:p}},h=async e=>{try{let r=await fetch("/api/fichas-tecnicas/".concat(e),{headers:(0,o.g)()});if(!r.ok){if(404===r.status)return null;throw Error("Erro ao buscar ficha t\xe9cnica")}let a=await r.json();return{...a,dataCriacao:a.createdAt?new Date(a.createdAt).toLocaleDateString("pt-BR"):"Data n\xe3o dispon\xedvel",dataModificacao:a.updatedAt?new Date(a.updatedAt).toLocaleDateString("pt-BR"):"Data n\xe3o dispon\xedvel",tempoPreparo:parseInt(a.tempoPreparo)||0,custoTotal:Number(a.custoTotal)||0,custoPorcao:Number(a.custoPorcao)||0,custoPorKg:a.custoTotal&&a.rendimentoTotal?a.custoTotal/a.rendimentoTotal*1e3:0}}catch(e){return console.error("Erro ao buscar ficha t\xe9cnica por ID:",e),null}},f=async e=>{try{let r=await fetch("/api/fichas-tecnicas",{method:"POST",headers:(0,o.g)(),body:JSON.stringify(e)});if(!r.ok){let e=await r.text();throw console.error("Erro na resposta da API:",r.status,e),Error("Erro ao criar ficha t\xe9cnica: ".concat(r.status))}return await r.json()}catch(e){return console.error("Erro ao adicionar ficha t\xe9cnica:",e),null}},m=async(e,r)=>{try{let a=await fetch("/api/fichas-tecnicas/".concat(e),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify(r)});if(!a.ok)throw Error("Erro ao atualizar ficha t\xe9cnica");return await a.json()}catch(e){return console.error("Erro ao atualizar ficha t\xe9cnica:",e),null}},p=async e=>{try{if(!(await fetch("/api/fichas-tecnicas/".concat(e),{method:"DELETE",headers:(0,o.g)()})).ok)throw Error("Erro ao deletar ficha t\xe9cnica");return!0}catch(e){return console.error("Erro ao remover ficha t\xe9cnica:",e),!1}},g=[{value:"porcoes",label:"Por\xe7\xf5es"},{value:"unidades",label:"Unidades"},{value:"kg",label:"Quilogramas (kg)"},{value:"g",label:"Gramas (g)"},{value:"l",label:"Litros (l)"},{value:"ml",label:"Mililitros (ml)"}],v=e=>{let r=g.find(r=>r.value===e);return r?r.label:e}}},function(e){e.O(0,[971,655,744],function(){return e(e.s=15790)}),_N_E=e.O()}]);
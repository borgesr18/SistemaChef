(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7151],{15790:function(e,t,a){Promise.resolve().then(a.bind(a,19551))},19551:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var r=a(3827),o=a(64090),i=a(57418),n=a(20200),d=a(66651),c=a(79173),s=a(32278),l=a(65371),u=a(16297);function h(){let{movimentacoes:e,calcularEstoqueAtual:t,registrarEntrada:a,registrarSaida:h}=(0,l.u)(),{fichasTecnicas:f}=(0,u.vG)(),[p,m]=(0,o.useState)({fichaId:"",tipo:"saida",quantidade:"",validade:""}),[v,x]=(0,o.useState)(""),g=e=>{let{name:t,value:a}=e.target;m(e=>({...e,[t]:a}))};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Estoque de Produ\xe7\xe3o"}),(0,r.jsx)(i.Z,{children:(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!p.fichaId||!p.quantidade||isNaN(Number(p.quantidade))){x("Dados inv\xe1lidos");return}"entrada"===p.tipo?a({fichaId:p.fichaId,quantidade:Number(p.quantidade),validade:p.validade}):h({fichaId:p.fichaId,quantidade:Number(p.quantidade)}),m({fichaId:"",tipo:"saida",quantidade:"",validade:""}),x("")},className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsx)(c.Z,{label:"Ficha T\xe9cnica *",name:"fichaId",value:p.fichaId,onChange:g,options:f.map(e=>({value:e.id,label:e.nome})).sort((e,t)=>e.label.localeCompare(t.label)),error:v&&!p.fichaId?v:void 0}),(0,r.jsx)(c.Z,{label:"Tipo",name:"tipo",value:p.tipo,onChange:g,options:[{value:"entrada",label:"Entrada"},{value:"saida",label:"Sa\xedda"}]}),(0,r.jsx)(s.default,{label:"Quantidade *",name:"quantidade",value:p.quantidade,onChange:g,error:v&&!p.quantidade?v:void 0}),"entrada"===p.tipo&&(0,r.jsx)(s.default,{label:"Validade",type:"date",name:"validade",value:p.validade,onChange:g}),(0,r.jsx)("div",{className:"flex items-end",children:(0,r.jsx)(d.default,{type:"submit",variant:"primary",children:"Registrar"})})]})}),(0,r.jsx)(i.Z,{title:"Hist\xf3rico de Produ\xe7\xe3o",children:(0,r.jsx)(n.ZP,{headers:["Ficha T\xe9cnica","Quantidade","Data","Validade","Estoque Total"],emptyMessage:"Nenhuma movimenta\xe7\xe3o",children:(()=>{let t={};return e.slice().sort((e,t)=>e.data.localeCompare(t.data)).map(e=>{t[e.fichaId]=(t[e.fichaId]||0)+e.quantidade;let a=t[e.fichaId],o=f.find(t=>t.id===e.fichaId);return(0,r.jsxs)(n.SC,{children:[(0,r.jsx)(n.pj,{children:(null==o?void 0:o.nome)||"Ficha removida"}),(0,r.jsx)(n.pj,{children:e.quantidade}),(0,r.jsx)(n.pj,{children:new Date(e.data).toLocaleDateString()}),(0,r.jsx)(n.pj,{children:e.validade?new Date(e.validade).toLocaleDateString():"-"}),(0,r.jsx)(n.pj,{children:a})]},e.id)})})()})}),(0,r.jsx)(i.Z,{title:"Estoque Atual",children:(0,r.jsx)(n.ZP,{headers:["Ficha T\xe9cnica","Quantidade"],emptyMessage:"Nenhum produto produzido",children:f.map(e=>{let a=t(e.id);return 0===a?null:(0,r.jsxs)(n.SC,{children:[(0,r.jsx)(n.pj,{children:e.nome}),(0,r.jsx)(n.pj,{children:a})]},e.id)})})})]})}},66651:function(e,t,a){"use strict";a.d(t,{z:function(){return s}});var r=a(3827),o=a(64090),i=a(76371),n=a(49769),d=a(22169);let c=(0,n.j)("inline-flex items-center justify-center rounded-2xl text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 shadow-sm",{variants:{variant:{default:"bg-primary text-white hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),s=o.forwardRef((e,t)=>{let{className:a,variant:o,size:n,asChild:s=!1,...l}=e,u=s?i.g7:"button";return(0,r.jsx)(u,{className:(0,d.cn)(c({variant:o,size:n,className:a})),ref:t,...l})});s.displayName="Button"},57418:function(e,t,a){"use strict";var r=a(3827);a(64090),t.Z=e=>{let{children:t,title:a,className:o="",footer:i}=e;return(0,r.jsxs)("div",{className:"card overflow-hidden ".concat(o),children:[a&&(0,r.jsx)("div",{className:"px-6 py-4 border-b",style:{borderColor:"var(--cor-borda)"},children:(0,r.jsx)("h3",{className:"text-lg font-medium",style:{color:"var(--cor-texto-principal)"},children:a})}),(0,r.jsx)("div",{className:"p-6",children:t}),i&&(0,r.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-t",style:{borderColor:"var(--cor-borda)"},children:i})]})}},32278:function(e,t,a){"use strict";a.d(t,{I:function(){return n}});var r=a(3827),o=a(64090),i=a(22169);let n=o.forwardRef((e,t)=>{let{className:a,type:o,...n}=e;return(0,r.jsx)("input",{type:o,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...n})});n.displayName="Input"},79173:function(e,t,a){"use strict";var r=a(3827);let o=(0,a(64090).forwardRef)((e,t)=>{let{label:a,error:o,helperText:i,options:n,className:d="",...c}=e;return(0,r.jsxs)("div",{className:"mb-4",children:[a&&(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,r.jsxs)("select",{ref:t,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 \n            ".concat(o?"border-red-500":"border-gray-300"," \n            ").concat(d),...c,children:[(0,r.jsx)("option",{value:"",children:"Selecione..."}),n.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]}),o&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o}),i&&!o&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:i})]})});o.displayName="Select",t.Z=o},20200:function(e,t,a){"use strict";a.d(t,{SC:function(){return i},pj:function(){return n}});var r=a(3827),o=a(64090);let i=e=>{let{children:t,className:a="",...o}=e;return(0,r.jsx)("tr",{className:"odd:bg-gray-50 hover:bg-[var(--cor-secundaria)/10] hover:shadow-sm rounded-lg ".concat(a),...o,children:t})},n=e=>{let{children:t,className:a="",compact:o=!1}=e;return(0,r.jsx)("td",{className:"".concat(o?"px-2 py-2":"px-6 py-4"," text-sm ").concat(a),style:{color:"var(--cor-texto-secundario)"},children:t})};t.ZP=e=>{let{headers:t,children:a,className:i="",emptyMessage:n="Nenhum dado encontrado",isLoading:d=!1}=e;return(0,r.jsx)("div",{className:"w-full overflow-x-hidden rounded-lg border ".concat(i),style:{borderColor:"var(--cor-borda)"},children:(0,r.jsxs)("table",{className:"w-full table-fixed divide-y",style:{borderColor:"var(--cor-borda)"},children:[(0,r.jsx)("thead",{className:"bg-gray-100",children:(0,r.jsx)("tr",{children:t.map((e,t)=>(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--cor-texto-secundario)"},children:e},t))})}),(0,r.jsx)("tbody",{className:"bg-white divide-y",style:{borderColor:"var(--cor-borda)"},children:d?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:t.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:(0,r.jsxs)("div",{className:"flex justify-center items-center py-4",children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,r.jsx)("span",{className:"ml-2",children:"Carregando..."})]})})}):o.Children.count(a)>0?a:(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:t.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:n})})})]})})}},32355:function(e,t,a){"use strict";a.d(t,{g:function(){return r},x:function(){return o}});let r=()=>{var e,t;let a=null===(t=document.cookie)||void 0===t?void 0:null===(e=t.split("; ").find(e=>e.startsWith("sb-access-token=")))||void 0===e?void 0:e.split("=")[1];return{Authorization:a?"Bearer ".concat(a):""}},o={get:async e=>await fetch(e,{method:"GET",headers:{...r(),"Content-Type":"application/json"}}),post:async(e,t)=>await fetch(e,{method:"POST",headers:{...r(),"Content-Type":"application/json"},body:JSON.stringify(t)}),put:async(e,t)=>await fetch(e,{method:"PUT",headers:{...r(),"Content-Type":"application/json"},body:JSON.stringify(t)}),delete:async e=>await fetch(e,{method:"DELETE",headers:{...r(),"Content-Type":"application/json"}})}},36806:function(e,t,a){"use strict";a(1877)},65371:function(e,t,a){"use strict";a.d(t,{u:function(){return n}});var r=a(64090),o=a(32355);let i=async()=>{try{let e=await fetch("/api/estoque-producao",{headers:(0,o.g)()});if(!e.ok)throw Error("Erro ao buscar movimenta\xe7\xf5es de produ\xe7\xe3o");return await e.json()}catch(e){return console.error("Erro ao buscar movimenta\xe7\xf5es de produ\xe7\xe3o da API:",e),[]}},n=()=>{let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{n(!0),t(await i()),n(!1)})()},[]);let d=async a=>{try{let r=await fetch("/api/estoque-producao",{method:"POST",headers:(0,o.g)(),body:JSON.stringify({...a,data:new Date().toISOString(),tipo:"entrada"})});if(!r.ok)throw Error("Erro ao registrar entrada de produ\xe7\xe3o");let i=await r.json(),n=[...e,i];return t(n),i}catch(e){return console.error("Erro ao registrar entrada de produ\xe7\xe3o:",e),null}},c=async a=>{try{let r=await fetch("/api/estoque-producao",{method:"POST",headers:(0,o.g)(),body:JSON.stringify({fichaId:a.fichaId,quantidade:-Math.abs(a.quantidade),data:new Date().toISOString(),tipo:"saida"})});if(!r.ok)throw Error("Erro ao registrar sa\xedda de produ\xe7\xe3o");let i=await r.json(),n=[...e,i];return t(n),i}catch(e){return console.error("Erro ao registrar sa\xedda de produ\xe7\xe3o:",e),null}},s=async(a,r)=>{try{let i=await fetch("/api/estoque-producao/".concat(a),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify(r)});if(!i.ok)throw Error("Erro ao atualizar movimenta\xe7\xe3o de produ\xe7\xe3o");let n=await i.json(),d=e.map(e=>e.id===a?n:e);return t(d),n}catch(e){return console.error("Erro ao atualizar movimenta\xe7\xe3o de produ\xe7\xe3o:",e),null}},l=async a=>{try{if(!(await fetch("/api/estoque-producao/".concat(a),{method:"DELETE",headers:(0,o.g)()})).ok)throw Error("Erro ao deletar movimenta\xe7\xe3o de produ\xe7\xe3o");let r=e.filter(e=>e.id!==a);return t(r),!0}catch(e){return console.error("Erro ao remover movimenta\xe7\xe3o de produ\xe7\xe3o:",e),!1}};return{movimentacoes:e,isLoading:a,registrarEntrada:d,registrarSaida:c,calcularEstoqueAtual:t=>e.filter(e=>e.fichaId===t).reduce((e,t)=>e+t.quantidade,0),atualizarMovimentacao:s,removerMovimentacao:l}}},16297:function(e,t,a){"use strict";a.d(t,{Gm:function(){return l},IO:function(){return h},N2:function(){return m},Q_:function(){return i.obterLabelCategoriaReceita},eW:function(){return f},gZ:function(){return v},lB:function(){return c},vG:function(){return u},vT:function(){return x},zP:function(){return d}});var r=a(64090),o=a(32355),i=a(36806);let n={g:{tipo:"peso",fator:1},kg:{tipo:"peso",fator:1e3},ml:{tipo:"volume",fator:1},l:{tipo:"volume",fator:1e3},un:{tipo:"unidade",fator:1},cx:{tipo:"unidade",fator:1},pct:{tipo:"unidade",fator:1}},d=(e,t,a)=>{let r=n[t],o=n[a];return r&&o&&r.tipo===o.tipo?e*r.fator/o.fator:e},c=async()=>{try{let e=await fetch("/api/fichas-tecnicas",{headers:(0,o.g)()});if(!e.ok)throw Error("Erro ao buscar fichas t\xe9cnicas: ".concat(e.status));return await e.json()}catch(e){return console.error("Error loading fichas t\xe9cnicas:",e),[]}},s=(e,t)=>e.reduce((e,a)=>{var r,o;let i=t.find(e=>e.id===a.produtoId);if(!i)return e;let c=a.unidade||i.unidadeMedida,s=null===(r=n[c])||void 0===r?void 0:r.tipo;if("peso"===s)return e+d(a.quantidade,c,"g");if("volume"===s)return e+d(a.quantidade,c,"ml");{let t=i.pesoEmbalagem||(null===(o=n[i.unidadeMedida])||void 0===o?void 0:o.fator)||1;return e+d(a.quantidade,c,i.unidadeMedida)*t}},0),l=(e,t,a)=>{var r;let o=null===(r=n[t])||void 0===r?void 0:r.tipo;return"peso"===o||"volume"===o?d(s(e,a),"peso"===o?"g":"ml",t):e.reduce((e,r)=>{let o=a.find(e=>e.id===r.produtoId),i=r.unidade||(null==o?void 0:o.unidadeMedida)||"un";return e+d(r.quantidade,i,t)},0)},u=()=>{let[e,t]=(0,r.useState)([]),[a,o]=(0,r.useState)(!1);return{fichasTecnicas:e,isLoading:a,setFichasTecnicas:t,setIsLoading:o,obterFichaTecnicaPorId:t=>e.find(e=>e.id===t),calcularRendimentoTotal:l,atualizarFichaTecnica:p,removerFichaTecnica:m}},h=async e=>{try{let t=await fetch("/api/fichas-tecnicas/".concat(e),{headers:(0,o.g)()});if(!t.ok){if(404===t.status)return null;throw Error("Erro ao buscar ficha t\xe9cnica")}let a=await t.json();return{...a,dataCriacao:a.createdAt?new Date(a.createdAt).toLocaleDateString("pt-BR"):"Data n\xe3o dispon\xedvel",dataModificacao:a.updatedAt?new Date(a.updatedAt).toLocaleDateString("pt-BR"):"Data n\xe3o dispon\xedvel",tempoPreparo:parseInt(a.tempoPreparo)||0,custoTotal:Number(a.custoTotal)||0,custoPorcao:Number(a.custoPorcao)||0,custoPorKg:a.custoTotal&&a.rendimentoTotal?a.custoTotal/a.rendimentoTotal*1e3:0}}catch(e){return console.error("Erro ao buscar ficha t\xe9cnica por ID:",e),null}},f=async e=>{try{let t=await fetch("/api/fichas-tecnicas",{method:"POST",headers:(0,o.g)(),body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw console.error("Erro na resposta da API:",t.status,e),Error("Erro ao criar ficha t\xe9cnica: ".concat(t.status))}return await t.json()}catch(e){return console.error("Erro ao adicionar ficha t\xe9cnica:",e),null}},p=async(e,t)=>{try{let a=await fetch("/api/fichas-tecnicas/".concat(e),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify(t)});if(!a.ok)throw Error("Erro ao atualizar ficha t\xe9cnica");return await a.json()}catch(e){return console.error("Erro ao atualizar ficha t\xe9cnica:",e),null}},m=async e=>{try{if(!(await fetch("/api/fichas-tecnicas/".concat(e),{method:"DELETE",headers:(0,o.g)()})).ok)throw Error("Erro ao deletar ficha t\xe9cnica");return!0}catch(e){return console.error("Erro ao remover ficha t\xe9cnica:",e),!1}},v=[{value:"porcoes",label:"Por\xe7\xf5es"},{value:"unidades",label:"Unidades"},{value:"kg",label:"Quilogramas (kg)"},{value:"g",label:"Gramas (g)"},{value:"l",label:"Litros (l)"},{value:"ml",label:"Mililitros (ml)"}],x=e=>{let t=v.find(t=>t.value===e);return t?t.label:e}},1877:function(e,t,a){"use strict";(0,a(33837).createBrowserClient)("https://sutmfzcmrlqnocsusiav.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1dG1memNtcmxxbm9jc3VzaWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1MzgwODMsImV4cCI6MjA2NjExNDA4M30.BQRo64qRNzqB_XGNeSe4jkZ8Mzzji8eUYVbS_nWw8tI")},22169:function(e,t,a){"use strict";a.d(t,{cn:function(){return i}});var r=a(75504),o=a(51367);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,o.m6)((0,r.W)(t))}}},function(e){e.O(0,[7176,869,3837,2971,8069,1744],function(){return e(e.s=15790)}),_N_E=e.O()}]);
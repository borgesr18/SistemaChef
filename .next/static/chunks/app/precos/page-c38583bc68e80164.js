(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6139],{76071:function(e,r,t){Promise.resolve().then(t.bind(t,6455))},6455:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return m}});var a=t(3827),o=t(64090),n=t(57418),i=t(79173),c=t(32278),s=t(66651),l=t(20200),d=t(81462),u=t(16297),f=t(32355);let h=async()=>{try{let e=await fetch("/api/precos",{headers:(0,f.g)()});if(!e.ok)throw Error("Erro ao buscar pre\xe7os");return await e.json()}catch(e){return console.error("Erro ao buscar pre\xe7os da API:",e),[]}},p=()=>{let[e,r]=(0,o.useState)([]);(0,o.useEffect)(()=>{(async()=>{r(await h())})()},[]);let t=async(t,a)=>{try{if(a){let o=await fetch("/api/precos/".concat(a),{method:"PUT",headers:(0,f.g)(),body:JSON.stringify(t)});if(!o.ok)throw Error("Erro ao atualizar estrat\xe9gia");let n=await o.json(),i=e.map(e=>e.id===a?n:e);return r(i),n}{let a=await fetch("/api/precos",{method:"POST",headers:(0,f.g)(),body:JSON.stringify(t)});if(!a.ok)throw Error("Erro ao criar estrat\xe9gia");let o=await a.json(),n=[...e,o];return r(n),o}}catch(e){return console.error("Erro ao salvar estrat\xe9gia:",e),null}},a=async t=>{try{if(!(await fetch("/api/precos/".concat(t),{method:"DELETE",headers:(0,f.g)()})).ok)throw Error("Erro ao deletar estrat\xe9gia");let a=e.filter(e=>e.id!==t);return r(a),!0}catch(e){return console.error("Erro ao remover estrat\xe9gia:",e),!1}};return{estrategias:e,salvarEstrategia:t,removerEstrategia:a,obterPorProducao:r=>e.find(e=>e.producaoId===r)}};function m(){let{producoes:e}=(0,d.G)(),{fichasTecnicas:r}=(0,u.vG)(),{estrategias:t,salvarEstrategia:f,removerEstrategia:h,obterPorProducao:m}=p(),[g,x]=(0,o.useState)(""),[v,b]=(0,o.useState)({lucro1:"",lucro2:"",lucro3:""}),[y,j]=(0,o.useState)(null),[w,N]=(0,o.useState)(null),E=e.find(e=>e.id===g),k=(null==E?void 0:E.custoUnitario)||0,S=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),I=e=>{let r=parseFloat(e);return isNaN(r)?0:k+k*r/100},P=e=>{if(!e)return"";let[r,t,a]=e.split("-");return"".concat(a,"/").concat(t,"/").concat(r)},C=e=>{x(e.producaoId),b({lucro1:e.lucro1.toString(),lucro2:e.lucro2.toString(),lucro3:e.lucro3.toString()}),j(e.id)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Pre\xe7os de Venda"}),(0,a.jsx)(n.Z,{children:(0,a.jsxs)("form",{onSubmit:e=>{var r;e.preventDefault(),E&&(f({producaoId:E.id,fichaId:E.fichaId,custoUnitario:k,lucro1:parseFloat(v.lucro1)||0,preco1:I(v.lucro1),lucro2:parseFloat(v.lucro2)||0,preco2:I(v.lucro2),lucro3:parseFloat(v.lucro3)||0,preco3:I(v.lucro3)},y||(null===(r=m(E.id))||void 0===r?void 0:r.id)),b({lucro1:"",lucro2:"",lucro3:""}),j(null))},className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,a.jsx)(i.Z,{label:"Produto Produzido",name:"producao",value:g,onChange:e=>x(e.target.value),options:e.map(e=>{let t=r.find(r=>r.id===e.fichaId),a=t?"".concat(t.nome," (").concat(P(e.data),")"):e.id;return{value:e.id,label:a}})}),(0,a.jsx)(c.default,{label:"Custo Unit\xe1rio",readOnly:!0,value:E?S(k):""}),(0,a.jsx)(c.default,{label:"Lucro % Pre\xe7o 1",name:"lucro1",value:v.lucro1,onChange:e=>b(r=>({...r,lucro1:e.target.value}))}),(0,a.jsx)(c.default,{label:"Lucro % Pre\xe7o 2",name:"lucro2",value:v.lucro2,onChange:e=>b(r=>({...r,lucro2:e.target.value}))}),(0,a.jsx)(c.default,{label:"Lucro % Pre\xe7o 3",name:"lucro3",value:v.lucro3,onChange:e=>b(r=>({...r,lucro3:e.target.value}))}),(0,a.jsx)("div",{className:"md:col-span-6 flex justify-end",children:(0,a.jsx)(s.default,{type:"submit",variant:"primary",children:"Salvar Estrat\xe9gia"})})]})}),(0,a.jsx)(n.Z,{title:"Estrat\xe9gias Salvas",children:(0,a.jsx)(l.ZP,{headers:["Ficha","Data","Custo","Pre\xe7o 1","Pre\xe7o 2","Pre\xe7o 3","A\xe7\xf5es"],emptyMessage:"Nenhuma estrat\xe9gia registrada",children:t.map(t=>{let o=e.find(e=>e.id===t.producaoId),n=r.find(e=>e.id===t.fichaId);return(0,a.jsxs)(l.SC,{children:[(0,a.jsx)(l.pj,{children:(null==n?void 0:n.nome)||t.fichaId}),(0,a.jsx)(l.pj,{children:o?P(o.data):""}),(0,a.jsx)(l.pj,{children:S(t.custoUnitario)}),(0,a.jsx)(l.pj,{children:S(t.preco1)}),(0,a.jsx)(l.pj,{children:S(t.preco2)}),(0,a.jsx)(l.pj,{children:S(t.preco3)}),(0,a.jsxs)(l.pj,{className:"relative text-right",children:[(0,a.jsx)("button",{className:"p-1 rounded hover:bg-gray-100",onClick:()=>N(w===t.id?null:t.id),children:(0,a.jsx)("span",{className:"material-icons text-gray-600",children:"more_vert"})}),w===t.id&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-32 bg-white border rounded shadow z-10",children:[(0,a.jsxs)("button",{className:"block w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center",onClick:()=>{N(null),C(t)},children:[(0,a.jsx)("span",{className:"material-icons mr-1 text-black text-sm",children:"edit"}),"Alterar"]}),(0,a.jsxs)("button",{className:"block w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center text-red-600",onClick:()=>{N(null),h(t.id)},children:[(0,a.jsx)("span",{className:"material-icons mr-1 text-black text-sm",children:"delete"}),"Excluir"]})]})]})]},t.id)})})})]})}},66651:function(e,r,t){"use strict";t.d(r,{z:function(){return l}});var a=t(3827),o=t(64090),n=t(76371),i=t(49769),c=t(22169);let s=(0,i.j)("inline-flex items-center justify-center rounded-2xl text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 shadow-sm",{variants:{variant:{default:"bg-primary text-white hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=o.forwardRef((e,r)=>{let{className:t,variant:o,size:i,asChild:l=!1,...d}=e,u=l?n.g7:"button";return(0,a.jsx)(u,{className:(0,c.cn)(s({variant:o,size:i,className:t})),ref:r,...d})});l.displayName="Button"},57418:function(e,r,t){"use strict";var a=t(3827);t(64090),r.Z=e=>{let{children:r,title:t,className:o="",footer:n}=e;return(0,a.jsxs)("div",{className:"card overflow-hidden ".concat(o),children:[t&&(0,a.jsx)("div",{className:"px-6 py-4 border-b",style:{borderColor:"var(--cor-borda)"},children:(0,a.jsx)("h3",{className:"text-lg font-medium",style:{color:"var(--cor-texto-principal)"},children:t})}),(0,a.jsx)("div",{className:"p-6",children:r}),n&&(0,a.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-t",style:{borderColor:"var(--cor-borda)"},children:n})]})}},32278:function(e,r,t){"use strict";t.d(r,{I:function(){return i}});var a=t(3827),o=t(64090),n=t(22169);let i=o.forwardRef((e,r)=>{let{className:t,type:o,...i}=e;return(0,a.jsx)("input",{type:o,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...i})});i.displayName="Input"},79173:function(e,r,t){"use strict";var a=t(3827);let o=(0,t(64090).forwardRef)((e,r)=>{let{label:t,error:o,helperText:n,options:i,className:c="",...s}=e;return(0,a.jsxs)("div",{className:"mb-4",children:[t&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,a.jsxs)("select",{ref:r,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 \n            ".concat(o?"border-red-500":"border-gray-300"," \n            ").concat(c),...s,children:[(0,a.jsx)("option",{value:"",children:"Selecione..."}),i.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]}),o&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o}),n&&!o&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:n})]})});o.displayName="Select",r.Z=o},20200:function(e,r,t){"use strict";t.d(r,{SC:function(){return n},pj:function(){return i}});var a=t(3827),o=t(64090);let n=e=>{let{children:r,className:t="",...o}=e;return(0,a.jsx)("tr",{className:"odd:bg-gray-50 hover:bg-[var(--cor-secundaria)/10] hover:shadow-sm rounded-lg ".concat(t),...o,children:r})},i=e=>{let{children:r,className:t="",compact:o=!1}=e;return(0,a.jsx)("td",{className:"".concat(o?"px-2 py-2":"px-6 py-4"," text-sm ").concat(t),style:{color:"var(--cor-texto-secundario)"},children:r})};r.ZP=e=>{let{headers:r,children:t,className:n="",emptyMessage:i="Nenhum dado encontrado",isLoading:c=!1}=e;return(0,a.jsx)("div",{className:"w-full overflow-x-hidden rounded-lg border ".concat(n),style:{borderColor:"var(--cor-borda)"},children:(0,a.jsxs)("table",{className:"w-full table-fixed divide-y",style:{borderColor:"var(--cor-borda)"},children:[(0,a.jsx)("thead",{className:"bg-gray-100",children:(0,a.jsx)("tr",{children:r.map((e,r)=>(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--cor-texto-secundario)"},children:e},r))})}),(0,a.jsx)("tbody",{className:"bg-white divide-y",style:{borderColor:"var(--cor-borda)"},children:c?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:r.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:(0,a.jsxs)("div",{className:"flex justify-center items-center py-4",children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("span",{className:"ml-2",children:"Carregando..."})]})})}):o.Children.count(t)>0?t:(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:r.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:i})})})]})})}},32355:function(e,r,t){"use strict";t.d(r,{g:function(){return a},x:function(){return o}});let a=()=>{var e,r;let t=null===(r=document.cookie)||void 0===r?void 0:null===(e=r.split("; ").find(e=>e.startsWith("sb-access-token=")))||void 0===e?void 0:e.split("=")[1];return{Authorization:t?"Bearer ".concat(t):""}},o={get:async e=>await fetch(e,{method:"GET",headers:{...a(),"Content-Type":"application/json"}}),post:async(e,r)=>await fetch(e,{method:"POST",headers:{...a(),"Content-Type":"application/json"},body:JSON.stringify(r)}),put:async(e,r)=>await fetch(e,{method:"PUT",headers:{...a(),"Content-Type":"application/json"},body:JSON.stringify(r)}),delete:async e=>await fetch(e,{method:"DELETE",headers:{...a(),"Content-Type":"application/json"}})}},36806:function(e,r,t){"use strict";t(1877)},16297:function(e,r,t){"use strict";t.d(r,{Gm:function(){return d},IO:function(){return f},N2:function(){return m},Q_:function(){return n.obterLabelCategoriaReceita},eW:function(){return h},gZ:function(){return g},lB:function(){return s},vG:function(){return u},vT:function(){return x},zP:function(){return c}});var a=t(64090),o=t(32355),n=t(36806);let i={g:{tipo:"peso",fator:1},kg:{tipo:"peso",fator:1e3},ml:{tipo:"volume",fator:1},l:{tipo:"volume",fator:1e3},un:{tipo:"unidade",fator:1},cx:{tipo:"unidade",fator:1},pct:{tipo:"unidade",fator:1}},c=(e,r,t)=>{let a=i[r],o=i[t];return a&&o&&a.tipo===o.tipo?e*a.fator/o.fator:e},s=async()=>{try{let e=await fetch("/api/fichas-tecnicas",{headers:(0,o.g)()});if(!e.ok)throw Error("Erro ao buscar fichas t\xe9cnicas: ".concat(e.status));return await e.json()}catch(e){return console.error("Error loading fichas t\xe9cnicas:",e),[]}},l=(e,r)=>e.reduce((e,t)=>{var a,o;let n=r.find(e=>e.id===t.produtoId);if(!n)return e;let s=t.unidade||n.unidadeMedida,l=null===(a=i[s])||void 0===a?void 0:a.tipo;if("peso"===l)return e+c(t.quantidade,s,"g");if("volume"===l)return e+c(t.quantidade,s,"ml");{let r=n.pesoEmbalagem||(null===(o=i[n.unidadeMedida])||void 0===o?void 0:o.fator)||1;return e+c(t.quantidade,s,n.unidadeMedida)*r}},0),d=(e,r,t)=>{var a;let o=null===(a=i[r])||void 0===a?void 0:a.tipo;return"peso"===o||"volume"===o?c(l(e,t),"peso"===o?"g":"ml",r):e.reduce((e,a)=>{let o=t.find(e=>e.id===a.produtoId),n=a.unidade||(null==o?void 0:o.unidadeMedida)||"un";return e+c(a.quantidade,n,r)},0)},u=()=>{let[e,r]=(0,a.useState)([]),[t,o]=(0,a.useState)(!1);return{fichasTecnicas:e,isLoading:t,setFichasTecnicas:r,setIsLoading:o,obterFichaTecnicaPorId:r=>e.find(e=>e.id===r),calcularRendimentoTotal:d,atualizarFichaTecnica:p,removerFichaTecnica:m}},f=async e=>{try{let r=await fetch("/api/fichas-tecnicas/".concat(e),{headers:(0,o.g)()});if(!r.ok){if(404===r.status)return null;throw Error("Erro ao buscar ficha t\xe9cnica")}let t=await r.json();return{...t,dataCriacao:t.createdAt?new Date(t.createdAt).toLocaleDateString("pt-BR"):"Data n\xe3o dispon\xedvel",dataModificacao:t.updatedAt?new Date(t.updatedAt).toLocaleDateString("pt-BR"):"Data n\xe3o dispon\xedvel",tempoPreparo:parseInt(t.tempoPreparo)||0,custoTotal:Number(t.custoTotal)||0,custoPorcao:Number(t.custoPorcao)||0,custoPorKg:t.custoTotal&&t.rendimentoTotal?t.custoTotal/t.rendimentoTotal*1e3:0}}catch(e){return console.error("Erro ao buscar ficha t\xe9cnica por ID:",e),null}},h=async e=>{try{let r=await fetch("/api/fichas-tecnicas",{method:"POST",headers:(0,o.g)(),body:JSON.stringify(e)});if(!r.ok){let e=await r.text();throw console.error("Erro na resposta da API:",r.status,e),Error("Erro ao criar ficha t\xe9cnica: ".concat(r.status))}return await r.json()}catch(e){return console.error("Erro ao adicionar ficha t\xe9cnica:",e),null}},p=async(e,r)=>{try{let t=await fetch("/api/fichas-tecnicas/".concat(e),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify(r)});if(!t.ok)throw Error("Erro ao atualizar ficha t\xe9cnica");return await t.json()}catch(e){return console.error("Erro ao atualizar ficha t\xe9cnica:",e),null}},m=async e=>{try{if(!(await fetch("/api/fichas-tecnicas/".concat(e),{method:"DELETE",headers:(0,o.g)()})).ok)throw Error("Erro ao deletar ficha t\xe9cnica");return!0}catch(e){return console.error("Erro ao remover ficha t\xe9cnica:",e),!1}},g=[{value:"porcoes",label:"Por\xe7\xf5es"},{value:"unidades",label:"Unidades"},{value:"kg",label:"Quilogramas (kg)"},{value:"g",label:"Gramas (g)"},{value:"l",label:"Litros (l)"},{value:"ml",label:"Mililitros (ml)"}],x=e=>{let r=g.find(r=>r.value===e);return r?r.label:e}},81462:function(e,r,t){"use strict";t.d(r,{G:function(){return l}});var a=t(64090),o=t(16297),n=t(32355);let i=async()=>{try{let e=await fetch("/api/producao",{headers:(0,n.g)()});if(!e.ok)throw Error("Erro ao buscar produ\xe7\xf5es");return(await e.json()).map(e=>({custoTotal:0,custoUnitario:0,validade:"",...e}))}catch(e){return console.error("Erro ao buscar produ\xe7\xf5es da API:",e),[]}},c=async(e,r)=>e.map(e=>s(e,r)),s=(e,r)=>{let t=r.find(r=>r.id===e.fichaId);if(!t)return e;let a=(0,o.zP)(e.quantidadeTotal,e.unidadeQuantidade,"g"),n=(0,o.zP)(t.rendimentoTotal,t.unidadeRendimento,"g"),i=(0,o.zP)(e.pesoUnitario,e.unidadePeso,"g"),c=i?Math.round(a/i):e.unidadesGeradas,s=t.custoTotal*(n?a/n:0);return{...e,unidadesGeradas:c,custoTotal:s,custoUnitario:c?s/c:0}},l=()=>{let{fichasTecnicas:e}=(0,o.vG)(),[r,t]=(0,a.useState)([]);(0,a.useEffect)(()=>{(async()=>{let r=await i(),a=e.length?e:await (0,o.lB)();t(await c(r,a))})()},[]),(0,a.useEffect)(()=>{(async()=>{r.length&&t(await c(r,e))})()},[e]);let s=async e=>{try{let a=await fetch("/api/producao",{method:"POST",headers:(0,n.g)(),body:JSON.stringify(e)});if(!a.ok)throw Error("Erro ao registrar produ\xe7\xe3o");let o=await a.json(),i=[...r,o];return t(i),o}catch(e){return console.error("Erro ao registrar produ\xe7\xe3o:",e),null}},l=async(e,a)=>{try{let o=await fetch("/api/producao/".concat(e),{method:"PUT",headers:(0,n.g)(),body:JSON.stringify(a)});if(!o.ok)throw Error("Erro ao atualizar produ\xe7\xe3o");let i=await o.json(),c=r.map(r=>r.id===e?i:r);return t(c),i}catch(e){return console.error("Erro ao atualizar produ\xe7\xe3o:",e),null}},d=async e=>{try{if(!(await fetch("/api/producao/".concat(e),{method:"DELETE",headers:(0,n.g)()})).ok)throw Error("Erro ao deletar produ\xe7\xe3o");let a=r.filter(r=>r.id!==e);return t(a),!0}catch(e){return console.error("Erro ao remover produ\xe7\xe3o:",e),!1}};return{producoes:r,registrarProducao:s,atualizarProducao:l,removerProducao:d}}},1877:function(e,r,t){"use strict";(0,t(33837).createBrowserClient)("https://sutmfzcmrlqnocsusiav.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1dG1memNtcmxxbm9jc3VzaWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1MzgwODMsImV4cCI6MjA2NjExNDA4M30.BQRo64qRNzqB_XGNeSe4jkZ8Mzzji8eUYVbS_nWw8tI")},22169:function(e,r,t){"use strict";t.d(r,{cn:function(){return n}});var a=t(75504),o=t(51367);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,o.m6)((0,a.W)(r))}}},function(e){e.O(0,[7176,869,3837,2971,8069,1744],function(){return e(e.s=76071)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2584],{96070:function(e,a,n){Promise.resolve().then(n.bind(n,23823))},23823:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return b}});var r=n(3827),d=n(64090),i=n(47907),o=n(57418),t=n(32278),l=n(79173),s=n(14706),u=n(66651),c=n(16297),m=n(36806),p=n(27742),h=n(18061),g=n(20200),x=n(70492),f=n(93242);function b(){let e=(0,i.useRouter)(),{produtos:a}=(0,p.U)(),{unidades:n}=(0,h.x)(),{categorias:b}=(0,m.useCategoriasReceita)(),[v,j]=(0,d.useState)(!1),[C,N]=(0,d.useState)(""),{isOpen:P,openModal:y,closeModal:I}=(0,x.d)(),[q,R]=(0,d.useState)({produtoId:"",quantidade:"",unidade:""}),[T,Z]=(0,d.useState)({nome:"",descricao:"",categoria:"",ingredientes:[],modoPreparo:"",tempoPreparo:"",rendimentoTotal:"",unidadeRendimento:"",observacoes:""}),k=(e,a,n)=>{if(!e.length||!a||!n.length)return 0;let r=e.reduce((e,a)=>{let r=n.find(e=>e.id===a.produtoId);if(!r)return e;let d=Number(a.quantidade)||0,i=0;return"kg"===a.unidade?i=1e3*d:"g"===a.unidade?i=d:"l"===a.unidade?i=1e3*d:"ml"===a.unidade?i=d:"unidade"===a.unidade&&(i=d*(r.pesoEmbalagem||0)),e+i},0);return"porcoes"===a?Math.floor(r/150):"kg"===a?r/1e3:"g"===a?r:"l"===a?r/1e3:"ml"===a?r:"unidades"===a?Math.floor(r/100):0};(0,d.useEffect)(()=>{if(!T.unidadeRendimento||0===a.length)return;let e=k(T.ingredientes,T.unidadeRendimento,a);Z(a=>({...a,rendimentoTotal:e?e.toString():"0"}))},[T.ingredientes,T.unidadeRendimento,a]);let[E,S]=(0,d.useState)({});(0,d.useEffect)(()=>{if(!C)return;let e=setTimeout(()=>N(""),3e3);return()=>clearTimeout(e)},[C]);let O=e=>{let{name:a,value:n}=e.target;Z(e=>({...e,[a]:n}))},M=e=>{let{name:n,value:r}=e.target;R(e=>{let d={...e,[n]:r};if("produtoId"===n){let e=a.find(e=>e.id===r);e&&(d.unidade=e.unidadeMedida)}return d})},w=e=>{Z(a=>({...a,ingredientes:a.ingredientes.filter((a,n)=>n!==e)}))},A=()=>{let e={};return T.nome||(e.nome="Nome \xe9 obrigat\xf3rio"),T.categoria||(e.categoria="Categoria \xe9 obrigat\xf3ria"),T.modoPreparo||(e.modoPreparo="Modo de preparo \xe9 obrigat\xf3rio"),T.tempoPreparo?(isNaN(Number(T.tempoPreparo))||0>=Number(T.tempoPreparo))&&(e.tempoPreparo="Tempo de preparo deve ser um n\xfamero positivo"):e.tempoPreparo="Tempo de preparo \xe9 obrigat\xf3rio",T.unidadeRendimento||(e.unidadeRendimento="Unidade de rendimento \xe9 obrigat\xf3ria"),0===T.ingredientes.length&&(e.ingredientes="Adicione pelo menos um ingrediente"),S(e),0===Object.keys(e).length},_=async a=>{if(a.preventDefault(),A()){j(!0);try{let a={...T,tempoPreparo:String(T.tempoPreparo),rendimentoTotal:Number(T.rendimentoTotal)};await (0,c.eW)(a)?(N("Ficha t\xe9cnica criada com sucesso!"),setTimeout(()=>{e.push("/fichas-tecnicas")},1500)):N("Erro ao salvar ficha t\xe9cnica")}catch(e){console.error("Erro ao salvar ficha t\xe9cnica:",e),N("Erro ao salvar ficha t\xe9cnica")}finally{j(!1)}}},D=e=>{let n=a.find(a=>a.id===e);return n?n.nome:"Produto n\xe3o encontrado"},F=(e,a)=>{var r;let d=(null===(r=n.find(a=>a.id===e))||void 0===r?void 0:r.id)||e;return"".concat(a," ").concat(d)};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(f.Z,{message:C,onClose:()=>N("")}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Nova Ficha T\xe9cnica"}),(0,r.jsx)("form",{onSubmit:_,children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(o.Z,{title:"Informa\xe7\xf5es B\xe1sicas",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsx)(t.default,{label:"Nome da Receita *",name:"nome",value:T.nome,onChange:O,error:E.nome,placeholder:"Ex: Risoto de Cogumelos"}),(0,r.jsx)(l.Z,{label:"Categoria *",name:"categoria",value:T.categoria,onChange:O,options:b.map(e=>({value:e.id,label:e.nome})).sort((e,a)=>e.label.localeCompare(a.label)),error:E.categoria})]}),(0,r.jsx)(s.Z,{label:"Descri\xe7\xe3o",name:"descricao",value:T.descricao,onChange:O,placeholder:"Breve descri\xe7\xe3o da receita",rows:2}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsx)(t.default,{label:"Tempo de Preparo (minutos) *",name:"tempoPreparo",type:"number",min:"1",value:T.tempoPreparo,onChange:O,error:E.tempoPreparo,placeholder:"Ex: 45"}),(0,r.jsx)(t.default,{label:"Rendimento Total",name:"rendimentoTotal",type:"number",readOnly:!0,value:T.rendimentoTotal}),(0,r.jsx)(l.Z,{label:"Unidade de Rendimento *",name:"unidadeRendimento",value:T.unidadeRendimento,onChange:O,options:c.gZ,error:E.unidadeRendimento})]})]})}),(0,r.jsx)(o.Z,{title:"Ingredientes",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsxs)(u.default,{type:"button",variant:"outline",onClick:y,children:[(0,r.jsx)("span",{className:"material-icons mr-1 text-sm",children:"add"}),"Adicionar Ingrediente"]})}),E.ingredientes&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:E.ingredientes}),(0,r.jsx)(g.ZP,{headers:["Produto","Quantidade","A\xe7\xf5es"],emptyMessage:"Nenhum ingrediente adicionado. Clique em 'Adicionar Ingrediente'.",children:T.ingredientes.map((e,a)=>(0,r.jsxs)(g.SC,{children:[(0,r.jsx)(g.pj,{children:D(e.produtoId)}),(0,r.jsx)(g.pj,{children:F(e.unidade,e.quantidade)}),(0,r.jsx)(g.pj,{children:(0,r.jsx)(u.default,{variant:"outline",size:"sm",onClick:()=>w(a),children:(0,r.jsx)("span",{className:"material-icons text-sm text-red-500",children:"delete"})})})]},a))})]})}),(0,r.jsx)(o.Z,{title:"Modo de Preparo",children:(0,r.jsx)(s.Z,{label:"Instru\xe7\xf5es de Preparo *",name:"modoPreparo",value:T.modoPreparo,onChange:O,error:E.modoPreparo,placeholder:"Descreva passo a passo como preparar a receita",rows:6})}),(0,r.jsx)(o.Z,{title:"Observa\xe7\xf5es",children:(0,r.jsx)(s.Z,{label:"Observa\xe7\xf5es ou Dicas do Chef",name:"observacoes",value:T.observacoes,onChange:O,placeholder:"Dicas, varia\xe7\xf5es ou informa\xe7\xf5es adicionais sobre a receita",rows:4})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)(u.default,{type:"button",variant:"outline",onClick:()=>e.push("/fichas-tecnicas"),children:"Cancelar"}),(0,r.jsx)(u.default,{type:"submit",variant:"primary",isLoading:v,children:"Salvar Ficha T\xe9cnica"})]})]})}),(0,r.jsx)(x.Z,{isOpen:P,onClose:I,title:"Adicionar Ingrediente",footer:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.default,{variant:"outline",onClick:I,children:"Cancelar"}),(0,r.jsx)(u.default,{variant:"primary",onClick:()=>{let e={};if(q.produtoId||(e.produtoId="Selecione um produto"),q.quantidade?(isNaN(Number(q.quantidade))||0>=Number(q.quantidade))&&(e.quantidade="Quantidade deve ser um n\xfamero positivo"):e.quantidade="Quantidade \xe9 obrigat\xf3ria",q.unidade||(e.unidade="Selecione a unidade"),Object.keys(e).length>0){S(a=>({...a,...e}));return}let a={produtoId:q.produtoId,quantidade:Number(q.quantidade),unidade:q.unidade};Z(e=>({...e,ingredientes:[...e.ingredientes,a]})),R({produtoId:"",quantidade:"",unidade:""}),S(e=>{let a={...e};return delete a.produtoId,delete a.quantidade,delete a.unidade,a}),I()},children:"Adicionar"})]}),children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(l.Z,{label:"Produto *",name:"produtoId",value:q.produtoId,onChange:M,error:E.produtoId,options:a.map(e=>({value:e.id,label:"".concat(e.nome," (").concat(e.unidadeMedida,")")})).sort((e,a)=>e.label.localeCompare(a.label))}),(0,r.jsx)(t.default,{label:"Quantidade *",name:"quantidade",type:"number",min:"0.1",step:"0.1",value:q.quantidade,onChange:M,error:E.quantidade,placeholder:"Ex: 250"}),(0,r.jsx)(l.Z,{label:"Unidade *",name:"unidade",value:q.unidade,onChange:M,error:E.unidade,options:n.map(e=>({value:e.id,label:e.nome})).sort((e,a)=>e.label.localeCompare(a.label))})]})})]})}}},function(e){e.O(0,[7176,869,3837,7074,2971,8069,1744],function(){return e(e.s=96070)}),_N_E=e.O()}]);
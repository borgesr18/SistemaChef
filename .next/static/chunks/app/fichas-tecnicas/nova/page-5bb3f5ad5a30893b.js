(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[584],{96070:function(e,a,n){Promise.resolve().then(n.bind(n,23823))},23823:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return v}});var r=n(3827),i=n(64090),d=n(47907),o=n(57418),t=n(32278),s=n(79173),l=n(14706),c=n(66651),u=n(16297),m=n(36806),p=n(27742),h=n(18061),g=n(20200),x=n(70492),b=n(93242);function v(){let e=(0,d.useRouter)(),{produtos:a}=(0,p.Ug)(),{unidades:n}=(0,h.x)(),{categorias:v}=(0,m.O)(),[j,f]=(0,i.useState)(!1),[N,C]=(0,i.useState)(""),{isOpen:P,openModal:Z,closeModal:y}=(0,x.d)(),[I,q]=(0,i.useState)({produtoId:"",quantidade:"",unidade:""}),[T,R]=(0,i.useState)({nome:"",descricao:"",categoria:"",ingredientes:[],modoPreparo:"",tempoPreparo:"",rendimentoTotal:"",unidadeRendimento:"",observacoes:""}),k=(e,a,n)=>{if(!e.length||!a||!n.length)return 0;let r=e.reduce((e,a)=>{let r=n.find(e=>e.id===a.produtoId);if(!r)return e;let i=Number(a.quantidade)||0,d=0;return"kg"===a.unidade?d=1e3*i:"g"===a.unidade?d=i:"l"===a.unidade?d=1e3*i:"ml"===a.unidade?d=i:"unidade"===a.unidade&&(d=i*(r.pesoEmbalagem||0)),e+d},0);return"porcoes"===a?Math.floor(r/150):"kg"===a?r/1e3:"g"===a?r:"l"===a?r/1e3:"ml"===a?r:"unidades"===a?Math.floor(r/100):0};(0,i.useEffect)(()=>{if(!T.unidadeRendimento||0===a.length)return;let e=k(T.ingredientes,T.unidadeRendimento,a);R(a=>({...a,rendimentoTotal:e?e.toString():"0"}))},[T.ingredientes,T.unidadeRendimento,a]);let[E,S]=(0,i.useState)({});(0,i.useEffect)(()=>{if(!N)return;let e=setTimeout(()=>C(""),3e3);return()=>clearTimeout(e)},[N]);let O=e=>{let{name:a,value:n}=e.target;R(e=>({...e,[a]:n}))},M=e=>{let{name:n,value:r}=e.target;q(e=>{let i={...e,[n]:r};if("produtoId"===n){let e=a.find(e=>e.id===r);e&&(i.unidade=e.unidadeMedida)}return i})},w=e=>{R(a=>({...a,ingredientes:a.ingredientes.filter((a,n)=>n!==e)}))},A=()=>{let e={};return T.nome||(e.nome="Nome \xe9 obrigat\xf3rio"),T.categoria||(e.categoria="Categoria \xe9 obrigat\xf3ria"),T.modoPreparo||(e.modoPreparo="Modo de preparo \xe9 obrigat\xf3rio"),T.tempoPreparo?(isNaN(Number(T.tempoPreparo))||0>=Number(T.tempoPreparo))&&(e.tempoPreparo="Tempo de preparo deve ser um n\xfamero positivo"):e.tempoPreparo="Tempo de preparo \xe9 obrigat\xf3rio",T.unidadeRendimento||(e.unidadeRendimento="Unidade de rendimento \xe9 obrigat\xf3ria"),0===T.ingredientes.length&&(e.ingredientes="Adicione pelo menos um ingrediente"),S(e),0===Object.keys(e).length},_=async a=>{if(a.preventDefault(),A()){f(!0);try{let a={...T,tempoPreparo:String(T.tempoPreparo),rendimentoTotal:Number(T.rendimentoTotal)};await (0,u.eW)(a)?(C("Ficha t\xe9cnica criada com sucesso!"),setTimeout(()=>{e.push("/fichas-tecnicas")},1500)):C("Erro ao salvar ficha t\xe9cnica")}catch(e){console.error("Erro ao salvar ficha t\xe9cnica:",e),C("Erro ao salvar ficha t\xe9cnica")}finally{f(!1)}}},D=e=>{let n=a.find(a=>a.id===e);return n?n.nome:"Produto n\xe3o encontrado"},F=(e,a)=>{var r;let i=(null===(r=n.find(a=>a.id===e))||void 0===r?void 0:r.id)||e;return"".concat(a," ").concat(i)};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(b.Z,{message:N,onClose:()=>C("")}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Nova Ficha T\xe9cnica"}),(0,r.jsx)("form",{onSubmit:_,children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(o.Z,{title:"Informa\xe7\xf5es B\xe1sicas",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsx)(t.Z,{label:"Nome da Receita *",name:"nome",value:T.nome,onChange:O,error:E.nome,placeholder:"Ex: Risoto de Cogumelos"}),(0,r.jsx)(s.Z,{label:"Categoria *",name:"categoria",value:T.categoria,onChange:O,options:v.map(e=>({value:e.id,label:e.nome})).sort((e,a)=>e.label.localeCompare(a.label)),error:E.categoria})]}),(0,r.jsx)(l.Z,{label:"Descri\xe7\xe3o",name:"descricao",value:T.descricao,onChange:O,placeholder:"Breve descri\xe7\xe3o da receita",rows:2}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsx)(t.Z,{label:"Tempo de Preparo (minutos) *",name:"tempoPreparo",type:"number",min:"1",value:T.tempoPreparo,onChange:O,error:E.tempoPreparo,placeholder:"Ex: 45"}),(0,r.jsx)(t.Z,{label:"Rendimento Total",name:"rendimentoTotal",type:"number",readOnly:!0,value:T.rendimentoTotal}),(0,r.jsx)(s.Z,{label:"Unidade de Rendimento *",name:"unidadeRendimento",value:T.unidadeRendimento,onChange:O,options:u.gZ,error:E.unidadeRendimento})]})]})}),(0,r.jsx)(o.Z,{title:"Ingredientes",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsxs)(c.Z,{type:"button",variant:"outline",onClick:Z,children:[(0,r.jsx)("span",{className:"material-icons mr-1 text-sm",children:"add"}),"Adicionar Ingrediente"]})}),E.ingredientes&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:E.ingredientes}),(0,r.jsx)(g.ZP,{headers:["Produto","Quantidade","A\xe7\xf5es"],emptyMessage:"Nenhum ingrediente adicionado. Clique em 'Adicionar Ingrediente'.",children:T.ingredientes.map((e,a)=>(0,r.jsxs)(g.SC,{children:[(0,r.jsx)(g.pj,{children:D(e.produtoId)}),(0,r.jsx)(g.pj,{children:F(e.unidade,e.quantidade)}),(0,r.jsx)(g.pj,{children:(0,r.jsx)(c.Z,{variant:"outline",size:"sm",onClick:()=>w(a),children:(0,r.jsx)("span",{className:"material-icons text-sm text-red-500",children:"delete"})})})]},a))})]})}),(0,r.jsx)(o.Z,{title:"Modo de Preparo",children:(0,r.jsx)(l.Z,{label:"Instru\xe7\xf5es de Preparo *",name:"modoPreparo",value:T.modoPreparo,onChange:O,error:E.modoPreparo,placeholder:"Descreva passo a passo como preparar a receita",rows:6})}),(0,r.jsx)(o.Z,{title:"Observa\xe7\xf5es",children:(0,r.jsx)(l.Z,{label:"Observa\xe7\xf5es ou Dicas do Chef",name:"observacoes",value:T.observacoes,onChange:O,placeholder:"Dicas, varia\xe7\xf5es ou informa\xe7\xf5es adicionais sobre a receita",rows:4})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)(c.Z,{type:"button",variant:"outline",onClick:()=>e.push("/fichas-tecnicas"),children:"Cancelar"}),(0,r.jsx)(c.Z,{type:"submit",variant:"primary",isLoading:j,children:"Salvar Ficha T\xe9cnica"})]})]})}),(0,r.jsx)(x.Z,{isOpen:P,onClose:y,title:"Adicionar Ingrediente",footer:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{variant:"outline",onClick:y,children:"Cancelar"}),(0,r.jsx)(c.Z,{variant:"primary",onClick:()=>{let e={};if(I.produtoId||(e.produtoId="Selecione um produto"),I.quantidade?(isNaN(Number(I.quantidade))||0>=Number(I.quantidade))&&(e.quantidade="Quantidade deve ser um n\xfamero positivo"):e.quantidade="Quantidade \xe9 obrigat\xf3ria",I.unidade||(e.unidade="Selecione a unidade"),Object.keys(e).length>0){S(a=>({...a,...e}));return}let a={produtoId:I.produtoId,quantidade:Number(I.quantidade),unidade:I.unidade};R(e=>({...e,ingredientes:[...e.ingredientes,a]})),q({produtoId:"",quantidade:"",unidade:""}),S(e=>{let a={...e};return delete a.produtoId,delete a.quantidade,delete a.unidade,a}),y()},children:"Adicionar"})]}),children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(s.Z,{label:"Produto *",name:"produtoId",value:I.produtoId,onChange:M,error:E.produtoId,options:a.map(e=>({value:e.id,label:"".concat(e.nome," (").concat(e.unidadeMedida,")")})).sort((e,a)=>e.label.localeCompare(a.label))}),(0,r.jsx)(t.Z,{label:"Quantidade *",name:"quantidade",type:"number",min:"0.1",step:"0.1",value:I.quantidade,onChange:M,error:E.quantidade,placeholder:"Ex: 250"}),(0,r.jsx)(s.Z,{label:"Unidade *",name:"unidade",value:I.unidade,onChange:M,error:E.unidade,options:n.map(e=>({value:e.id,label:e.nome})).sort((e,a)=>e.label.localeCompare(a.label))})]})})]})}}},function(e){e.O(0,[249,613,971,69,744],function(){return e(e.s=96070)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1072],{94993:function(e,a,n){Promise.resolve().then(n.bind(n,70012))},70012:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return f}});var r=n(3827),d=n(64090),i=n(47907),o=n(57418),t=n(32278),s=n(79173),l=n(14706),u=n(66651),c=n(16297),m=n(36806),p=n(27742),g=n(18061),h=n(20200),x=n(70492),v=n(93242);function f(){let e=(0,i.useParams)(),a=(0,i.useRouter)(),{obterFichaTecnicaPorId:n,atualizarFichaTecnica:f,isLoading:b}=(0,c.vG)(),{produtos:j}=(0,p.U)(),{unidades:C}=(0,g.x)(),{categorias:N}=(0,m.useCategoriasReceita)(),[P,y]=(0,d.useState)(!1),[I,q]=(0,d.useState)(""),R=e.id,T=n(R);(0,d.useEffect)(()=>{b||T||a.push("/fichas-tecnicas")},[b,T,a]);let{isOpen:Z,openModal:E,closeModal:S}=(0,x.d)(),[k,O]=(0,d.useState)({produtoId:"",quantidade:"",unidade:""}),[A,M]=(0,d.useState)({nome:"",descricao:"",categoria:"",ingredientes:[],modoPreparo:"",tempoPreparo:"",rendimentoTotal:"",unidadeRendimento:"",observacoes:""}),[_,w]=(0,d.useState)({});if((0,d.useEffect)(()=>{if(!I)return;let e=setTimeout(()=>q(""),3e3);return()=>clearTimeout(e)},[I]),(0,d.useEffect)(()=>{if(!A.unidadeRendimento)return;let e=(0,c.Gm)(A.ingredientes,A.unidadeRendimento);M(a=>({...a,rendimentoTotal:e?e.toString():"0"}))},[A.ingredientes,A.unidadeRendimento]),(0,d.useEffect)(()=>{if(!b&&T){var e,a;M({nome:T.nome,descricao:T.descricao||"",categoria:T.categoria,ingredientes:T.ingredientes.map(e=>{var a;return{produtoId:e.produtoId,quantidade:e.quantidade,unidade:e.unidade||(null===(a=j.find(a=>a.id===e.produtoId))||void 0===a?void 0:a.unidadeMedida)||""}}),modoPreparo:T.modoPreparo,tempoPreparo:(null===(e=T.tempoPreparo)||void 0===e?void 0:e.toString())||"",rendimentoTotal:(null===(a=T.rendimentoTotal)||void 0===a?void 0:a.toString())||"",unidadeRendimento:T.unidadeRendimento,observacoes:T.observacoes||""})}},[b,T]),b)return(0,r.jsx)("p",{children:"Carregando..."});if(!T)return null;let D=e=>{let{name:a,value:n}=e.target;M(e=>({...e,[a]:n}))},z=e=>{let{name:a,value:n}=e.target;O(e=>{let r={...e,[a]:n};if("produtoId"===a){let e=j.find(e=>e.id===n);e&&(r.unidade=e.unidadeMedida)}return r})},Q=e=>{M(a=>({...a,ingredientes:a.ingredientes.filter((a,n)=>n!==e)}))},U=()=>{let e={};return A.nome||(e.nome="Nome \xe9 obrigat\xf3rio"),A.categoria||(e.categoria="Categoria \xe9 obrigat\xf3ria"),A.modoPreparo||(e.modoPreparo="Modo de preparo \xe9 obrigat\xf3rio"),A.tempoPreparo?(isNaN(Number(A.tempoPreparo))||0>=Number(A.tempoPreparo))&&(e.tempoPreparo="Tempo de preparo deve ser um n\xfamero positivo"):e.tempoPreparo="Tempo de preparo \xe9 obrigat\xf3rio",A.unidadeRendimento||(e.unidadeRendimento="Unidade de rendimento \xe9 obrigat\xf3ria"),0===A.ingredientes.length&&(e.ingredientes="Adicione pelo menos um ingrediente"),w(e),0===Object.keys(e).length},F=e=>{let a=j.find(a=>a.id===e);return a?a.nome:"Produto n\xe3o encontrado"},B=(e,a)=>{var n;let r=(null===(n=C.find(a=>a.id===e))||void 0===n?void 0:n.id)||e;return"".concat(a," ").concat(r)};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(v.Z,{message:I,onClose:()=>q("")}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Editar Ficha T\xe9cnica"}),(0,r.jsx)("form",{onSubmit:e=>{if(e.preventDefault(),U()){y(!0);try{let e={...A,tempoPreparo:Number(A.tempoPreparo),rendimentoTotal:Number(A.rendimentoTotal)};f(R,e),a.push("/fichas-tecnicas/".concat(R))}catch(e){console.error("Erro ao atualizar ficha t\xe9cnica:",e),q("Erro ao atualizar ficha t\xe9cnica")}finally{y(!1)}}},children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(o.Z,{title:"Informa\xe7\xf5es B\xe1sicas",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsx)(t.default,{label:"Nome da Receita *",name:"nome",value:A.nome,onChange:D,error:_.nome,placeholder:"Ex: Risoto de Cogumelos"}),(0,r.jsx)(s.Z,{label:"Categoria *",name:"categoria",value:A.categoria,onChange:D,options:N.map(e=>({value:e.id,label:e.nome})).sort((e,a)=>e.label.localeCompare(a.label)),error:_.categoria})]}),(0,r.jsx)(l.Z,{label:"Descri\xe7\xe3o",name:"descricao",value:A.descricao,onChange:D,placeholder:"Breve descri\xe7\xe3o da receita",rows:2}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsx)(t.default,{label:"Tempo de Preparo (minutos) *",name:"tempoPreparo",type:"number",min:"1",value:A.tempoPreparo,onChange:D,error:_.tempoPreparo,placeholder:"Ex: 45"}),(0,r.jsx)(t.default,{label:"Rendimento Total",name:"rendimentoTotal",type:"number",readOnly:!0,value:A.rendimentoTotal}),(0,r.jsx)(s.Z,{label:"Unidade de Rendimento *",name:"unidadeRendimento",value:A.unidadeRendimento,onChange:D,options:c.gZ,error:_.unidadeRendimento})]})]})}),(0,r.jsx)(o.Z,{title:"Ingredientes",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsxs)(u.default,{type:"button",variant:"outline",onClick:E,children:[(0,r.jsx)("span",{className:"material-icons mr-1 text-sm",children:"add"}),"Adicionar Ingrediente"]})}),_.ingredientes&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:_.ingredientes}),(0,r.jsx)(h.ZP,{headers:["Produto","Quantidade","A\xe7\xf5es"],emptyMessage:"Nenhum ingrediente adicionado. Clique em 'Adicionar Ingrediente'.",children:A.ingredientes.map((e,a)=>(0,r.jsxs)(h.SC,{children:[(0,r.jsx)(h.pj,{children:F(e.produtoId)}),(0,r.jsx)(h.pj,{children:B(e.unidade,e.quantidade)}),(0,r.jsx)(h.pj,{children:(0,r.jsx)(u.default,{variant:"outline",size:"sm",onClick:()=>Q(a),children:(0,r.jsx)("span",{className:"material-icons text-sm text-red-500",children:"delete"})})})]},a))})]})}),(0,r.jsx)(o.Z,{title:"Modo de Preparo",children:(0,r.jsx)(l.Z,{label:"Instru\xe7\xf5es de Preparo *",name:"modoPreparo",value:A.modoPreparo,onChange:D,error:_.modoPreparo,placeholder:"Descreva passo a passo como preparar a receita",rows:6})}),(0,r.jsx)(o.Z,{title:"Observa\xe7\xf5es",children:(0,r.jsx)(l.Z,{label:"Observa\xe7\xf5es ou Dicas do Chef",name:"observacoes",value:A.observacoes,onChange:D,placeholder:"Dicas, varia\xe7\xf5es ou informa\xe7\xf5es adicionais sobre a receita",rows:4})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)(u.default,{type:"button",variant:"outline",onClick:()=>a.push("/fichas-tecnicas/".concat(R)),children:"Cancelar"}),(0,r.jsx)(u.default,{type:"submit",variant:"primary",isLoading:P,children:"Atualizar Ficha T\xe9cnica"})]})]})}),(0,r.jsx)(x.Z,{isOpen:Z,onClose:S,title:"Adicionar Ingrediente",footer:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.default,{variant:"outline",onClick:S,children:"Cancelar"}),(0,r.jsx)(u.default,{variant:"primary",onClick:()=>{let e={};if(k.produtoId||(e.produtoId="Selecione um produto"),k.quantidade?(isNaN(Number(k.quantidade))||0>=Number(k.quantidade))&&(e.quantidade="Quantidade deve ser um n\xfamero positivo"):e.quantidade="Quantidade \xe9 obrigat\xf3ria",k.unidade||(e.unidade="Selecione a unidade"),Object.keys(e).length>0){w(a=>({...a,...e}));return}let a={produtoId:k.produtoId,quantidade:Number(k.quantidade),unidade:k.unidade};M(e=>({...e,ingredientes:[...e.ingredientes,a]})),O({produtoId:"",quantidade:"",unidade:""}),w(e=>{let a={...e};return delete a.produtoId,delete a.quantidade,delete a.unidade,a}),S()},children:"Adicionar"})]}),children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(s.Z,{label:"Produto *",name:"produtoId",value:k.produtoId,onChange:z,error:_.produtoId,options:j.map(e=>({value:e.id,label:"".concat(e.nome," (").concat(e.unidadeMedida,")")})).sort((e,a)=>e.label.localeCompare(a.label))}),(0,r.jsx)(t.default,{label:"Quantidade *",name:"quantidade",type:"number",min:"0.1",step:"0.1",value:k.quantidade,onChange:z,error:_.quantidade,placeholder:"Ex: 250"}),(0,r.jsx)(s.Z,{label:"Unidade *",name:"unidade",value:k.unidade,onChange:z,error:_.unidade,options:C.map(e=>({value:e.id,label:e.nome})).sort((e,a)=>e.label.localeCompare(a.label))})]})})]})}}},function(e){e.O(0,[7176,869,3837,7074,2971,8069,1744],function(){return e(e.s=94993)}),_N_E=e.O()}]);
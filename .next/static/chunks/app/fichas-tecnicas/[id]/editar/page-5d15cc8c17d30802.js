(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72],{94993:function(e,a,n){Promise.resolve().then(n.bind(n,70012))},70012:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return b}});var r=n(3827),i=n(64090),o=n(47907),d=n(57418),t=n(32278),s=n(79173),l=n(14706),c=n(66651),u=n(16297),m=n(36806),p=n(27742),g=n(18061),h=n(20200),x=n(70492),v=n(93242);function b(){let e=(0,o.useParams)(),a=(0,o.useRouter)(),{obterFichaTecnicaPorId:n,atualizarFichaTecnica:b,isLoading:j}=(0,u.vG)(),{produtos:f}=(0,p.Ug)(),{unidades:C}=(0,g.x)(),{categorias:N}=(0,m.O)(),[P,Z]=(0,i.useState)(!1),[y,I]=(0,i.useState)(""),q=e.id,R=n(q);(0,i.useEffect)(()=>{j||R||a.push("/fichas-tecnicas")},[j,R,a]);let{isOpen:T,openModal:E,closeModal:S}=(0,x.d)(),[k,O]=(0,i.useState)({produtoId:"",quantidade:"",unidade:""}),[A,M]=(0,i.useState)({nome:"",descricao:"",categoria:"",ingredientes:[],modoPreparo:"",tempoPreparo:"",rendimentoTotal:"",unidadeRendimento:"",observacoes:""}),[_,w]=(0,i.useState)({});if((0,i.useEffect)(()=>{if(!y)return;let e=setTimeout(()=>I(""),3e3);return()=>clearTimeout(e)},[y]),(0,i.useEffect)(()=>{if(!A.unidadeRendimento)return;let e=(0,u.Gm)(A.ingredientes,A.unidadeRendimento);M(a=>({...a,rendimentoTotal:e?e.toString():"0"}))},[A.ingredientes,A.unidadeRendimento]),(0,i.useEffect)(()=>{if(!j&&R){var e,a;M({nome:R.nome,descricao:R.descricao||"",categoria:R.categoria,ingredientes:R.ingredientes.map(e=>{var a;return{produtoId:e.produtoId,quantidade:e.quantidade,unidade:e.unidade||(null===(a=f.find(a=>a.id===e.produtoId))||void 0===a?void 0:a.unidadeMedida)||""}}),modoPreparo:R.modoPreparo,tempoPreparo:(null===(e=R.tempoPreparo)||void 0===e?void 0:e.toString())||"",rendimentoTotal:(null===(a=R.rendimentoTotal)||void 0===a?void 0:a.toString())||"",unidadeRendimento:R.unidadeRendimento,observacoes:R.observacoes||""})}},[j,R]),j)return(0,r.jsx)("p",{children:"Carregando..."});if(!R)return null;let D=e=>{let{name:a,value:n}=e.target;M(e=>({...e,[a]:n}))},z=e=>{let{name:a,value:n}=e.target;O(e=>{let r={...e,[a]:n};if("produtoId"===a){let e=f.find(e=>e.id===n);e&&(r.unidade=e.unidadeMedida)}return r})},Q=e=>{M(a=>({...a,ingredientes:a.ingredientes.filter((a,n)=>n!==e)}))},U=()=>{let e={};return A.nome||(e.nome="Nome \xe9 obrigat\xf3rio"),A.categoria||(e.categoria="Categoria \xe9 obrigat\xf3ria"),A.modoPreparo||(e.modoPreparo="Modo de preparo \xe9 obrigat\xf3rio"),A.tempoPreparo?(isNaN(Number(A.tempoPreparo))||0>=Number(A.tempoPreparo))&&(e.tempoPreparo="Tempo de preparo deve ser um n\xfamero positivo"):e.tempoPreparo="Tempo de preparo \xe9 obrigat\xf3rio",A.unidadeRendimento||(e.unidadeRendimento="Unidade de rendimento \xe9 obrigat\xf3ria"),0===A.ingredientes.length&&(e.ingredientes="Adicione pelo menos um ingrediente"),w(e),0===Object.keys(e).length},F=e=>{let a=f.find(a=>a.id===e);return a?a.nome:"Produto n\xe3o encontrado"},B=(e,a)=>{var n;let r=(null===(n=C.find(a=>a.id===e))||void 0===n?void 0:n.id)||e;return"".concat(a," ").concat(r)};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(v.Z,{message:y,onClose:()=>I("")}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Editar Ficha T\xe9cnica"}),(0,r.jsx)("form",{onSubmit:e=>{if(e.preventDefault(),U()){Z(!0);try{let e={...A,tempoPreparo:Number(A.tempoPreparo),rendimentoTotal:Number(A.rendimentoTotal)};b(q,e),a.push("/fichas-tecnicas/".concat(q))}catch(e){console.error("Erro ao atualizar ficha t\xe9cnica:",e),I("Erro ao atualizar ficha t\xe9cnica")}finally{Z(!1)}}},children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(d.Z,{title:"Informa\xe7\xf5es B\xe1sicas",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsx)(t.Z,{label:"Nome da Receita *",name:"nome",value:A.nome,onChange:D,error:_.nome,placeholder:"Ex: Risoto de Cogumelos"}),(0,r.jsx)(s.Z,{label:"Categoria *",name:"categoria",value:A.categoria,onChange:D,options:N.map(e=>({value:e.id,label:e.nome})).sort((e,a)=>e.label.localeCompare(a.label)),error:_.categoria})]}),(0,r.jsx)(l.Z,{label:"Descri\xe7\xe3o",name:"descricao",value:A.descricao,onChange:D,placeholder:"Breve descri\xe7\xe3o da receita",rows:2}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsx)(t.Z,{label:"Tempo de Preparo (minutos) *",name:"tempoPreparo",type:"number",min:"1",value:A.tempoPreparo,onChange:D,error:_.tempoPreparo,placeholder:"Ex: 45"}),(0,r.jsx)(t.Z,{label:"Rendimento Total",name:"rendimentoTotal",type:"number",readOnly:!0,value:A.rendimentoTotal}),(0,r.jsx)(s.Z,{label:"Unidade de Rendimento *",name:"unidadeRendimento",value:A.unidadeRendimento,onChange:D,options:u.gZ,error:_.unidadeRendimento})]})]})}),(0,r.jsx)(d.Z,{title:"Ingredientes",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsxs)(c.Z,{type:"button",variant:"outline",onClick:E,children:[(0,r.jsx)("span",{className:"material-icons mr-1 text-sm",children:"add"}),"Adicionar Ingrediente"]})}),_.ingredientes&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:_.ingredientes}),(0,r.jsx)(h.ZP,{headers:["Produto","Quantidade","A\xe7\xf5es"],emptyMessage:"Nenhum ingrediente adicionado. Clique em 'Adicionar Ingrediente'.",children:A.ingredientes.map((e,a)=>(0,r.jsxs)(h.SC,{children:[(0,r.jsx)(h.pj,{children:F(e.produtoId)}),(0,r.jsx)(h.pj,{children:B(e.unidade,e.quantidade)}),(0,r.jsx)(h.pj,{children:(0,r.jsx)(c.Z,{variant:"outline",size:"sm",onClick:()=>Q(a),children:(0,r.jsx)("span",{className:"material-icons text-sm text-red-500",children:"delete"})})})]},a))})]})}),(0,r.jsx)(d.Z,{title:"Modo de Preparo",children:(0,r.jsx)(l.Z,{label:"Instru\xe7\xf5es de Preparo *",name:"modoPreparo",value:A.modoPreparo,onChange:D,error:_.modoPreparo,placeholder:"Descreva passo a passo como preparar a receita",rows:6})}),(0,r.jsx)(d.Z,{title:"Observa\xe7\xf5es",children:(0,r.jsx)(l.Z,{label:"Observa\xe7\xf5es ou Dicas do Chef",name:"observacoes",value:A.observacoes,onChange:D,placeholder:"Dicas, varia\xe7\xf5es ou informa\xe7\xf5es adicionais sobre a receita",rows:4})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)(c.Z,{type:"button",variant:"outline",onClick:()=>a.push("/fichas-tecnicas/".concat(q)),children:"Cancelar"}),(0,r.jsx)(c.Z,{type:"submit",variant:"primary",isLoading:P,children:"Atualizar Ficha T\xe9cnica"})]})]})}),(0,r.jsx)(x.Z,{isOpen:T,onClose:S,title:"Adicionar Ingrediente",footer:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{variant:"outline",onClick:S,children:"Cancelar"}),(0,r.jsx)(c.Z,{variant:"primary",onClick:()=>{let e={};if(k.produtoId||(e.produtoId="Selecione um produto"),k.quantidade?(isNaN(Number(k.quantidade))||0>=Number(k.quantidade))&&(e.quantidade="Quantidade deve ser um n\xfamero positivo"):e.quantidade="Quantidade \xe9 obrigat\xf3ria",k.unidade||(e.unidade="Selecione a unidade"),Object.keys(e).length>0){w(a=>({...a,...e}));return}let a={produtoId:k.produtoId,quantidade:Number(k.quantidade),unidade:k.unidade};M(e=>({...e,ingredientes:[...e.ingredientes,a]})),O({produtoId:"",quantidade:"",unidade:""}),w(e=>{let a={...e};return delete a.produtoId,delete a.quantidade,delete a.unidade,a}),S()},children:"Adicionar"})]}),children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(s.Z,{label:"Produto *",name:"produtoId",value:k.produtoId,onChange:z,error:_.produtoId,options:f.map(e=>({value:e.id,label:"".concat(e.nome," (").concat(e.unidadeMedida,")")})).sort((e,a)=>e.label.localeCompare(a.label))}),(0,r.jsx)(t.Z,{label:"Quantidade *",name:"quantidade",type:"number",min:"0.1",step:"0.1",value:k.quantidade,onChange:z,error:_.quantidade,placeholder:"Ex: 250"}),(0,r.jsx)(s.Z,{label:"Unidade *",name:"unidade",value:k.unidade,onChange:z,error:_.unidade,options:C.map(e=>({value:e.id,label:e.nome})).sort((e,a)=>e.label.localeCompare(a.label))})]})})]})}}},function(e){e.O(0,[249,613,971,655,744],function(){return e(e.s=94993)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[184],{74352:function(e,r,a){Promise.resolve().then(a.bind(a,24040))},47907:function(e,r,a){"use strict";var t=a(15313);a.o(t,"useParams")&&a.d(r,{useParams:function(){return t.useParams}}),a.o(t,"usePathname")&&a.d(r,{usePathname:function(){return t.usePathname}}),a.o(t,"useRouter")&&a.d(r,{useRouter:function(){return t.useRouter}})},46993:function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"RouterContext",{enumerable:!0,get:function(){return t}});let t=a(86921)._(a(64090)).default.createContext(null)},24040:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return d}});var t=a(3827),o=a(64090),s=a(47907),n=a(57418),l=a(32278),i=a(66651),c=a(14570),u=a(40796);function d(){let e=(0,s.useRouter)(),{registrarUsuario:r,usuarioAtual:a}=(0,c.G)(),[d,m]=(0,o.useState)({nome:"",email:"",confirmarEmail:"",senha:"",confirmarSenha:"",role:"viewer"}),[h,f]=(0,o.useState)("");(0,o.useEffect)(()=>{a&&"admin"===a.role||e.replace("/login")},[a,e]);let g=e=>{m({...d,[e.target.name]:e.target.value})},x=async a=>{if(a.preventDefault(),d.email!==d.confirmarEmail){f("Emails n\xe3o conferem");return}if(d.senha!==d.confirmarSenha){f("Senhas n\xe3o conferem");return}if(!await r({nome:d.nome,email:d.email,senha:d.senha,role:d.role})){f("Email j\xe1 cadastrado ou senha fraca");return}e.push("/login")};return a&&"admin"===a.role?(0,t.jsx)("div",{className:"flex items-center justify-center h-screen bg-gray-100",children:(0,t.jsxs)(n.Z,{className:"w-96",children:[(0,t.jsx)("div",{className:"flex justify-center mb-4",children:(0,t.jsx)(u.Z,{className:"text-2xl"})}),(0,t.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"Novo Usu\xe1rio"}),h&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:h}),(0,t.jsx)(l.Z,{label:"Nome",name:"nome",value:d.nome,onChange:g,required:!0}),(0,t.jsx)(l.Z,{label:"Email",type:"email",name:"email",value:d.email,onChange:g,required:!0}),(0,t.jsx)(l.Z,{label:"Confirmar Email",type:"email",name:"confirmarEmail",value:d.confirmarEmail,onChange:g,required:!0}),(0,t.jsx)(l.Z,{label:"Senha",type:"password",name:"senha",value:d.senha,onChange:g,required:!0}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:"A senha deve ter ao menos 8 caracteres, incluindo letras mai\xfasculas, min\xfasculas, n\xfameros e s\xedmbolos."}),(0,t.jsx)(l.Z,{label:"Confirmar Senha",type:"password",name:"confirmarSenha",value:d.confirmarSenha,onChange:g,required:!0}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Perfil"}),(0,t.jsxs)("select",{name:"role",value:d.role,onChange:g,className:"border border-[var(--cor-borda)] rounded-md p-2 w-full",children:[(0,t.jsx)("option",{value:"viewer",children:"Visualizador"}),(0,t.jsx)("option",{value:"editor",children:"Editor"}),(0,t.jsx)("option",{value:"manager",children:"Gerente"}),(0,t.jsx)("option",{value:"admin",children:"Administrador"})]})]}),(0,t.jsx)(i.Z,{type:"submit",variant:"primary",fullWidth:!0,children:"Cadastrar"})]})]})}):null}},66651:function(e,r,a){"use strict";var t=a(3827);a(64090),r.Z=e=>{let{children:r,variant:a="primary",size:o="md",isLoading:s=!1,fullWidth:n=!1,className:l="",disabled:i,...c}=e,u=i||s?"opacity-50 cursor-not-allowed":"";return(0,t.jsxs)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-[var(--cor-acao)] text-white hover:brightness-90 focus:ring-[var(--cor-acao)]",secondary:"bg-[var(--cor-secundaria)] text-white hover:brightness-90 focus:ring-[var(--cor-secundaria)]",success:"bg-[var(--cor-sucesso)] text-white hover:brightness-90 focus:ring-[var(--cor-sucesso)]",danger:"bg-[var(--cor-erro)] text-white hover:brightness-90 focus:ring-[var(--cor-erro)]",outline:"bg-white text-[var(--cor-texto-principal)] border border-[var(--cor-borda)] hover:bg-gray-50 focus:ring-[var(--cor-acao)]"}[a]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[o]," ").concat(n?"w-full":""," ").concat(u," ").concat(l),disabled:i||s,...c,children:[s&&(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r]})}},57418:function(e,r,a){"use strict";var t=a(3827);a(64090),r.Z=e=>{let{children:r,title:a,className:o="",footer:s}=e;return(0,t.jsxs)("div",{className:"card overflow-hidden ".concat(o),children:[a&&(0,t.jsx)("div",{className:"px-6 py-4 border-b",style:{borderColor:"var(--cor-borda)"},children:(0,t.jsx)("h3",{className:"text-lg font-medium",style:{color:"var(--cor-texto-principal)"},children:a})}),(0,t.jsx)("div",{className:"p-6",children:r}),s&&(0,t.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-t",style:{borderColor:"var(--cor-borda)"},children:s})]})}},32278:function(e,r,a){"use strict";var t=a(3827);let o=(0,a(64090).forwardRef)((e,r)=>{let{label:a,error:o,helperText:s,className:n="",...l}=e;return(0,t.jsxs)("div",{className:"mb-4",children:[a&&(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--cor-texto-principal)"},children:a}),(0,t.jsx)("input",{ref:r,className:"w-full input ".concat(o?"border-[var(--cor-erro)]":""," ").concat(n),...l}),o&&(0,t.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-erro)"},children:o}),s&&!o&&(0,t.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-texto-secundario)"},children:s})]})});o.displayName="Input",r.Z=o},40796:function(e,r,a){"use strict";var t=a(3827),o=a(20703);a(64090),r.Z=e=>{let{className:r="",showTagline:a=!1}=e;return(0,t.jsxs)("span",{className:"inline-flex items-center space-x-2 ".concat(r),children:[(0,t.jsx)(o.default,{src:"/logo.svg",alt:"GastroChef",width:24,height:24}),(0,t.jsx)("span",{className:"font-bold",children:"GastroChef"}),a&&(0,t.jsx)("span",{className:"text-xs whitespace-nowrap",children:"Sistema de Fichas T\xe9cnicas"})]})}},32355:function(e,r,a){"use strict";a.d(r,{g:function(){return o}});let t=()=>localStorage.getItem("auth_token"),o=()=>{let e=t();return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}},14570:function(e,r,a){"use strict";a.d(r,{G:function(){return l}});var t=a(64090),o=a(32355);let s=async()=>{try{console.log("\uD83D\uDCE1 Fazendo chamada para /api/auth/users...");let e=await fetch("/api/auth/users",{headers:(0,o.g)()});if(console.log("\uD83D\uDCE1 Response status: ".concat(e.status)),!e.ok){let r=await e.text();throw console.error("❌ Erro na API users: ".concat(e.status," - ").concat(r)),Error("Erro ao buscar usu\xe1rios: ".concat(e.status))}let r=await e.json();return console.log("✅ Usu\xe1rios da API: ".concat(r.length)),r.map(e=>({role:"viewer",...e}))}catch(e){return console.error("❌ Erro ao buscar usu\xe1rios da API:",e),[]}},n=e=>e.filter(e=>!e.oculto),l=()=>{let[e,r]=(0,t.useState)([]),[a,l]=(0,t.useState)(null),[i,c]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{try{c(!0),console.log("\uD83D\uDD0D Carregando usu\xe1rios...");let e=localStorage.getItem("auth_token"),a=localStorage.getItem("user_data");if(console.log("\uD83D\uDD10 Auth state:",{tokenExists:!!e,userDataExists:!!a}),e&&a&&"undefined"!==a){let e=JSON.parse(a);if(console.log("✅ Usu\xe1rio atual carregado:",e.email),l(e),"admin"===e.role){let e=await s();console.log("✅ Usu\xe1rios carregados:",(null==e?void 0:e.length)||0),r(e)}else console.log("\uD83D\uDC64 User is not admin, skipping users list"),r([])}else console.log("⚠️ No valid auth token or user data found"),l(null),r([])}catch(e){console.error("❌ Erro ao carregar usu\xe1rios:",e),r([]),l(null)}finally{c(!1)}})()},[]);let u=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{6,}$/.test(e),d=async a=>{if(e.some(e=>e.email===a.email)||!u(a.senha))return null;try{let t=await fetch("/api/auth/register",{method:"POST",headers:(0,o.g)(),body:JSON.stringify(a)}),s=await t.json();if(!t.ok)return console.error("Erro no registro:",s),null;let n=[...e,s];return r(n),s}catch(e){return console.error("Erro ao registrar usu\xe1rio:",e),null}},m=()=>{l(null),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")},h=async e=>{try{if(!(await fetch("/api/auth/users/".concat(e),{method:"DELETE",headers:(0,o.g)()})).ok)throw Error("Erro ao deletar usu\xe1rio");let t=await s();return r(n(t)),(null==a?void 0:a.id)===e&&m(),!0}catch(e){return console.error("Erro ao remover usu\xe1rio:",e),!1}},f=async(e,t)=>{try{if(!(await fetch("/api/auth/users/".concat(e,"/password"),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify({novaSenha:t})})).ok)throw Error("Erro ao alterar senha");let i=await s();if(r(n(i)),(null==a?void 0:a.id)===e){let r=i.find(r=>r.id===e)||null;l(r)}return!0}catch(e){return console.error("Erro ao alterar senha:",e),!1}},g=async(e,t)=>{try{if((await s()).some(r=>r.email===t.email&&r.id!==e))return!1;if(!(await fetch("/api/auth/users/".concat(e),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify(t)})).ok)throw Error("Erro ao editar usu\xe1rio");let i=await s();if(r(n(i)),(null==a?void 0:a.id)===e){let r=i.find(r=>r.id===e)||null;l(r),localStorage.setItem("user_data",JSON.stringify(r))}return!0}catch(e){return console.error("Erro ao editar usu\xe1rio:",e),!1}};return{usuarios:e,usuarioAtual:a,isLoading:i,registrarUsuario:d,login:async(e,a)=>{try{let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,senha:a})});if(!t.ok)return null;let{user:o,token:i}=await t.json();l(o),localStorage.setItem("auth_token",i),localStorage.setItem("user_data",JSON.stringify(o));let c=await s();if(!c.find(e=>e.id===o.id)){let e=[...c,o];r(n(e))}return o}catch(e){return null}},logout:m,removerUsuario:h,alterarSenha:f,editarUsuario:g}}}},function(e){e.O(0,[703,971,69,744],function(){return e(e.s=74352)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{14858:function(e,a,t){Promise.resolve().then(t.bind(t,60466))},60466:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return g}});var r=t(3827),o=t(64090),d=t(57418),i=t(32278),n=t(79173),s=t(66651),l=t(20200),c=t(70492),u=t(16297),h=t(27742),m=t(29130),p=t(65371),f=t(81462);function g(){let{fichasTecnicas:e}=(0,u.vG)(),{produtos:a}=(0,h.Ug)(),{registrarSaida:t}=(0,m.H)(),{registrarEntrada:g}=(0,p.u)(),{producoes:x,registrarProducao:v,atualizarProducao:y,removerProducao:b}=(0,f.G)(),[j,w]=(0,o.useState)({fichaId:"",quantidade:"",unidadeQtd:"kg",pesoUnitario:"",unidadePeso:"g",data:new Date().toISOString().split("T")[0],validade:""}),[N,E]=(0,o.useState)({}),[k,P]=(0,o.useState)(null),[S,C]=(0,o.useState)(null),{isOpen:I,openModal:q,closeModal:T}=(0,c.d)(),U=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),Z=e=>{let{name:a,value:t}=e.target;w(e=>({...e,[a]:t}))},z=()=>{let e={};return j.fichaId||(e.fichaId="Ficha \xe9 obrigat\xf3ria"),(!j.quantidade||isNaN(Number(j.quantidade)))&&(e.quantidade="Qtd inv\xe1lida"),(!j.pesoUnitario||isNaN(Number(j.pesoUnitario)))&&(e.pesoUnitario="Peso inv\xe1lido"),j.data||(e.data="Data obrigat\xf3ria"),j.validade||(e.validade="Validade obrigat\xf3ria"),E(e),0===Object.keys(e).length},O=e=>{P({...e}),q()};(0,o.useEffect)(()=>{if(!k)return;let a=e.find(e=>e.id===k.fichaId);if(!a)return;let t=(0,u.zP)(k.quantidadeTotal,k.unidadeQuantidade,"g"),r=(0,u.zP)(a.rendimentoTotal,a.unidadeRendimento,"g"),o=Math.round(t/(0,u.zP)(k.pesoUnitario,k.unidadePeso,"g")),d=a.custoTotal*(t/r),i=o?d/o:0;P(e=>e&&(e.unidadesGeradas!==o||e.custoTotal!==d||e.custoUnitario!==i)?{...e,unidadesGeradas:o,custoTotal:d,custoUnitario:i}:e)},[null==k?void 0:k.quantidadeTotal,null==k?void 0:k.unidadeQuantidade,null==k?void 0:k.pesoUnitario,null==k?void 0:k.unidadePeso,null==k?void 0:k.fichaId,e]);let Q=e=>e?new Date(e+"T00:00:00").toLocaleDateString():"";return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Produ\xe7\xe3o"}),(0,r.jsx)(d.Z,{children:(0,r.jsxs)("form",{onSubmit:r=>{if(r.preventDefault(),!z())return;let o=e.find(e=>e.id===j.fichaId);if(!o)return;let d=(0,u.zP)(Number(j.quantidade),j.unidadeQtd,"g"),i=d/(0,u.zP)(o.rendimentoTotal,o.unidadeRendimento,"g");o.ingredientes.forEach(e=>{let r=a.find(a=>a.id===e.produtoId);if(!r)return;let o=(0,u.zP)(e.quantidade*i,e.unidade,r.unidadeMedida);t({produtoId:r.id,quantidade:o})});let n=Math.round(d/(0,u.zP)(Number(j.pesoUnitario),j.unidadePeso,"g")),s=o.custoTotal*i,l=s/n;g({fichaId:j.fichaId,quantidade:n,validade:j.validade}),v({fichaId:j.fichaId,quantidadeTotal:Number(j.quantidade),unidadeQuantidade:j.unidadeQtd,pesoUnitario:Number(j.pesoUnitario),unidadePeso:j.unidadePeso,unidadesGeradas:n,custoTotal:s,custoUnitario:l,validade:j.validade,data:j.data}),w({fichaId:"",quantidade:"",unidadeQtd:"kg",pesoUnitario:"",unidadePeso:"g",data:new Date().toISOString().split("T")[0],validade:""})},className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[(0,r.jsx)(n.Z,{label:"Ficha T\xe9cnica *",name:"fichaId",value:j.fichaId,onChange:Z,options:e.map(e=>({value:e.id,label:e.nome})).sort((e,a)=>e.label.localeCompare(a.label)),error:N.fichaId}),(0,r.jsx)(i.Z,{label:"Quantidade *",name:"quantidade",value:j.quantidade,onChange:Z,error:N.quantidade}),(0,r.jsx)(n.Z,{label:"Unidade",name:"unidadeQtd",value:j.unidadeQtd,onChange:Z,options:[{value:"g",label:"g"},{value:"kg",label:"kg"}]}),(0,r.jsx)(i.Z,{label:"Peso por unidade *",name:"pesoUnitario",value:j.pesoUnitario,onChange:Z,error:N.pesoUnitario}),(0,r.jsx)(n.Z,{label:"Unidade",name:"unidadePeso",value:j.unidadePeso,onChange:Z,options:[{value:"g",label:"g"},{value:"kg",label:"kg"}]}),(0,r.jsx)(i.Z,{label:"Data *",type:"date",name:"data",value:j.data,onChange:Z,error:N.data}),(0,r.jsx)(i.Z,{label:"Validade *",type:"date",name:"validade",value:j.validade,onChange:Z,error:N.validade}),(0,r.jsx)("div",{className:"md:col-span-5 flex justify-end",children:(0,r.jsx)(s.Z,{type:"submit",variant:"primary",children:"Registrar Produ\xe7\xe3o"})})]})}),(0,r.jsx)(d.Z,{title:"Hist\xf3rico de Produ\xe7\xf5es",children:(0,r.jsx)(l.ZP,{headers:["Data","Validade","Ficha","Qtd.","Peso/Unid.","Unid.","Custo","Custo/Unid.","A\xe7\xf5es"],emptyMessage:"Nenhuma produ\xe7\xe3o registrada",className:"text-sm",children:x.map(a=>{let t=e.find(e=>e.id===a.fichaId);return(0,r.jsxs)(l.SC,{children:[(0,r.jsx)(l.pj,{compact:!0,children:Q(a.data)}),(0,r.jsx)(l.pj,{compact:!0,children:Q(a.validade)}),(0,r.jsx)(l.pj,{compact:!0,children:(null==t?void 0:t.nome)||"Ficha removida"}),(0,r.jsxs)(l.pj,{compact:!0,children:[a.quantidadeTotal,a.unidadeQuantidade]}),(0,r.jsxs)(l.pj,{compact:!0,children:[a.pesoUnitario,a.unidadePeso]}),(0,r.jsx)(l.pj,{compact:!0,children:a.unidadesGeradas}),(0,r.jsx)(l.pj,{compact:!0,children:U(a.custoTotal)}),(0,r.jsx)(l.pj,{compact:!0,children:U(a.custoUnitario)}),(0,r.jsxs)(l.pj,{className:"relative text-right",children:[(0,r.jsx)("button",{className:"p-1 rounded hover:bg-gray-100",onClick:()=>C(S===a.id?null:a.id),children:(0,r.jsx)("span",{className:"material-icons text-gray-600",children:"more_vert"})}),S===a.id&&(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-32 bg-white border rounded shadow z-10",children:[(0,r.jsxs)("button",{className:"block w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center",onClick:()=>{C(null),O(a)},children:[(0,r.jsx)("span",{className:"material-icons mr-1 text-black text-sm",children:"edit"}),"Editar"]}),(0,r.jsxs)("button",{className:"block w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center text-red-600",onClick:()=>{C(null),b(a.id)},children:[(0,r.jsx)("span",{className:"material-icons mr-1 text-black text-sm",children:"delete"}),"Excluir"]})]})]})]},a.id)})})}),(0,r.jsx)(c.Z,{isOpen:I,onClose:T,title:"Editar Produ\xe7\xe3o",size:"xl",children:k&&(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),k&&(y(k.id,{fichaId:k.fichaId,quantidadeTotal:Number(k.quantidadeTotal),unidadeQuantidade:k.unidadeQuantidade,pesoUnitario:Number(k.pesoUnitario),unidadePeso:k.unidadePeso,unidadesGeradas:Number(k.unidadesGeradas),custoTotal:k.custoTotal,custoUnitario:k.custoUnitario,validade:k.validade,data:k.data}),T())},className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[(0,r.jsx)(n.Z,{label:"Ficha T\xe9cnica",name:"fichaId",value:k.fichaId,onChange:e=>P({...k,fichaId:e.target.value}),options:e.map(e=>({value:e.id,label:e.nome})).sort((e,a)=>e.label.localeCompare(a.label))}),(0,r.jsx)(i.Z,{label:"Quantidade",name:"quantidadeTotal",value:String(k.quantidadeTotal),onChange:e=>P({...k,quantidadeTotal:Number(e.target.value)})}),(0,r.jsx)(n.Z,{label:"Unidade",name:"unidadeQuantidade",value:k.unidadeQuantidade,onChange:e=>P({...k,unidadeQuantidade:e.target.value}),options:[{value:"g",label:"g"},{value:"kg",label:"kg"}]}),(0,r.jsx)(i.Z,{label:"Peso por unidade",name:"pesoUnitario",value:String(k.pesoUnitario),onChange:e=>P({...k,pesoUnitario:Number(e.target.value)})}),(0,r.jsx)(n.Z,{label:"Unidade",name:"unidadePeso",value:k.unidadePeso,onChange:e=>P({...k,unidadePeso:e.target.value}),options:[{value:"g",label:"g"},{value:"kg",label:"kg"}]}),(0,r.jsx)(i.Z,{label:"Data",type:"date",name:"data",value:k.data,onChange:e=>P({...k,data:e.target.value})}),(0,r.jsx)(i.Z,{label:"Validade",type:"date",name:"validade",value:k.validade,onChange:e=>P({...k,validade:e.target.value})}),(0,r.jsxs)("div",{className:"md:col-span-6 flex justify-end space-x-2",children:[(0,r.jsx)(s.Z,{type:"button",variant:"secondary",onClick:T,children:"Cancelar"}),(0,r.jsx)(s.Z,{type:"submit",variant:"primary",children:"Salvar"})]})]})})]})}},66651:function(e,a,t){"use strict";var r=t(3827);t(64090),a.Z=e=>{let{children:a,variant:t="primary",size:o="md",isLoading:d=!1,fullWidth:i=!1,className:n="",disabled:s,...l}=e,c=s||d?"opacity-50 cursor-not-allowed":"";return(0,r.jsxs)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-[var(--cor-acao)] text-white hover:brightness-90 focus:ring-[var(--cor-acao)]",secondary:"bg-[var(--cor-secundaria)] text-white hover:brightness-90 focus:ring-[var(--cor-secundaria)]",success:"bg-[var(--cor-sucesso)] text-white hover:brightness-90 focus:ring-[var(--cor-sucesso)]",danger:"bg-[var(--cor-erro)] text-white hover:brightness-90 focus:ring-[var(--cor-erro)]",outline:"bg-white text-[var(--cor-texto-principal)] border border-[var(--cor-borda)] hover:bg-gray-50 focus:ring-[var(--cor-acao)]"}[t]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[o]," ").concat(i?"w-full":""," ").concat(c," ").concat(n),disabled:s||d,...l,children:[d&&(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a]})}},32278:function(e,a,t){"use strict";var r=t(3827);let o=(0,t(64090).forwardRef)((e,a)=>{let{label:t,error:o,helperText:d,className:i="",...n}=e;return(0,r.jsxs)("div",{className:"mb-4",children:[t&&(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--cor-texto-principal)"},children:t}),(0,r.jsx)("input",{ref:a,className:"w-full input ".concat(o?"border-[var(--cor-erro)]":""," ").concat(i),...n}),o&&(0,r.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-erro)"},children:o}),d&&!o&&(0,r.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-texto-secundario)"},children:d})]})});o.displayName="Input",a.Z=o},70492:function(e,a,t){"use strict";t.d(a,{d:function(){return d}});var r=t(3827),o=t(64090);let d=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],[a,t]=(0,o.useState)(e);return{isOpen:a,openModal:()=>t(!0),closeModal:()=>t(!1),toggleModal:()=>t(!a)}};a.Z=e=>{let{isOpen:a,onClose:t,title:d,children:i,footer:n,size:s="md"}=e,[l,c]=(0,o.useState)(!1);return((0,o.useEffect)(()=>(a?(c(!0),document.body.style.overflow="hidden"):(setTimeout(()=>{c(!1)},200),document.body.style.overflow="auto"),()=>{document.body.style.overflow="auto"}),[a]),l||a)?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 ".concat(a?"opacity-100":"opacity-0"," transition-opacity duration-200"),children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:t}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full ".concat({sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[s]," z-10 ").concat(a?"translate-y-0":"translate-y-4"," transition-transform duration-200"),children:[(0,r.jsxs)("div",{className:"flex justify-between items-center px-6 py-4 border-b",style:{borderColor:"var(--cor-borda)"},children:[(0,r.jsx)("h3",{className:"text-lg font-medium",style:{color:"var(--cor-texto-principal)"},children:d}),(0,r.jsxs)("button",{type:"button",className:"text-gray-400 hover:text-gray-500 focus:outline-none",onClick:t,children:[(0,r.jsx)("span",{className:"sr-only",children:"Fechar"}),(0,r.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,r.jsx)("div",{className:"px-6 py-4",children:i}),n&&(0,r.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-t flex justify-end space-x-3",style:{borderColor:"var(--cor-borda)"},children:n})]})]}):null}},79173:function(e,a,t){"use strict";var r=t(3827);let o=(0,t(64090).forwardRef)((e,a)=>{let{label:t,error:o,helperText:d,options:i,className:n="",...s}=e;return(0,r.jsxs)("div",{className:"mb-4",children:[t&&(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,r.jsxs)("select",{ref:a,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 \n            ".concat(o?"border-red-500":"border-gray-300"," \n            ").concat(n),...s,children:[(0,r.jsx)("option",{value:"",children:"Selecione..."}),i.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]}),o&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o}),d&&!o&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:d})]})});o.displayName="Select",a.Z=o},20200:function(e,a,t){"use strict";t.d(a,{SC:function(){return d},pj:function(){return i}});var r=t(3827),o=t(64090);let d=e=>{let{children:a,className:t="",...o}=e;return(0,r.jsx)("tr",{className:"odd:bg-gray-50 hover:bg-[var(--cor-secundaria)/10] hover:shadow-sm rounded-lg ".concat(t),...o,children:a})},i=e=>{let{children:a,className:t="",compact:o=!1}=e;return(0,r.jsx)("td",{className:"".concat(o?"px-2 py-2":"px-6 py-4"," text-sm ").concat(t),style:{color:"var(--cor-texto-secundario)"},children:a})};a.ZP=e=>{let{headers:a,children:t,className:d="",emptyMessage:i="Nenhum dado encontrado",isLoading:n=!1}=e;return(0,r.jsx)("div",{className:"w-full overflow-x-hidden rounded-lg border ".concat(d),style:{borderColor:"var(--cor-borda)"},children:(0,r.jsxs)("table",{className:"w-full table-fixed divide-y",style:{borderColor:"var(--cor-borda)"},children:[(0,r.jsx)("thead",{className:"bg-gray-100",children:(0,r.jsx)("tr",{children:a.map((e,a)=>(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--cor-texto-secundario)"},children:e},a))})}),(0,r.jsx)("tbody",{className:"bg-white divide-y",style:{borderColor:"var(--cor-borda)"},children:n?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:a.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:(0,r.jsxs)("div",{className:"flex justify-center items-center py-4",children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,r.jsx)("span",{className:"ml-2",children:"Carregando..."})]})})}):o.Children.count(t)>0?t:(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:a.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:i})})})]})})}},65371:function(e,a,t){"use strict";t.d(a,{u:function(){return i}});var r=t(64090),o=t(32355);let d=async()=>{try{let e=await fetch("/api/estoque-producao",{headers:(0,o.g)()});if(!e.ok)throw Error("Erro ao buscar movimenta\xe7\xf5es de produ\xe7\xe3o");return await e.json()}catch(e){return console.error("Erro ao buscar movimenta\xe7\xf5es de produ\xe7\xe3o da API:",e),[]}},i=()=>{let[e,a]=(0,r.useState)([]),[t,i]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{i(!0),a(await d()),i(!1)})()},[]);let n=async t=>{try{let r=await fetch("/api/estoque-producao",{method:"POST",headers:(0,o.g)(),body:JSON.stringify({...t,data:new Date().toISOString(),tipo:"entrada"})});if(!r.ok)throw Error("Erro ao registrar entrada de produ\xe7\xe3o");let d=await r.json(),i=[...e,d];return a(i),d}catch(e){return console.error("Erro ao registrar entrada de produ\xe7\xe3o:",e),null}},s=async t=>{try{let r=await fetch("/api/estoque-producao",{method:"POST",headers:(0,o.g)(),body:JSON.stringify({fichaId:t.fichaId,quantidade:-Math.abs(t.quantidade),data:new Date().toISOString(),tipo:"saida"})});if(!r.ok)throw Error("Erro ao registrar sa\xedda de produ\xe7\xe3o");let d=await r.json(),i=[...e,d];return a(i),d}catch(e){return console.error("Erro ao registrar sa\xedda de produ\xe7\xe3o:",e),null}},l=async(t,r)=>{try{let d=await fetch("/api/estoque-producao/".concat(t),{method:"PUT",headers:(0,o.g)(),body:JSON.stringify(r)});if(!d.ok)throw Error("Erro ao atualizar movimenta\xe7\xe3o de produ\xe7\xe3o");let i=await d.json(),n=e.map(e=>e.id===t?i:e);return a(n),i}catch(e){return console.error("Erro ao atualizar movimenta\xe7\xe3o de produ\xe7\xe3o:",e),null}},c=async t=>{try{if(!(await fetch("/api/estoque-producao/".concat(t),{method:"DELETE",headers:(0,o.g)()})).ok)throw Error("Erro ao deletar movimenta\xe7\xe3o de produ\xe7\xe3o");let r=e.filter(e=>e.id!==t);return a(r),!0}catch(e){return console.error("Erro ao remover movimenta\xe7\xe3o de produ\xe7\xe3o:",e),!1}};return{movimentacoes:e,isLoading:t,registrarEntrada:n,registrarSaida:s,calcularEstoqueAtual:a=>e.filter(e=>e.fichaId===a).reduce((e,a)=>e+a.quantidade,0),atualizarMovimentacao:l,removerMovimentacao:c}}},29130:function(e,a,t){"use strict";t.d(a,{H:function(){return n}});var r=t(64090),o=t(27742),d=t(32355);let i=async()=>{try{let e=await fetch("/api/estoque",{headers:(0,d.g)()});if(!e.ok)throw Error("Erro ao buscar movimenta\xe7\xf5es");return await e.json()}catch(e){return console.error("Erro ao buscar movimenta\xe7\xf5es da API:",e),[]}},n=()=>{let[e,a]=(0,r.useState)([]),[t,n]=(0,r.useState)(!0),s=async e=>{if(e.preco)try{let a=(await (0,o.k0)()).find(a=>a.id===e.produtoId);if(a){let t=a.pesoEmbalagem||1,r=t>0?(e.preco||a.preco)/t:0,o={...a,preco:e.preco||a.preco,precoUnitario:r,fornecedor:e.fornecedor||a.fornecedor,marca:e.marca||a.marca};await fetch("/api/produtos/".concat(a.id),{method:"PUT",headers:(0,d.g)(),body:JSON.stringify(o)})}}catch(e){console.error("Erro ao atualizar produto:",e)}};(0,r.useEffect)(()=>{(async()=>{n(!0),a((await i()).filter(e=>"Producao"!==e.fornecedor)),n(!1)})()},[]);let l=async t=>{try{let r=await fetch("/api/estoque",{method:"POST",headers:(0,d.g)(),body:JSON.stringify({...t,data:new Date().toISOString(),tipo:"entrada"})});if(!r.ok)throw Error("Erro ao registrar entrada");let o=await r.json(),i=[...e,o];return a(i),await s(o),o}catch(e){return console.error("Erro ao registrar entrada:",e),null}},c=async t=>{try{let r=await fetch("/api/estoque",{method:"POST",headers:(0,d.g)(),body:JSON.stringify({produtoId:t.produtoId,quantidade:-Math.abs(t.quantidade),data:new Date().toISOString(),tipo:"saida"})});if(!r.ok)throw Error("Erro ao registrar sa\xedda");let o=await r.json(),i=[...e,o];return a(i),o}catch(e){return console.error("Erro ao registrar sa\xedda:",e),null}},u=async(t,r)=>{try{let o=await fetch("/api/estoque/".concat(t),{method:"PUT",headers:(0,d.g)(),body:JSON.stringify(r)});if(!o.ok)throw Error("Erro ao atualizar movimenta\xe7\xe3o");let i=await o.json(),n=e.map(e=>e.id===t?i:e);return a(n),"entrada"===i.tipo&&await s(i),i}catch(e){return console.error("Erro ao atualizar movimenta\xe7\xe3o:",e),null}},h=async t=>{try{if(!(await fetch("/api/estoque/".concat(t),{method:"DELETE",headers:(0,d.g)()})).ok)throw Error("Erro ao deletar movimenta\xe7\xe3o");let r=e.filter(e=>e.id!==t);return a(r),!0}catch(e){return console.error("Erro ao remover movimenta\xe7\xe3o:",e),!1}},m=(0,r.useCallback)(a=>e.filter(e=>e.produtoId===a).reduce((e,a)=>e+a.quantidade,0),[e]);return{movimentacoes:e,isLoading:t,registrarEntrada:l,registrarSaida:c,atualizarMovimentacao:u,removerMovimentacao:h,obterHistoricoPorProduto:a=>e.filter(e=>e.produtoId===a),calcularEstoqueAtual:m}}},81462:function(e,a,t){"use strict";t.d(a,{G:function(){return l}});var r=t(64090),o=t(16297),d=t(32355);let i=async()=>{try{let e=await fetch("/api/producao",{headers:(0,d.g)()});if(!e.ok)throw Error("Erro ao buscar produ\xe7\xf5es");return(await e.json()).map(e=>({custoTotal:0,custoUnitario:0,validade:"",...e}))}catch(e){return console.error("Erro ao buscar produ\xe7\xf5es da API:",e),[]}},n=async(e,a)=>e.map(e=>s(e,a)),s=(e,a)=>{let t=a.find(a=>a.id===e.fichaId);if(!t)return e;let r=(0,o.zP)(e.quantidadeTotal,e.unidadeQuantidade,"g"),d=(0,o.zP)(t.rendimentoTotal,t.unidadeRendimento,"g"),i=(0,o.zP)(e.pesoUnitario,e.unidadePeso,"g"),n=i?Math.round(r/i):e.unidadesGeradas,s=t.custoTotal*(d?r/d:0);return{...e,unidadesGeradas:n,custoTotal:s,custoUnitario:n?s/n:0}},l=()=>{let{fichasTecnicas:e}=(0,o.vG)(),[a,t]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{let a=await i(),r=e.length?e:await (0,o.lB)();t(await n(a,r))})()},[]),(0,r.useEffect)(()=>{(async()=>{a.length&&t(await n(a,e))})()},[e]);let s=async e=>{try{let r=await fetch("/api/producao",{method:"POST",headers:(0,d.g)(),body:JSON.stringify(e)});if(!r.ok)throw Error("Erro ao registrar produ\xe7\xe3o");let o=await r.json(),i=[...a,o];return t(i),o}catch(e){return console.error("Erro ao registrar produ\xe7\xe3o:",e),null}},l=async(e,r)=>{try{let o=await fetch("/api/producao/".concat(e),{method:"PUT",headers:(0,d.g)(),body:JSON.stringify(r)});if(!o.ok)throw Error("Erro ao atualizar produ\xe7\xe3o");let i=await o.json(),n=a.map(a=>a.id===e?i:a);return t(n),i}catch(e){return console.error("Erro ao atualizar produ\xe7\xe3o:",e),null}},c=async e=>{try{if(!(await fetch("/api/producao/".concat(e),{method:"DELETE",headers:(0,d.g)()})).ok)throw Error("Erro ao deletar produ\xe7\xe3o");let r=a.filter(a=>a.id!==e);return t(r),!0}catch(e){return console.error("Erro ao remover produ\xe7\xe3o:",e),!1}};return{producoes:a,registrarProducao:s,atualizarProducao:l,removerProducao:c}}}},function(e){e.O(0,[249,971,655,744],function(){return e(e.s=14858)}),_N_E=e.O()}]);
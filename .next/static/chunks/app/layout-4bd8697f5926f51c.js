(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{99489:function(e,r,t){Promise.resolve().then(t.t.bind(t,99646,23)),Promise.resolve().then(t.t.bind(t,63385,23)),Promise.resolve().then(t.bind(t,50191)),Promise.resolve().then(t.bind(t,83779))},50191:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return d}});var s=t(3827),a=t(64090),o=t(8792),n=t(14570),l=t(40796),i=()=>{var e,r;let[t,i]=(0,a.useState)(!1),c=(0,a.useRef)(null),{usuarioAtual:u,logout:d}=(0,n.G)(),h=()=>i(!1);return(0,s.jsx)("header",{className:"border-b shadow-sm",style:{backgroundColor:"var(--cor-primaria)",color:"white",borderColor:"var(--cor-borda)"},children:(0,s.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(l.Z,{className:"text-xl"}),(0,s.jsx)("span",{className:"text-xs sm:text-sm whitespace-nowrap",children:"- Sistema de Fichas T\xe9cnicas"})]}),(0,s.jsx)("div",{className:"flex items-center space-x-4",children:(0,s.jsxs)("div",{className:"relative",onMouseEnter:()=>{c.current&&clearTimeout(c.current),i(!0)},onMouseLeave:()=>{c.current=setTimeout(()=>i(!1),200)},children:[(0,s.jsxs)("button",{onClick:()=>{i(!t)},className:"flex items-center space-x-2 focus:outline-none",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-white text-gray-800 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-sm font-medium",children:(null==u?void 0:null===(r=u.nome)||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.toUpperCase())||"U"})}),(0,s.jsx)("span",{className:"hidden md:block text-sm font-medium text-white",children:(null==u?void 0:u.nome)||"Usu\xe1rio"})]}),t&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10",children:[(0,s.jsx)(o.default,{href:"/configuracoes/perfil",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Perfil"}),(0,s.jsx)(o.default,{href:"/configuracoes",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Configura\xe7\xf5es"}),(0,s.jsx)("div",{className:"border-t",style:{borderColor:"var(--cor-borda)"}}),(0,s.jsx)("button",{onClick:()=>{d(),h()},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Sair"})]})]})})]})})},c=()=>{let[e,r]=(0,a.useState)(!1);return(0,s.jsxs)("aside",{className:"text-white transition-all duration-300 ".concat(e?"w-16":"w-64"," min-h-screen flex flex-col"),style:{backgroundColor:"var(--cor-primaria)"},children:[(0,s.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[!e&&(0,s.jsx)(l.Z,{className:"text-xl",showTagline:!1}),(0,s.jsx)("button",{onClick:()=>r(e=>!e),className:"p-2 rounded-full hover:bg-[var(--cor-secundaria)] focus:outline-none","aria-label":"Alternar menu lateral","aria-expanded":!e,children:(0,s.jsx)("span",{className:"material-icons",children:e?"chevron_right":"chevron_left"})})]}),(0,s.jsx)("nav",{className:"mt-4 flex-1",children:(0,s.jsx)("ul",{children:[{href:"/",icon:"dashboard",label:"Dashboard"},{href:"/fichas-tecnicas",icon:"receipt",label:"Fichas T\xe9cnicas"},{href:"/produtos",icon:"inventory",label:"Insumos"},{href:"/estoque",icon:"store",label:"Estoque de Insumos"},{href:"/producao",icon:"factory",label:"Produ\xe7\xe3o"},{href:"/estoque-producao",icon:"warehouse",label:"Estoque de Produ\xe7\xe3o"},{href:"/precos",icon:"attach_money",label:"Pre\xe7os de Venda"},{href:"/relatorios",icon:"bar_chart",label:"Relat\xf3rios"},{href:"/configuracoes",icon:"settings",label:"Configura\xe7\xf5es"}].map(r=>{let{href:t,icon:a,label:n}=r;return(0,s.jsx)("li",{children:(0,s.jsxs)(o.default,{href:t,className:"flex items-center px-4 py-3 hover:bg-[var(--cor-secundaria)] transition-colors",children:[(0,s.jsx)("span",{className:"material-icons mr-3",children:a}),!e&&(0,s.jsx)("span",{className:"text-sm",children:n})]})},t)})})})]})},u=t(47907),d=e=>{let{children:r}=e,{usuarioAtual:t}=(0,n.G)(),o=(0,u.useRouter)(),l=(0,u.usePathname)();(0,a.useEffect)(()=>{t||"/login"===l||"/usuarios/novo"===l||o.push("/login"),t&&("/login"===l||"/usuarios/novo"===l)&&o.push("/")},[t,l,o]);let d="/login"===l||"/usuarios/novo"===l||l.includes("/imprimir");return(0,s.jsxs)("div",{className:"flex h-screen",style:{backgroundColor:"var(--cor-fundo)"},children:[!d&&(0,s.jsx)(c,{}),(0,s.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden",children:[!d&&(0,s.jsx)(i,{}),(0,s.jsx)("main",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:r}),!d&&(0,s.jsxs)("footer",{className:"p-4 text-center text-sm border-t",style:{backgroundColor:"white",color:"var(--cor-texto-secundario)",borderColor:"var(--cor-borda)"},children:["CustoChef \xa9 ",new Date().getFullYear()]})]})]})}},40796:function(e,r,t){"use strict";var s=t(3827),a=t(20703);t(64090),r.Z=e=>{let{className:r="",showTagline:t=!1}=e;return(0,s.jsxs)("span",{className:"inline-flex items-center space-x-2 ".concat(r),children:[(0,s.jsx)(a.default,{src:"/logo.svg",alt:"GastroChef",width:24,height:24}),(0,s.jsx)("span",{className:"font-bold",children:"GastroChef"}),t&&(0,s.jsx)("span",{className:"text-xs whitespace-nowrap",children:"Sistema de Fichas T\xe9cnicas"})]})}},83779:function(e,r,t){"use strict";t.r(r),t.d(r,{AuthProvider:function(){return i},useAuth:function(){return c}});var s=t(3827),a=t(64090),o=t(28896),n=t(47907);let l=(0,a.createContext)(void 0),i=e=>{let{children:r}=e,t=(0,n.useRouter)(),[i,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(null),[h,m]=(0,a.useState)(!0),f=(0,o.createBrowserClient)("https://sutmfzcmrlqnocsusiav.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1dG1memNtcmxxbm9jc3VzaWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1MzgwODMsImV4cCI6MjA2NjExNDA4M30.BQRo64qRNzqB_XGNeSe4jkZ8Mzzji8eUYVbS_nWw8tI");(0,a.useEffect)(()=>{(async()=>{let{data:e,error:r}=await f.auth.getSession();e.session?(d(e.session),c(e.session.user)):(d(null),c(null)),m(!1)})();let{data:e}=f.auth.onAuthStateChange((e,r)=>{d(r),c((null==r?void 0:r.user)||null)});return()=>{e.subscription.unsubscribe()}},[]);let x=async()=>{await f.auth.signOut(),c(null),d(null),t.push("/login")};return(0,s.jsx)(l.Provider,{value:{user:i,session:u,loading:h,signOut:x},children:r})},c=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},32355:function(e,r,t){"use strict";t.d(r,{g:function(){return a}});let s=()=>localStorage.getItem("auth_token"),a=()=>{let e=s();return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}},14570:function(e,r,t){"use strict";t.d(r,{G:function(){return l}});var s=t(64090),a=t(32355);let o=async()=>{try{console.log("\uD83D\uDCE1 Fazendo chamada para /api/auth/users...");let e=await fetch("/api/auth/users",{headers:(0,a.g)()});if(console.log("\uD83D\uDCE1 Response status: ".concat(e.status)),!e.ok){let r=await e.text();throw console.error("❌ Erro na API users: ".concat(e.status," - ").concat(r)),Error("Erro ao buscar usu\xe1rios: ".concat(e.status))}let r=await e.json();return console.log("✅ Usu\xe1rios da API: ".concat(r.length)),r.map(e=>({role:"viewer",...e}))}catch(e){return console.error("❌ Erro ao buscar usu\xe1rios da API:",e),[]}},n=e=>e.filter(e=>!e.oculto),l=()=>{let[e,r]=(0,s.useState)([]),[t,l]=(0,s.useState)(null),[i,c]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{try{c(!0),console.log("\uD83D\uDD0D Carregando usu\xe1rios...");let e=localStorage.getItem("auth_token"),t=localStorage.getItem("user_data");if(console.log("\uD83D\uDD10 Auth state:",{tokenExists:!!e,userDataExists:!!t}),e&&t&&"undefined"!==t){let e=JSON.parse(t);if(console.log("✅ Usu\xe1rio atual carregado:",e.email),l(e),"admin"===e.role){let e=await o();console.log("✅ Usu\xe1rios carregados:",(null==e?void 0:e.length)||0),r(e)}else console.log("\uD83D\uDC64 User is not admin, skipping users list"),r([])}else console.log("⚠️ No valid auth token or user data found"),l(null),r([])}catch(e){console.error("❌ Erro ao carregar usu\xe1rios:",e),r([]),l(null)}finally{c(!1)}})()},[]);let u=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{6,}$/.test(e),d=async t=>{if(e.some(e=>e.email===t.email)||!u(t.senha))return null;try{let s=await fetch("/api/auth/register",{method:"POST",headers:(0,a.g)(),body:JSON.stringify(t)}),o=await s.json();if(!s.ok)return console.error("Erro no registro:",o),null;let n=[...e,o];return r(n),o}catch(e){return console.error("Erro ao registrar usu\xe1rio:",e),null}},h=()=>{l(null),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")},m=async e=>{try{if(!(await fetch("/api/auth/users/".concat(e),{method:"DELETE",headers:(0,a.g)()})).ok)throw Error("Erro ao deletar usu\xe1rio");let s=await o();return r(n(s)),(null==t?void 0:t.id)===e&&h(),!0}catch(e){return console.error("Erro ao remover usu\xe1rio:",e),!1}},f=async(e,s)=>{try{if(!(await fetch("/api/auth/users/".concat(e,"/password"),{method:"PUT",headers:(0,a.g)(),body:JSON.stringify({novaSenha:s})})).ok)throw Error("Erro ao alterar senha");let i=await o();if(r(n(i)),(null==t?void 0:t.id)===e){let r=i.find(r=>r.id===e)||null;l(r)}return!0}catch(e){return console.error("Erro ao alterar senha:",e),!1}},x=async(e,s)=>{try{if((await o()).some(r=>r.email===s.email&&r.id!==e))return!1;if(!(await fetch("/api/auth/users/".concat(e),{method:"PUT",headers:(0,a.g)(),body:JSON.stringify(s)})).ok)throw Error("Erro ao editar usu\xe1rio");let i=await o();if(r(n(i)),(null==t?void 0:t.id)===e){let r=i.find(r=>r.id===e)||null;l(r),localStorage.setItem("user_data",JSON.stringify(r))}return!0}catch(e){return console.error("Erro ao editar usu\xe1rio:",e),!1}};return{usuarios:e,usuarioAtual:t,isLoading:i,registrarUsuario:d,login:async(e,t)=>{try{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,senha:t})});if(!s.ok)return null;let{user:a,token:i}=await s.json();l(a),localStorage.setItem("auth_token",i),localStorage.setItem("user_data",JSON.stringify(a));let c=await o();if(!c.find(e=>e.id===a.id)){let e=[...c,a];r(n(e))}return a}catch(e){return null}},logout:h,removerUsuario:m,alterarSenha:f,editarUsuario:x}}},63385:function(){},99646:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c"}}},function(e){e.O(0,[792,958,703,971,69,744],function(){return e(e.s=99489)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{39460:function(e,a,t){Promise.resolve().then(t.bind(t,48836))},48836:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return d}});var s=t(3827),r=t(64090),i=t(57418),c=t(53500),o=t(27742),n=t(16297);function d(){let{gerarRelatorioCompleto:e}=(0,c.j)(),{produtos:a}=(0,o.U)(),{fichasTecnicas:t}=(0,n.vG)(),[d,l]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{m(!0);try{let a=await e();l(a)}catch(e){console.error("Erro ao gerar relat\xf3rio:",e)}finally{m(!1)}})()},[e]);let h=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e);return u?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Dashboard"}),(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Carregando dados do dashboard..."})})]}):d?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Dashboard"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,s.jsx)(i.Z,{children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-500",children:"Total de Produtos"}),(0,s.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:d.totalProdutos})]})}),(0,s.jsx)(i.Z,{children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-500",children:"Total de Fichas T\xe9cnicas"}),(0,s.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:d.totalFichasTecnicas})]})}),(0,s.jsx)(i.Z,{children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-500",children:"Custo Total Estimado"}),(0,s.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:h(d.custoTotalEstoque)})]})}),(0,s.jsx)(i.Z,{children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-500",children:"Custo M\xe9dio por Ficha"}),(0,s.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:h(d.custoMedioPorFicha)})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)(i.Z,{title:"Fichas T\xe9cnicas Mais Caras",children:(0,s.jsx)("div",{className:"space-y-4",children:d.fichasMaisCustos.length>0?(0,s.jsx)("ul",{className:"divide-y divide-gray-200",children:d.fichasMaisCustos.map((e,a)=>(0,s.jsxs)("li",{className:"py-3 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"bg-blue-100 text-blue-800 font-medium rounded-full w-6 h-6 flex items-center justify-center mr-3",children:a+1}),(0,s.jsx)("span",{className:"text-gray-900 font-medium",children:e.nome})]}),(0,s.jsx)("span",{className:"text-gray-700 font-medium",children:h(e.custo)})]},e.id))}):(0,s.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Nenhuma ficha t\xe9cnica cadastrada"})})}),(0,s.jsx)(i.Z,{title:"Fichas T\xe9cnicas Mais Econ\xf4micas",children:(0,s.jsx)("div",{className:"space-y-4",children:d.fichasMenosCustos.length>0?(0,s.jsx)("ul",{className:"divide-y divide-gray-200",children:d.fichasMenosCustos.map((e,a)=>(0,s.jsxs)("li",{className:"py-3 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"bg-green-100 text-green-800 font-medium rounded-full w-6 h-6 flex items-center justify-center mr-3",children:a+1}),(0,s.jsx)("span",{className:"text-gray-900 font-medium",children:e.nome})]}),(0,s.jsx)("span",{className:"text-gray-700 font-medium",children:h(e.custo)})]},e.id))}):(0,s.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Nenhuma ficha t\xe9cnica cadastrada"})})})]}),(0,s.jsx)(i.Z,{title:"Ingredientes Mais Utilizados",children:(0,s.jsx)("div",{className:"space-y-4",children:d.ingredientesMaisUsados.length>0?(0,s.jsx)("ul",{className:"divide-y divide-gray-200",children:d.ingredientesMaisUsados.map(e=>(0,s.jsxs)("li",{className:"py-3 flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-900 font-medium",children:e.nome}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("span",{className:"text-gray-700",children:[e.quantidade," ",e.unidade]}),(0,s.jsxs)("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs",children:[e.ocorrencias," ",1===e.ocorrencias?"receita":"receitas"]})]})]},e.id))}):(0,s.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Nenhum ingrediente utilizado"})})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)(i.Z,{title:"Distribui\xe7\xe3o de Categorias de Produtos",children:(0,s.jsx)("div",{className:"space-y-4",children:d.distribuicaoCategoriasProdutos.length>0?(0,s.jsx)("ul",{className:"divide-y divide-gray-200",children:d.distribuicaoCategoriasProdutos.map(e=>(0,s.jsxs)("li",{className:"py-3 flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-900",children:e.categoria}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-48 bg-gray-200 rounded-full h-2.5 mr-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:"".concat(e.quantidade/d.totalProdutos*100,"%")}})}),(0,s.jsx)("span",{className:"text-gray-700",children:e.quantidade})]})]},e.categoria))}):(0,s.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Nenhum produto cadastrado"})})}),(0,s.jsx)(i.Z,{title:"Distribui\xe7\xe3o de Categorias de Receitas",children:(0,s.jsx)("div",{className:"space-y-4",children:d.distribuicaoCategoriasReceitas.length>0?(0,s.jsx)("ul",{className:"divide-y divide-gray-200",children:d.distribuicaoCategoriasReceitas.map(e=>(0,s.jsxs)("li",{className:"py-3 flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-900",children:e.categoria}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-48 bg-gray-200 rounded-full h-2.5 mr-2",children:(0,s.jsx)("div",{className:"bg-green-600 h-2.5 rounded-full",style:{width:"".concat(e.quantidade/d.totalFichasTecnicas*100,"%")}})}),(0,s.jsx)("span",{className:"text-gray-700",children:e.quantidade})]})]},e.categoria))}):(0,s.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Nenhuma ficha t\xe9cnica cadastrada"})})})]})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Dashboard"}),(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Erro ao carregar dados do dashboard"})})]})}},53018:function(e,a,t){"use strict";t.d(a,{D:function(){return o},u:function(){return n}});var s=t(64090),r=t(32355);let i=async()=>{try{console.log("\uD83D\uDD0D Buscando categorias de produtos...");let e=await fetch("/api/categorias",{headers:(0,r.g)()});if(console.log("\uD83D\uDCE1 Response status: ".concat(e.status)),!e.ok){let a=await e.text();throw console.error("❌ Erro na API categorias: ".concat(e.status," - ").concat(a)),Error("Erro ao buscar categorias: ".concat(e.status))}let a=await e.json();return console.log("✅ Categorias carregadas: ".concat(a.length)),a}catch(e){return console.error("❌ Erro ao buscar categorias da API:",e),[]}},c=[{id:"hortifruti",nome:"Hortifruti"},{id:"carnes",nome:"Carnes"},{id:"laticinios",nome:"Latic\xednios"},{id:"graos",nome:"Gr\xe3os e Cereais"},{id:"bebidas",nome:"Bebidas"},{id:"temperos",nome:"Temperos"},{id:"outros",nome:"Outros"}],o=()=>{let[e,a]=(0,s.useState)([]),[t,o]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{try{o(!0);let e=await i();if(0===e.length){for(let a of c)try{if(!e.find(e=>e.nome===a.nome)){let t=await fetch("/api/categorias",{method:"POST",headers:(0,r.g)(),body:JSON.stringify({nome:a.nome})});if(t.ok){let a=await t.json();e.push(a)}else 409===t.status&&console.log("Categoria '".concat(a.nome,"' j\xe1 existe, pulando..."))}}catch(e){console.error("Erro ao criar categoria padr\xe3o:",e)}e=await i()}console.log("Categorias loaded:",(null==e?void 0:e.length)||0),a(e)}catch(e){console.error("Erro ao carregar categorias:",e),a([])}finally{o(!1)}})()},[]);let n=async t=>{try{let s=await fetch("/api/categorias",{method:"POST",headers:(0,r.g)(),body:JSON.stringify({nome:t})});if(!s.ok)throw Error("Erro ao criar categoria");let i=await s.json(),c=[...e,i];return a(c),i}catch(e){return console.error("Erro ao adicionar categoria:",e),null}},d=async(t,s)=>{try{let i=await fetch("/api/categorias/".concat(t),{method:"PUT",headers:(0,r.g)(),body:JSON.stringify({nome:s})});if(!i.ok)throw Error("Erro ao atualizar categoria");let c=await i.json(),o=e.map(e=>e.id===t?c:e);return a(o),c}catch(e){return console.error("Erro ao atualizar categoria:",e),null}},l=async t=>{try{if(!(await fetch("/api/categorias/".concat(t),{method:"DELETE",headers:(0,r.g)()})).ok)throw Error("Erro ao deletar categoria");let s=e.filter(e=>e.id!==t);return a(s),!0}catch(e){return console.error("Erro ao remover categoria:",e),!1}};return{categorias:e,isLoading:t,adicionarCategoria:n,atualizarCategoria:d,removerCategoria:l,obterCategoriaPorId:a=>e.find(e=>e.id===a)}},n=async e=>{if(!e)return"N\xe3o informado";let a=(await i()).find(a=>a.id===e);return a?a.nome:e}},53500:function(e,a,t){"use strict";t.d(a,{j:function(){return n}});var s=t(64090),r=t(27742),i=t(53018),c=t(29130),o=t(16297);let n=()=>{let{produtos:e}=(0,r.U)(),{fichasTecnicas:a}=(0,o.vG)(),{calcularEstoqueAtual:t}=(0,c.H)(),n=(0,s.useCallback)(async()=>{let t=e.length,s=a.length,r=e.reduce((e,a)=>e+a.preco,0),c=a.length>0?a.reduce((e,a)=>e+a.custoTotal,0)/a.length:0,n=[...a].sort((e,a)=>a.custoTotal-e.custoTotal),d=n.slice(0,5).map(e=>({id:e.id,nome:e.nome,custo:e.custoTotal})),l=[...n].reverse().slice(0,5).map(e=>({id:e.id,nome:e.nome,custo:e.custoTotal})),u={};a.forEach(e=>{e.ingredientes.forEach(e=>{u[e.produtoId]||(u[e.produtoId]={quantidade:0,ocorrencias:0}),u[e.produtoId].quantidade+=e.quantidade,u[e.produtoId].ocorrencias+=1})});let m=Object.entries(u).map(a=>{let[t,s]=a,r=e.find(e=>e.id===t);return{id:t,nome:r?r.nome:"Produto n\xe3o encontrado",quantidade:s.quantidade,unidade:r?r.unidadeMedida:"",ocorrencias:s.ocorrencias}}).sort((e,a)=>a.ocorrencias-e.ocorrencias).slice(0,10),h={};e.forEach(e=>{let a=e.categoria||"N\xe3o informado";h[a]||(h[a]=0),h[a]+=1});let x=await Promise.all(Object.entries(h).map(async e=>{let[a,t]=e;return{categoria:await (0,i.u)(a),quantidade:t}})).then(e=>e.sort((e,a)=>a.quantidade-e.quantidade)),g={};return a.forEach(e=>{let a=e.categoria;g[a]||(g[a]=0),g[a]+=1}),{totalProdutos:t,totalFichasTecnicas:s,custoTotalEstoque:r,custoMedioPorFicha:c,fichasMaisCustos:d,fichasMenosCustos:l,ingredientesMaisUsados:m,distribuicaoCategoriasProdutos:x,distribuicaoCategoriasReceitas:(await Promise.all(Object.entries(g).map(async e=>{let[a,t]=e;return{categoria:await (0,o.Q_)(a),quantidade:t}}))).sort((e,a)=>a.quantidade-e.quantidade)}},[e,a,t]),d=async()=>{let e=await n();return{custoTotalEstoque:e.custoTotalEstoque,custoMedioPorFicha:e.custoMedioPorFicha,fichasMaisCustos:e.fichasMaisCustos,fichasMenosCustos:e.fichasMenosCustos}},l=async()=>{let e=await n();return{ingredientesMaisUsados:e.ingredientesMaisUsados,distribuicaoCategoriasProdutos:e.distribuicaoCategoriasProdutos}},u=async()=>{let e=await n();return{totalFichasTecnicas:e.totalFichasTecnicas,distribuicaoCategoriasReceitas:e.distribuicaoCategoriasReceitas}};return{gerarRelatorioCompleto:n,gerarRelatorioCustos:d,gerarRelatorioIngredientes:l,gerarRelatorioReceitas:u,gerarRelatorioEstoque:()=>{let a=e.map(e=>{let a=t(e.id);return{id:e.id,nome:e.nome,quantidade:a,preco:e.preco,valorTotal:a*e.preco}}),s=a.reduce((e,a)=>e+a.valorTotal,0);return{itens:a,valorTotalEstoque:s}}}}}},function(e){e.O(0,[7176,3837,30,2971,8069,1744],function(){return e(e.s=39460)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[163],{9173:function(r,e,o){Promise.resolve().then(o.bind(o,81184))},47907:function(r,e,o){"use strict";var a=o(15313);o.o(a,"redirect")&&o.d(e,{redirect:function(){return a.redirect}}),o.o(a,"useParams")&&o.d(e,{useParams:function(){return a.useParams}}),o.o(a,"useRouter")&&o.d(e,{useRouter:function(){return a.useRouter}})},81184:function(r,e,o){"use strict";o.r(e),o.d(e,{default:function(){return f}});var a=o(3827),i=o(64090),t=o(47907),n=o(57418),s=o(32278),l=o(79173),c=o(66651),d=o(27742),u=o(18061),m=o(53018),g=o(93242);function f(){let r=(0,t.useParams)(),e=(0,t.useRouter)(),{obterProdutoPorId:o,atualizarProduto:f,isLoading:b}=(0,d.Ug)(),{categorias:p}=(0,m.D)(),{unidades:h}=(0,u.x)(),[N,v]=(0,i.useState)(!1),[x,y]=(0,i.useState)(!1),[E,j]=(0,i.useState)("");(0,i.useEffect)(()=>{if(!E)return;let r=setTimeout(()=>j(""),3e3);return()=>clearTimeout(r)},[E]);let w=r.id,[S,C]=(0,i.useState)({nome:"",categoria:"",marca:"",unidadeMedida:"",preco:"",fornecedor:"",pesoEmbalagem:"",infoNutricional:{calorias:"",carboidratos:"",proteinas:"",gordurasTotais:"",gordurasSaturadas:"",gordurasTrans:"",fibras:"",sodio:""}}),[T,k]=(0,i.useState)({});if((0,i.useEffect)(()=>{var r,a,i,t,n,s,l,c,d,u,m,g,f,p,h,N,v,x;if(b)return;let E=o(w);if(!E){e.push("/produtos");return}C({nome:E.nome,categoria:E.categoria||"",marca:E.marca||"",unidadeMedida:E.unidadeMedida,preco:(null===(r=E.preco)||void 0===r?void 0:r.toString())||"",fornecedor:E.fornecedor,pesoEmbalagem:(null===(a=E.pesoEmbalagem)||void 0===a?void 0:a.toString())||"",infoNutricional:{calorias:(null===(t=E.infoNutricional)||void 0===t?void 0:null===(i=t.calorias)||void 0===i?void 0:i.toString())||"",carboidratos:(null===(s=E.infoNutricional)||void 0===s?void 0:null===(n=s.carboidratos)||void 0===n?void 0:n.toString())||"",proteinas:(null===(c=E.infoNutricional)||void 0===c?void 0:null===(l=c.proteinas)||void 0===l?void 0:l.toString())||"",gordurasTotais:(null===(u=E.infoNutricional)||void 0===u?void 0:null===(d=u.gordurasTotais)||void 0===d?void 0:d.toString())||"",gordurasSaturadas:(null===(g=E.infoNutricional)||void 0===g?void 0:null===(m=g.gordurasSaturadas)||void 0===m?void 0:m.toString())||"",gordurasTrans:(null===(p=E.infoNutricional)||void 0===p?void 0:null===(f=p.gordurasTrans)||void 0===f?void 0:f.toString())||"",fibras:(null===(N=E.infoNutricional)||void 0===N?void 0:null===(h=N.fibras)||void 0===h?void 0:h.toString())||"",sodio:(null===(x=E.infoNutricional)||void 0===x?void 0:null===(v=x.sodio)||void 0===v?void 0:v.toString())||""}}),y(!!E.infoNutricional)},[b,w]),b)return(0,a.jsx)("p",{children:"Carregando..."});let D=r=>{let{name:e,value:o}=r.target;if(e.includes(".")){let[r,a]=e.split(".");C(e=>({...e,[r]:{...e[r],[a]:o}}))}else C(r=>({...r,[e]:o}))},Z=()=>{let r={};if(S.nome||(r.nome="Nome \xe9 obrigat\xf3rio"),S.categoria||(r.categoria="Categoria \xe9 obrigat\xf3ria"),S.unidadeMedida||(r.unidadeMedida="Unidade de medida \xe9 obrigat\xf3ria"),S.preco?(isNaN(Number(S.preco))||0>=Number(S.preco))&&(r.preco="Pre\xe7o deve ser um n\xfamero positivo"):r.preco="Pre\xe7o \xe9 obrigat\xf3rio",S.fornecedor||(r.fornecedor="Fornecedor \xe9 obrigat\xf3rio"),(!S.pesoEmbalagem||isNaN(Number(S.pesoEmbalagem))||0>=Number(S.pesoEmbalagem))&&(r.pesoEmbalagem="Informe o peso por embalagem"),x){let e=S.infoNutricional;e.calorias&&isNaN(Number(e.calorias))&&(r["infoNutricional.calorias"]="Deve ser um n\xfamero"),e.carboidratos&&isNaN(Number(e.carboidratos))&&(r["infoNutricional.carboidratos"]="Deve ser um n\xfamero"),e.proteinas&&isNaN(Number(e.proteinas))&&(r["infoNutricional.proteinas"]="Deve ser um n\xfamero"),e.gordurasTotais&&isNaN(Number(e.gordurasTotais))&&(r["infoNutricional.gordurasTotais"]="Deve ser um n\xfamero"),e.gordurasSaturadas&&isNaN(Number(e.gordurasSaturadas))&&(r["infoNutricional.gordurasSaturadas"]="Deve ser um n\xfamero"),e.gordurasTrans&&isNaN(Number(e.gordurasTrans))&&(r["infoNutricional.gordurasTrans"]="Deve ser um n\xfamero"),e.fibras&&isNaN(Number(e.fibras))&&(r["infoNutricional.fibras"]="Deve ser um n\xfamero"),e.sodio&&isNaN(Number(e.sodio))&&(r["infoNutricional.sodio"]="Deve ser um n\xfamero")}return k(r),0===Object.keys(r).length};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(g.Z,{message:E,onClose:()=>j("")}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Editar Insumo"}),(0,a.jsx)("form",{onSubmit:r=>{if(r.preventDefault(),Z()){v(!0);try{let r={...S,preco:Number(S.preco),pesoEmbalagem:Number(S.pesoEmbalagem),infoNutricional:x?{calorias:Number(S.infoNutricional.calorias)||0,carboidratos:Number(S.infoNutricional.carboidratos)||0,proteinas:Number(S.infoNutricional.proteinas)||0,gordurasTotais:Number(S.infoNutricional.gordurasTotais)||0,gordurasSaturadas:Number(S.infoNutricional.gordurasSaturadas)||0,gordurasTrans:Number(S.infoNutricional.gordurasTrans)||0,fibras:Number(S.infoNutricional.fibras)||0,sodio:Number(S.infoNutricional.sodio)||0}:void 0};f(w,r),e.push("/produtos/".concat(w))}catch(r){console.error("Erro ao atualizar produto:",r),j("Erro ao atualizar produto")}finally{v(!1)}}},children:(0,a.jsxs)(n.Z,{children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsx)(s.Z,{label:"Nome do Insumo *",name:"nome",value:S.nome,onChange:D,error:T.nome,placeholder:"Ex: Farinha de Trigo"}),(0,a.jsx)(l.Z,{label:"Categoria *",name:"categoria",value:S.categoria,onChange:D,options:p.map(r=>({value:r.id,label:r.nome})).sort((r,e)=>r.label.localeCompare(e.label)),error:T.categoria}),(0,a.jsx)(s.Z,{label:"Marca",name:"marca",value:S.marca,onChange:D,placeholder:"Ex: Dona Benta"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsx)(l.Z,{label:"Unidade de Medida *",name:"unidadeMedida",value:S.unidadeMedida,onChange:D,options:h.map(r=>({value:r.id,label:r.nome})).sort((r,e)=>r.label.localeCompare(e.label)),error:T.unidadeMedida}),(0,a.jsx)(s.Z,{label:"Pre\xe7o (R$) *",name:"preco",type:"number",step:"0.01",min:"0",value:S.preco,onChange:D,error:T.preco,placeholder:"Ex: 5.99"}),(0,a.jsx)(s.Z,{label:"Fornecedor *",name:"fornecedor",value:S.fornecedor,onChange:D,error:T.fornecedor,placeholder:"Ex: Distribuidora Alimentos"}),(0,a.jsx)(s.Z,{label:"Peso/Volume por Embalagem (g ou ml) *",name:"pesoEmbalagem",type:"number",min:"0",value:S.pesoEmbalagem,onChange:D,error:T.pesoEmbalagem,placeholder:"Ex: 1000"})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)("input",{type:"checkbox",id:"mostrarInfoNutricional",checked:x,onChange:()=>y(!x),className:"h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),(0,a.jsx)("label",{htmlFor:"mostrarInfoNutricional",className:"ml-2 text-sm font-medium text-gray-700",children:"Adicionar informa\xe7\xf5es nutricionais (por 100g/100ml)"})]}),x&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)(s.Z,{label:"Calorias (kcal)",name:"infoNutricional.calorias",type:"number",min:"0",value:S.infoNutricional.calorias,onChange:D,error:T["infoNutricional.calorias"]}),(0,a.jsx)(s.Z,{label:"Carboidratos (g)",name:"infoNutricional.carboidratos",type:"number",min:"0",step:"0.1",value:S.infoNutricional.carboidratos,onChange:D,error:T["infoNutricional.carboidratos"]}),(0,a.jsx)(s.Z,{label:"Prote\xednas (g)",name:"infoNutricional.proteinas",type:"number",min:"0",step:"0.1",value:S.infoNutricional.proteinas,onChange:D,error:T["infoNutricional.proteinas"]}),(0,a.jsx)(s.Z,{label:"Gorduras Totais (g)",name:"infoNutricional.gordurasTotais",type:"number",min:"0",step:"0.1",value:S.infoNutricional.gordurasTotais,onChange:D,error:T["infoNutricional.gordurasTotais"]}),(0,a.jsx)(s.Z,{label:"Gorduras Saturadas (g)",name:"infoNutricional.gordurasSaturadas",type:"number",min:"0",step:"0.1",value:S.infoNutricional.gordurasSaturadas,onChange:D,error:T["infoNutricional.gordurasSaturadas"]}),(0,a.jsx)(s.Z,{label:"Gorduras Trans (g)",name:"infoNutricional.gordurasTrans",type:"number",min:"0",step:"0.1",value:S.infoNutricional.gordurasTrans,onChange:D,error:T["infoNutricional.gordurasTrans"]}),(0,a.jsx)(s.Z,{label:"Fibras (g)",name:"infoNutricional.fibras",type:"number",min:"0",step:"0.1",value:S.infoNutricional.fibras,onChange:D,error:T["infoNutricional.fibras"]}),(0,a.jsx)(s.Z,{label:"S\xf3dio (mg)",name:"infoNutricional.sodio",type:"number",min:"0",step:"0.1",value:S.infoNutricional.sodio,onChange:D,error:T["infoNutricional.sodio"]})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,a.jsx)(c.Z,{type:"button",variant:"outline",onClick:()=>e.push("/produtos/".concat(w)),children:"Cancelar"}),(0,a.jsx)(c.Z,{type:"submit",variant:"primary",isLoading:N,children:"Atualizar Insumo"})]})]})})]})}},66651:function(r,e,o){"use strict";var a=o(3827);o(64090),e.Z=r=>{let{children:e,variant:o="primary",size:i="md",isLoading:t=!1,fullWidth:n=!1,className:s="",disabled:l,...c}=r,d=l||t?"opacity-50 cursor-not-allowed":"";return(0,a.jsxs)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-[var(--cor-acao)] text-white hover:brightness-90 focus:ring-[var(--cor-acao)]",secondary:"bg-[var(--cor-secundaria)] text-white hover:brightness-90 focus:ring-[var(--cor-secundaria)]",success:"bg-[var(--cor-sucesso)] text-white hover:brightness-90 focus:ring-[var(--cor-sucesso)]",danger:"bg-[var(--cor-erro)] text-white hover:brightness-90 focus:ring-[var(--cor-erro)]",outline:"bg-white text-[var(--cor-texto-principal)] border border-[var(--cor-borda)] hover:bg-gray-50 focus:ring-[var(--cor-acao)]"}[o]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[i]," ").concat(n?"w-full":""," ").concat(d," ").concat(s),disabled:l||t,...c,children:[t&&(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e]})}},32278:function(r,e,o){"use strict";var a=o(3827);let i=(0,o(64090).forwardRef)((r,e)=>{let{label:o,error:i,helperText:t,className:n="",...s}=r;return(0,a.jsxs)("div",{className:"mb-4",children:[o&&(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--cor-texto-principal)"},children:o}),(0,a.jsx)("input",{ref:e,className:"w-full input ".concat(i?"border-[var(--cor-erro)]":""," ").concat(n),...s}),i&&(0,a.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-erro)"},children:i}),t&&!i&&(0,a.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-texto-secundario)"},children:t})]})});i.displayName="Input",e.Z=i},79173:function(r,e,o){"use strict";var a=o(3827);let i=(0,o(64090).forwardRef)((r,e)=>{let{label:o,error:i,helperText:t,options:n,className:s="",...l}=r;return(0,a.jsxs)("div",{className:"mb-4",children:[o&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:o}),(0,a.jsxs)("select",{ref:e,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 \n            ".concat(i?"border-red-500":"border-gray-300"," \n            ").concat(s),...l,children:[(0,a.jsx)("option",{value:"",children:"Selecione..."}),n.map(r=>(0,a.jsx)("option",{value:r.value,children:r.label},r.value))]}),i&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i}),t&&!i&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:t})]})});i.displayName="Select",e.Z=i},93242:function(r,e,o){"use strict";var a=o(3827),i=o(64090);e.Z=r=>{let{message:e,onClose:o}=r;return((0,i.useEffect)(()=>{if(!e)return;let r=setTimeout(o,3e3);return()=>clearTimeout(r)},[e,o]),e)?(0,a.jsx)("div",{className:"fixed top-4 right-4 bg-[var(--cor-sucesso)] text-white px-4 py-2 rounded shadow",children:e}):null}},53018:function(r,e,o){"use strict";o.d(e,{D:function(){return s},u:function(){return l}});var a=o(64090),i=o(32355);let t=async()=>{try{console.log("\uD83D\uDD0D Buscando categorias de produtos...");let r=await fetch("/api/categorias",{headers:(0,i.g)()});if(console.log("\uD83D\uDCE1 Response status: ".concat(r.status)),!r.ok){let e=await r.text();throw console.error("❌ Erro na API categorias: ".concat(r.status," - ").concat(e)),Error("Erro ao buscar categorias: ".concat(r.status))}let e=await r.json();return console.log("✅ Categorias carregadas: ".concat(e.length)),e}catch(r){return console.error("❌ Erro ao buscar categorias da API:",r),[]}},n=[{id:"hortifruti",nome:"Hortifruti"},{id:"carnes",nome:"Carnes"},{id:"laticinios",nome:"Latic\xednios"},{id:"graos",nome:"Gr\xe3os e Cereais"},{id:"bebidas",nome:"Bebidas"},{id:"temperos",nome:"Temperos"},{id:"outros",nome:"Outros"}],s=()=>{let[r,e]=(0,a.useState)([]),[o,s]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{s(!0);let r=await t();if(0===r.length){for(let e of n)try{if(!r.find(r=>r.nome===e.nome)){let o=await fetch("/api/categorias",{method:"POST",headers:(0,i.g)(),body:JSON.stringify({nome:e.nome})});if(o.ok){let e=await o.json();r.push(e)}else 409===o.status&&console.log("Categoria '".concat(e.nome,"' j\xe1 existe, pulando..."))}}catch(r){console.error("Erro ao criar categoria padr\xe3o:",r)}r=await t()}console.log("Categorias loaded:",(null==r?void 0:r.length)||0),e(r)}catch(r){console.error("Erro ao carregar categorias:",r),e([])}finally{s(!1)}})()},[]);let l=async o=>{try{let a=await fetch("/api/categorias",{method:"POST",headers:(0,i.g)(),body:JSON.stringify({nome:o})});if(!a.ok)throw Error("Erro ao criar categoria");let t=await a.json(),n=[...r,t];return e(n),t}catch(r){return console.error("Erro ao adicionar categoria:",r),null}},c=async(o,a)=>{try{let t=await fetch("/api/categorias/".concat(o),{method:"PUT",headers:(0,i.g)(),body:JSON.stringify({nome:a})});if(!t.ok)throw Error("Erro ao atualizar categoria");let n=await t.json(),s=r.map(r=>r.id===o?n:r);return e(s),n}catch(r){return console.error("Erro ao atualizar categoria:",r),null}},d=async o=>{try{if(!(await fetch("/api/categorias/".concat(o),{method:"DELETE",headers:(0,i.g)()})).ok)throw Error("Erro ao deletar categoria");let a=r.filter(r=>r.id!==o);return e(a),!0}catch(r){return console.error("Erro ao remover categoria:",r),!1}};return{categorias:r,isLoading:o,adicionarCategoria:l,atualizarCategoria:c,removerCategoria:d,obterCategoriaPorId:e=>r.find(r=>r.id===e)}},l=async r=>{if(!r)return"N\xe3o informado";let e=(await t()).find(e=>e.id===r);return e?e.nome:r}},18061:function(r,e,o){"use strict";o.d(e,{x:function(){return s}});var a=o(64090),i=o(32355);let t=async()=>{try{let r=await fetch("/api/unidades",{headers:(0,i.g)()});if(!r.ok)return n;let e=await r.json(),o=[...n];return e.forEach(r=>{o.find(e=>e.id===r.id)||o.push(r)}),o}catch(r){return console.error("Erro ao buscar unidades da API:",r),n}},n=[{id:"g",nome:"Gramas (g)"},{id:"kg",nome:"Quilogramas (kg)"},{id:"ml",nome:"Mililitros (ml)"},{id:"l",nome:"Litros (l)"},{id:"un",nome:"Unidade"},{id:"cx",nome:"Caixa"},{id:"pct",nome:"Pacote"}],s=()=>{let[r,e]=(0,a.useState)([]),[o,s]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{s(!0);let r=await t();console.log("Unidades loaded:",(null==r?void 0:r.length)||0),e(r)}catch(r){console.error("Erro ao carregar unidades de medida:",r),e([])}finally{s(!1)}})()},[]);let l=async(o,a)=>{try{if(n.find(r=>r.id===o))throw Error("J\xe1 existe uma unidade padr\xe3o com esta sigla");let t=await fetch("/api/unidades",{method:"POST",headers:(0,i.g)(),body:JSON.stringify({id:o,nome:a})});if(!t.ok)throw Error("Erro ao criar unidade");let s=await t.json(),l=[...r,s];return e(l),s}catch(r){return console.error("Erro ao adicionar unidade:",r),null}},c=async(o,a)=>{try{if(n.find(r=>r.id===o))throw Error("N\xe3o \xe9 poss\xedvel editar unidades padr\xe3o do sistema");let t=await fetch("/api/unidades/".concat(o),{method:"PUT",headers:(0,i.g)(),body:JSON.stringify({nome:a})});if(!t.ok)throw Error("Erro ao atualizar unidade");let s=await t.json(),l=r.map(r=>r.id===o?s:r);return e(l),s}catch(r){return console.error("Erro ao atualizar unidade:",r),null}},d=async o=>{try{if(n.find(r=>r.id===o))throw Error("N\xe3o \xe9 poss\xedvel deletar unidades padr\xe3o do sistema");if(!(await fetch("/api/unidades/".concat(o),{method:"DELETE",headers:(0,i.g)()})).ok)throw Error("Erro ao deletar unidade");let a=r.filter(r=>r.id!==o);return e(a),!0}catch(r){return console.error("Erro ao remover unidade:",r),!1}};return{unidades:r,isLoading:o,adicionarUnidade:l,atualizarUnidade:c,removerUnidade:d,obterUnidadePorId:e=>r.find(r=>r.id===e)}}}},function(r){r.O(0,[249,971,655,744],function(){return r(r.s=9173)}),_N_E=r.O()}]);
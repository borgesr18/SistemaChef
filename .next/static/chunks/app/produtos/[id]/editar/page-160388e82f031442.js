(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[163],{9173:function(r,a,e){Promise.resolve().then(e.bind(e,81184))},47907:function(r,a,e){"use strict";var o=e(15313);e.o(o,"useParams")&&e.d(a,{useParams:function(){return o.useParams}}),e.o(o,"usePathname")&&e.d(a,{usePathname:function(){return o.usePathname}}),e.o(o,"useRouter")&&e.d(a,{useRouter:function(){return o.useRouter}})},81184:function(r,a,e){"use strict";e.r(a),e.d(a,{default:function(){return f}});var o=e(3827),i=e(64090),t=e(47907),n=e(57418),s=e(32278),l=e(79173),c=e(66651),u=e(27742),d=e(18061),m=e(53018),g=e(93242);function f(){let r=(0,t.useParams)(),a=(0,t.useRouter)(),{obterProdutoPorId:e,atualizarProduto:f,isLoading:b}=(0,u.Ug)(),{categorias:p}=(0,m.D)(),{unidades:h}=(0,d.x)(),[N,v]=(0,i.useState)(!1),[x,y]=(0,i.useState)(!1),[E,j]=(0,i.useState)("");(0,i.useEffect)(()=>{if(!E)return;let r=setTimeout(()=>j(""),3e3);return()=>clearTimeout(r)},[E]);let w=r.id,[S,C]=(0,i.useState)({nome:"",categoria:"",marca:"",unidadeMedida:"",preco:"",fornecedor:"",pesoEmbalagem:"",infoNutricional:{calorias:"",carboidratos:"",proteinas:"",gordurasTotais:"",gordurasSaturadas:"",gordurasTrans:"",fibras:"",sodio:""}}),[T,k]=(0,i.useState)({});if((0,i.useEffect)(()=>{var r,o,i,t,n,s,l,c,u,d,m,g,f,p,h,N,v,x;if(b)return;let E=e(w);if(!E){a.push("/produtos");return}C({nome:E.nome,categoria:E.categoria||"",marca:E.marca||"",unidadeMedida:E.unidadeMedida,preco:(null===(r=E.preco)||void 0===r?void 0:r.toString())||"",fornecedor:E.fornecedor,pesoEmbalagem:(null===(o=E.pesoEmbalagem)||void 0===o?void 0:o.toString())||"",infoNutricional:{calorias:(null===(t=E.infoNutricional)||void 0===t?void 0:null===(i=t.calorias)||void 0===i?void 0:i.toString())||"",carboidratos:(null===(s=E.infoNutricional)||void 0===s?void 0:null===(n=s.carboidratos)||void 0===n?void 0:n.toString())||"",proteinas:(null===(c=E.infoNutricional)||void 0===c?void 0:null===(l=c.proteinas)||void 0===l?void 0:l.toString())||"",gordurasTotais:(null===(d=E.infoNutricional)||void 0===d?void 0:null===(u=d.gordurasTotais)||void 0===u?void 0:u.toString())||"",gordurasSaturadas:(null===(g=E.infoNutricional)||void 0===g?void 0:null===(m=g.gordurasSaturadas)||void 0===m?void 0:m.toString())||"",gordurasTrans:(null===(p=E.infoNutricional)||void 0===p?void 0:null===(f=p.gordurasTrans)||void 0===f?void 0:f.toString())||"",fibras:(null===(N=E.infoNutricional)||void 0===N?void 0:null===(h=N.fibras)||void 0===h?void 0:h.toString())||"",sodio:(null===(x=E.infoNutricional)||void 0===x?void 0:null===(v=x.sodio)||void 0===v?void 0:v.toString())||""}}),y(!!E.infoNutricional)},[b,w]),b)return(0,o.jsx)("p",{children:"Carregando..."});let P=r=>{let{name:a,value:e}=r.target;if(a.includes(".")){let[r,o]=a.split(".");C(a=>({...a,[r]:{...a[r],[o]:e}}))}else C(r=>({...r,[a]:e}))},D=()=>{let r={};if(S.nome||(r.nome="Nome \xe9 obrigat\xf3rio"),S.categoria||(r.categoria="Categoria \xe9 obrigat\xf3ria"),S.unidadeMedida||(r.unidadeMedida="Unidade de medida \xe9 obrigat\xf3ria"),S.preco?(isNaN(Number(S.preco))||0>=Number(S.preco))&&(r.preco="Pre\xe7o deve ser um n\xfamero positivo"):r.preco="Pre\xe7o \xe9 obrigat\xf3rio",S.fornecedor||(r.fornecedor="Fornecedor \xe9 obrigat\xf3rio"),(!S.pesoEmbalagem||isNaN(Number(S.pesoEmbalagem))||0>=Number(S.pesoEmbalagem))&&(r.pesoEmbalagem="Informe o peso por embalagem"),x){let a=S.infoNutricional;a.calorias&&isNaN(Number(a.calorias))&&(r["infoNutricional.calorias"]="Deve ser um n\xfamero"),a.carboidratos&&isNaN(Number(a.carboidratos))&&(r["infoNutricional.carboidratos"]="Deve ser um n\xfamero"),a.proteinas&&isNaN(Number(a.proteinas))&&(r["infoNutricional.proteinas"]="Deve ser um n\xfamero"),a.gordurasTotais&&isNaN(Number(a.gordurasTotais))&&(r["infoNutricional.gordurasTotais"]="Deve ser um n\xfamero"),a.gordurasSaturadas&&isNaN(Number(a.gordurasSaturadas))&&(r["infoNutricional.gordurasSaturadas"]="Deve ser um n\xfamero"),a.gordurasTrans&&isNaN(Number(a.gordurasTrans))&&(r["infoNutricional.gordurasTrans"]="Deve ser um n\xfamero"),a.fibras&&isNaN(Number(a.fibras))&&(r["infoNutricional.fibras"]="Deve ser um n\xfamero"),a.sodio&&isNaN(Number(a.sodio))&&(r["infoNutricional.sodio"]="Deve ser um n\xfamero")}return k(r),0===Object.keys(r).length};return(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsx)(g.Z,{message:E,onClose:()=>j("")}),(0,o.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Editar Insumo"}),(0,o.jsx)("form",{onSubmit:r=>{if(r.preventDefault(),D()){v(!0);try{let r={...S,preco:Number(S.preco),pesoEmbalagem:Number(S.pesoEmbalagem),infoNutricional:x?{calorias:Number(S.infoNutricional.calorias)||0,carboidratos:Number(S.infoNutricional.carboidratos)||0,proteinas:Number(S.infoNutricional.proteinas)||0,gordurasTotais:Number(S.infoNutricional.gordurasTotais)||0,gordurasSaturadas:Number(S.infoNutricional.gordurasSaturadas)||0,gordurasTrans:Number(S.infoNutricional.gordurasTrans)||0,fibras:Number(S.infoNutricional.fibras)||0,sodio:Number(S.infoNutricional.sodio)||0}:void 0};f(w,r),a.push("/produtos/".concat(w))}catch(r){console.error("Erro ao atualizar produto:",r),j("Erro ao atualizar produto")}finally{v(!1)}}},children:(0,o.jsxs)(n.Z,{children:[(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,o.jsx)(s.Z,{label:"Nome do Insumo *",name:"nome",value:S.nome,onChange:P,error:T.nome,placeholder:"Ex: Farinha de Trigo"}),(0,o.jsx)(l.Z,{label:"Categoria *",name:"categoria",value:S.categoria,onChange:P,options:p.map(r=>({value:r.id,label:r.nome})).sort((r,a)=>r.label.localeCompare(a.label)),error:T.categoria}),(0,o.jsx)(s.Z,{label:"Marca",name:"marca",value:S.marca,onChange:P,placeholder:"Ex: Dona Benta"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,o.jsx)(l.Z,{label:"Unidade de Medida *",name:"unidadeMedida",value:S.unidadeMedida,onChange:P,options:h.map(r=>({value:r.id,label:r.nome})).sort((r,a)=>r.label.localeCompare(a.label)),error:T.unidadeMedida}),(0,o.jsx)(s.Z,{label:"Pre\xe7o (R$) *",name:"preco",type:"number",step:"0.01",min:"0",value:S.preco,onChange:P,error:T.preco,placeholder:"Ex: 5.99"}),(0,o.jsx)(s.Z,{label:"Fornecedor *",name:"fornecedor",value:S.fornecedor,onChange:P,error:T.fornecedor,placeholder:"Ex: Distribuidora Alimentos"}),(0,o.jsx)(s.Z,{label:"Peso/Volume por Embalagem (g ou ml) *",name:"pesoEmbalagem",type:"number",min:"0",value:S.pesoEmbalagem,onChange:P,error:T.pesoEmbalagem,placeholder:"Ex: 1000"})]}),(0,o.jsxs)("div",{className:"border-t pt-4",children:[(0,o.jsxs)("div",{className:"flex items-center mb-4",children:[(0,o.jsx)("input",{type:"checkbox",id:"mostrarInfoNutricional",checked:x,onChange:()=>y(!x),className:"h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),(0,o.jsx)("label",{htmlFor:"mostrarInfoNutricional",className:"ml-2 text-sm font-medium text-gray-700",children:"Adicionar informa\xe7\xf5es nutricionais (por 100g/100ml)"})]}),x&&(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,o.jsx)(s.Z,{label:"Calorias (kcal)",name:"infoNutricional.calorias",type:"number",min:"0",value:S.infoNutricional.calorias,onChange:P,error:T["infoNutricional.calorias"]}),(0,o.jsx)(s.Z,{label:"Carboidratos (g)",name:"infoNutricional.carboidratos",type:"number",min:"0",step:"0.1",value:S.infoNutricional.carboidratos,onChange:P,error:T["infoNutricional.carboidratos"]}),(0,o.jsx)(s.Z,{label:"Prote\xednas (g)",name:"infoNutricional.proteinas",type:"number",min:"0",step:"0.1",value:S.infoNutricional.proteinas,onChange:P,error:T["infoNutricional.proteinas"]}),(0,o.jsx)(s.Z,{label:"Gorduras Totais (g)",name:"infoNutricional.gordurasTotais",type:"number",min:"0",step:"0.1",value:S.infoNutricional.gordurasTotais,onChange:P,error:T["infoNutricional.gordurasTotais"]}),(0,o.jsx)(s.Z,{label:"Gorduras Saturadas (g)",name:"infoNutricional.gordurasSaturadas",type:"number",min:"0",step:"0.1",value:S.infoNutricional.gordurasSaturadas,onChange:P,error:T["infoNutricional.gordurasSaturadas"]}),(0,o.jsx)(s.Z,{label:"Gorduras Trans (g)",name:"infoNutricional.gordurasTrans",type:"number",min:"0",step:"0.1",value:S.infoNutricional.gordurasTrans,onChange:P,error:T["infoNutricional.gordurasTrans"]}),(0,o.jsx)(s.Z,{label:"Fibras (g)",name:"infoNutricional.fibras",type:"number",min:"0",step:"0.1",value:S.infoNutricional.fibras,onChange:P,error:T["infoNutricional.fibras"]}),(0,o.jsx)(s.Z,{label:"S\xf3dio (mg)",name:"infoNutricional.sodio",type:"number",min:"0",step:"0.1",value:S.infoNutricional.sodio,onChange:P,error:T["infoNutricional.sodio"]})]})]})]}),(0,o.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,o.jsx)(c.Z,{type:"button",variant:"outline",onClick:()=>a.push("/produtos/".concat(w)),children:"Cancelar"}),(0,o.jsx)(c.Z,{type:"submit",variant:"primary",isLoading:N,children:"Atualizar Insumo"})]})]})})]})}},66651:function(r,a,e){"use strict";var o=e(3827);e(64090),a.Z=r=>{let{children:a,variant:e="primary",size:i="md",isLoading:t=!1,fullWidth:n=!1,className:s="",disabled:l,...c}=r,u=l||t?"opacity-50 cursor-not-allowed":"";return(0,o.jsxs)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-[var(--cor-acao)] text-white hover:brightness-90 focus:ring-[var(--cor-acao)]",secondary:"bg-[var(--cor-secundaria)] text-white hover:brightness-90 focus:ring-[var(--cor-secundaria)]",success:"bg-[var(--cor-sucesso)] text-white hover:brightness-90 focus:ring-[var(--cor-sucesso)]",danger:"bg-[var(--cor-erro)] text-white hover:brightness-90 focus:ring-[var(--cor-erro)]",outline:"bg-white text-[var(--cor-texto-principal)] border border-[var(--cor-borda)] hover:bg-gray-50 focus:ring-[var(--cor-acao)]"}[e]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[i]," ").concat(n?"w-full":""," ").concat(u," ").concat(s),disabled:l||t,...c,children:[t&&(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a]})}},32278:function(r,a,e){"use strict";var o=e(3827);let i=(0,e(64090).forwardRef)((r,a)=>{let{label:e,error:i,helperText:t,className:n="",...s}=r;return(0,o.jsxs)("div",{className:"mb-4",children:[e&&(0,o.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--cor-texto-principal)"},children:e}),(0,o.jsx)("input",{ref:a,className:"w-full input ".concat(i?"border-[var(--cor-erro)]":""," ").concat(n),...s}),i&&(0,o.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-erro)"},children:i}),t&&!i&&(0,o.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-texto-secundario)"},children:t})]})});i.displayName="Input",a.Z=i},79173:function(r,a,e){"use strict";var o=e(3827);let i=(0,e(64090).forwardRef)((r,a)=>{let{label:e,error:i,helperText:t,options:n,className:s="",...l}=r;return(0,o.jsxs)("div",{className:"mb-4",children:[e&&(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e}),(0,o.jsxs)("select",{ref:a,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 \n            ".concat(i?"border-red-500":"border-gray-300"," \n            ").concat(s),...l,children:[(0,o.jsx)("option",{value:"",children:"Selecione..."}),n.map(r=>(0,o.jsx)("option",{value:r.value,children:r.label},r.value))]}),i&&(0,o.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i}),t&&!i&&(0,o.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:t})]})});i.displayName="Select",a.Z=i},93242:function(r,a,e){"use strict";var o=e(3827),i=e(64090);a.Z=r=>{let{message:a,onClose:e}=r;return((0,i.useEffect)(()=>{if(!a)return;let r=setTimeout(e,3e3);return()=>clearTimeout(r)},[a,e]),a)?(0,o.jsx)("div",{className:"fixed top-4 right-4 bg-[var(--cor-sucesso)] text-white px-4 py-2 rounded shadow",children:a}):null}},53018:function(r,a,e){"use strict";e.d(a,{D:function(){return s},u:function(){return l}});var o=e(64090),i=e(32355);let t=async()=>{try{console.log("\uD83D\uDD0D Buscando categorias de produtos...");let r=await fetch("/api/categorias",{headers:(0,i.g)()});if(console.log("\uD83D\uDCE1 Response status: ".concat(r.status)),!r.ok){let a=await r.text();throw console.error("❌ Erro na API categorias: ".concat(r.status," - ").concat(a)),Error("Erro ao buscar categorias: ".concat(r.status))}let a=await r.json();return console.log("✅ Categorias carregadas: ".concat(a.length)),a}catch(r){return console.error("❌ Erro ao buscar categorias da API:",r),[]}},n=[{id:"hortifruti",nome:"Hortifruti"},{id:"carnes",nome:"Carnes"},{id:"laticinios",nome:"Latic\xednios"},{id:"graos",nome:"Gr\xe3os e Cereais"},{id:"bebidas",nome:"Bebidas"},{id:"temperos",nome:"Temperos"},{id:"outros",nome:"Outros"}],s=()=>{let[r,a]=(0,o.useState)([]),[e,s]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{try{s(!0);let r=await t();if(0===r.length){for(let a of n)try{if(!r.find(r=>r.nome===a.nome)){let e=await fetch("/api/categorias",{method:"POST",headers:(0,i.g)(),body:JSON.stringify({nome:a.nome})});if(e.ok){let a=await e.json();r.push(a)}else 409===e.status&&console.log("Categoria '".concat(a.nome,"' j\xe1 existe, pulando..."))}}catch(r){console.error("Erro ao criar categoria padr\xe3o:",r)}r=await t()}console.log("Categorias loaded:",(null==r?void 0:r.length)||0),a(r)}catch(r){console.error("Erro ao carregar categorias:",r),a([])}finally{s(!1)}})()},[]);let l=async e=>{try{let o=await fetch("/api/categorias",{method:"POST",headers:(0,i.g)(),body:JSON.stringify({nome:e})});if(!o.ok)throw Error("Erro ao criar categoria");let t=await o.json(),n=[...r,t];return a(n),t}catch(r){return console.error("Erro ao adicionar categoria:",r),null}},c=async(e,o)=>{try{let t=await fetch("/api/categorias/".concat(e),{method:"PUT",headers:(0,i.g)(),body:JSON.stringify({nome:o})});if(!t.ok)throw Error("Erro ao atualizar categoria");let n=await t.json(),s=r.map(r=>r.id===e?n:r);return a(s),n}catch(r){return console.error("Erro ao atualizar categoria:",r),null}},u=async e=>{try{if(!(await fetch("/api/categorias/".concat(e),{method:"DELETE",headers:(0,i.g)()})).ok)throw Error("Erro ao deletar categoria");let o=r.filter(r=>r.id!==e);return a(o),!0}catch(r){return console.error("Erro ao remover categoria:",r),!1}};return{categorias:r,isLoading:e,adicionarCategoria:l,atualizarCategoria:c,removerCategoria:u,obterCategoriaPorId:a=>r.find(r=>r.id===a)}},l=async r=>{if(!r)return"N\xe3o informado";let a=(await t()).find(a=>a.id===r);return a?a.nome:r}},18061:function(r,a,e){"use strict";e.d(a,{x:function(){return s}});var o=e(64090),i=e(32355);let t=async()=>{try{let r=await fetch("/api/unidades",{headers:(0,i.g)()});if(!r.ok)return n;let a=await r.json(),e=[...n];return a.forEach(r=>{e.find(a=>a.id===r.id)||e.push(r)}),e}catch(r){return console.error("Erro ao buscar unidades da API:",r),n}},n=[{id:"g",nome:"Gramas (g)"},{id:"kg",nome:"Quilogramas (kg)"},{id:"ml",nome:"Mililitros (ml)"},{id:"l",nome:"Litros (l)"},{id:"un",nome:"Unidade"},{id:"cx",nome:"Caixa"},{id:"pct",nome:"Pacote"}],s=()=>{let[r,a]=(0,o.useState)([]),[e,s]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{try{s(!0);let r=await t();console.log("Unidades loaded:",(null==r?void 0:r.length)||0),a(r)}catch(r){console.error("Erro ao carregar unidades de medida:",r),a([])}finally{s(!1)}})()},[]);let l=async(e,o)=>{try{if(n.find(r=>r.id===e))throw Error("J\xe1 existe uma unidade padr\xe3o com esta sigla");let t=await fetch("/api/unidades",{method:"POST",headers:(0,i.g)(),body:JSON.stringify({id:e,nome:o})});if(!t.ok)throw Error("Erro ao criar unidade");let s=await t.json(),l=[...r,s];return a(l),s}catch(r){return console.error("Erro ao adicionar unidade:",r),null}},c=async(e,o)=>{try{if(n.find(r=>r.id===e))throw Error("N\xe3o \xe9 poss\xedvel editar unidades padr\xe3o do sistema");let t=await fetch("/api/unidades/".concat(e),{method:"PUT",headers:(0,i.g)(),body:JSON.stringify({nome:o})});if(!t.ok)throw Error("Erro ao atualizar unidade");let s=await t.json(),l=r.map(r=>r.id===e?s:r);return a(l),s}catch(r){return console.error("Erro ao atualizar unidade:",r),null}},u=async e=>{try{if(n.find(r=>r.id===e))throw Error("N\xe3o \xe9 poss\xedvel deletar unidades padr\xe3o do sistema");if(!(await fetch("/api/unidades/".concat(e),{method:"DELETE",headers:(0,i.g)()})).ok)throw Error("Erro ao deletar unidade");let o=r.filter(r=>r.id!==e);return a(o),!0}catch(r){return console.error("Erro ao remover unidade:",r),!1}};return{unidades:r,isLoading:e,adicionarUnidade:l,atualizarUnidade:c,removerUnidade:u,obterUnidadePorId:a=>r.find(r=>r.id===a)}}}},function(r){r.O(0,[249,971,69,744],function(){return r(r.s=9173)}),_N_E=r.O()}]);
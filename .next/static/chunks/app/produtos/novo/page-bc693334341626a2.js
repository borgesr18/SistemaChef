(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[390],{70530:function(r,e,a){Promise.resolve().then(a.bind(a,70049))},47907:function(r,e,a){"use strict";var o=a(15313);a.o(o,"redirect")&&a.d(e,{redirect:function(){return o.redirect}}),a.o(o,"useParams")&&a.d(e,{useParams:function(){return o.useParams}}),a.o(o,"useRouter")&&a.d(e,{useRouter:function(){return o.useRouter}})},70049:function(r,e,a){"use strict";a.r(e),a.d(e,{default:function(){return f}});var o=a(3827),i=a(64090),t=a(47907),n=a(57418),s=a(32278),c=a(79173),l=a(66651),u=a(27742),d=a(18061),m=a(53018),g=a(93242);function f(){let r=(0,t.useRouter)(),{adicionarProduto:e}=(0,u.Ug)(),{categorias:a}=(0,m.D)(),{unidades:f}=(0,d.x)(),[b,p]=(0,i.useState)(!1),[h,N]=(0,i.useState)(!1),[x,v]=(0,i.useState)("");(0,i.useEffect)(()=>{if(!x)return;let r=setTimeout(()=>v(""),3e3);return()=>clearTimeout(r)},[x]);let[y,E]=(0,i.useState)({nome:"",categoria:"",marca:"",unidadeMedida:"",preco:"",fornecedor:"",pesoEmbalagem:"",infoNutricional:{calorias:"",carboidratos:"",proteinas:"",gordurasTotais:"",gordurasSaturadas:"",gordurasTrans:"",fibras:"",sodio:""}}),[j,w]=(0,i.useState)({}),C=r=>{let{name:e,value:a}=r.target;if(e.includes(".")){let[r,o]=e.split(".");E(e=>({...e,[r]:{...e[r],[o]:a}}))}else E(r=>({...r,[e]:a}))},T=()=>{let r={};if(y.nome||(r.nome="Nome \xe9 obrigat\xf3rio"),y.categoria||(r.categoria="Categoria \xe9 obrigat\xf3ria"),y.unidadeMedida||(r.unidadeMedida="Unidade de medida \xe9 obrigat\xf3ria"),y.preco?(isNaN(Number(y.preco))||0>=Number(y.preco))&&(r.preco="Pre\xe7o deve ser um n\xfamero positivo"):r.preco="Pre\xe7o \xe9 obrigat\xf3rio",y.fornecedor||(r.fornecedor="Fornecedor \xe9 obrigat\xf3rio"),(!y.pesoEmbalagem||isNaN(Number(y.pesoEmbalagem))||0>=Number(y.pesoEmbalagem))&&(r.pesoEmbalagem="Informe o peso por embalagem"),h){let e=y.infoNutricional;e.calorias&&isNaN(Number(e.calorias))&&(r["infoNutricional.calorias"]="Deve ser um n\xfamero"),e.carboidratos&&isNaN(Number(e.carboidratos))&&(r["infoNutricional.carboidratos"]="Deve ser um n\xfamero"),e.proteinas&&isNaN(Number(e.proteinas))&&(r["infoNutricional.proteinas"]="Deve ser um n\xfamero"),e.gordurasTotais&&isNaN(Number(e.gordurasTotais))&&(r["infoNutricional.gordurasTotais"]="Deve ser um n\xfamero"),e.gordurasSaturadas&&isNaN(Number(e.gordurasSaturadas))&&(r["infoNutricional.gordurasSaturadas"]="Deve ser um n\xfamero"),e.gordurasTrans&&isNaN(Number(e.gordurasTrans))&&(r["infoNutricional.gordurasTrans"]="Deve ser um n\xfamero"),e.fibras&&isNaN(Number(e.fibras))&&(r["infoNutricional.fibras"]="Deve ser um n\xfamero"),e.sodio&&isNaN(Number(e.sodio))&&(r["infoNutricional.sodio"]="Deve ser um n\xfamero")}return w(r),0===Object.keys(r).length};return(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsx)(g.Z,{message:x,onClose:()=>v("")}),(0,o.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Novo Insumo"}),(0,o.jsx)("form",{onSubmit:a=>{if(a.preventDefault(),T()){p(!0);try{let a={...y,preco:Number(y.preco),pesoEmbalagem:Number(y.pesoEmbalagem),infoNutricional:h?{calorias:Number(y.infoNutricional.calorias)||0,carboidratos:Number(y.infoNutricional.carboidratos)||0,proteinas:Number(y.infoNutricional.proteinas)||0,gordurasTotais:Number(y.infoNutricional.gordurasTotais)||0,gordurasSaturadas:Number(y.infoNutricional.gordurasSaturadas)||0,gordurasTrans:Number(y.infoNutricional.gordurasTrans)||0,fibras:Number(y.infoNutricional.fibras)||0,sodio:Number(y.infoNutricional.sodio)||0}:void 0};e(a),r.push("/produtos")}catch(r){console.error("Erro ao salvar produto:",r),v("Erro ao salvar produto")}finally{p(!1)}}},children:(0,o.jsxs)(n.Z,{children:[(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,o.jsx)(s.Z,{label:"Nome do Insumo *",name:"nome",value:y.nome,onChange:C,error:j.nome,placeholder:"Ex: Farinha de Trigo"}),(0,o.jsx)(c.Z,{label:"Categoria *",name:"categoria",value:y.categoria,onChange:C,options:a.map(r=>({value:r.id,label:r.nome})).sort((r,e)=>r.label.localeCompare(e.label)),error:j.categoria}),(0,o.jsx)(s.Z,{label:"Marca",name:"marca",value:y.marca,onChange:C,placeholder:"Ex: Dona Benta"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,o.jsx)(c.Z,{label:"Unidade de Medida *",name:"unidadeMedida",value:y.unidadeMedida,onChange:C,options:f.map(r=>({value:r.id,label:r.nome})).sort((r,e)=>r.label.localeCompare(e.label)),error:j.unidadeMedida}),(0,o.jsx)(s.Z,{label:"Pre\xe7o (R$) *",name:"preco",type:"number",step:"0.01",min:"0",value:y.preco,onChange:C,error:j.preco,placeholder:"Ex: 5.99"}),(0,o.jsx)(s.Z,{label:"Fornecedor *",name:"fornecedor",value:y.fornecedor,onChange:C,error:j.fornecedor,placeholder:"Ex: Distribuidora Alimentos"}),(0,o.jsx)(s.Z,{label:"Peso/Volume por Embalagem (g ou ml) *",name:"pesoEmbalagem",type:"number",min:"0",value:y.pesoEmbalagem,onChange:C,error:j.pesoEmbalagem,placeholder:"Ex: 1000"})]}),(0,o.jsxs)("div",{className:"border-t pt-4",children:[(0,o.jsxs)("div",{className:"flex items-center mb-4",children:[(0,o.jsx)("input",{type:"checkbox",id:"mostrarInfoNutricional",checked:h,onChange:()=>N(!h),className:"h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),(0,o.jsx)("label",{htmlFor:"mostrarInfoNutricional",className:"ml-2 text-sm font-medium text-gray-700",children:"Adicionar informa\xe7\xf5es nutricionais (por 100g/100ml)"})]}),h&&(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,o.jsx)(s.Z,{label:"Calorias (kcal)",name:"infoNutricional.calorias",type:"number",min:"0",value:y.infoNutricional.calorias,onChange:C,error:j["infoNutricional.calorias"]}),(0,o.jsx)(s.Z,{label:"Carboidratos (g)",name:"infoNutricional.carboidratos",type:"number",min:"0",step:"0.1",value:y.infoNutricional.carboidratos,onChange:C,error:j["infoNutricional.carboidratos"]}),(0,o.jsx)(s.Z,{label:"Prote\xednas (g)",name:"infoNutricional.proteinas",type:"number",min:"0",step:"0.1",value:y.infoNutricional.proteinas,onChange:C,error:j["infoNutricional.proteinas"]}),(0,o.jsx)(s.Z,{label:"Gorduras Totais (g)",name:"infoNutricional.gordurasTotais",type:"number",min:"0",step:"0.1",value:y.infoNutricional.gordurasTotais,onChange:C,error:j["infoNutricional.gordurasTotais"]}),(0,o.jsx)(s.Z,{label:"Gorduras Saturadas (g)",name:"infoNutricional.gordurasSaturadas",type:"number",min:"0",step:"0.1",value:y.infoNutricional.gordurasSaturadas,onChange:C,error:j["infoNutricional.gordurasSaturadas"]}),(0,o.jsx)(s.Z,{label:"Gorduras Trans (g)",name:"infoNutricional.gordurasTrans",type:"number",min:"0",step:"0.1",value:y.infoNutricional.gordurasTrans,onChange:C,error:j["infoNutricional.gordurasTrans"]}),(0,o.jsx)(s.Z,{label:"Fibras (g)",name:"infoNutricional.fibras",type:"number",min:"0",step:"0.1",value:y.infoNutricional.fibras,onChange:C,error:j["infoNutricional.fibras"]}),(0,o.jsx)(s.Z,{label:"S\xf3dio (mg)",name:"infoNutricional.sodio",type:"number",min:"0",step:"0.1",value:y.infoNutricional.sodio,onChange:C,error:j["infoNutricional.sodio"]})]})]})]}),(0,o.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,o.jsx)(l.Z,{type:"button",variant:"outline",onClick:()=>r.push("/produtos"),children:"Cancelar"}),(0,o.jsx)(l.Z,{type:"submit",variant:"primary",isLoading:b,children:"Salvar Insumo"})]})]})})]})}},66651:function(r,e,a){"use strict";var o=a(3827);a(64090),e.Z=r=>{let{children:e,variant:a="primary",size:i="md",isLoading:t=!1,fullWidth:n=!1,className:s="",disabled:c,...l}=r,u=c||t?"opacity-50 cursor-not-allowed":"";return(0,o.jsxs)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-[var(--cor-acao)] text-white hover:brightness-90 focus:ring-[var(--cor-acao)]",secondary:"bg-[var(--cor-secundaria)] text-white hover:brightness-90 focus:ring-[var(--cor-secundaria)]",success:"bg-[var(--cor-sucesso)] text-white hover:brightness-90 focus:ring-[var(--cor-sucesso)]",danger:"bg-[var(--cor-erro)] text-white hover:brightness-90 focus:ring-[var(--cor-erro)]",outline:"bg-white text-[var(--cor-texto-principal)] border border-[var(--cor-borda)] hover:bg-gray-50 focus:ring-[var(--cor-acao)]"}[a]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[i]," ").concat(n?"w-full":""," ").concat(u," ").concat(s),disabled:c||t,...l,children:[t&&(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e]})}},32278:function(r,e,a){"use strict";var o=a(3827);let i=(0,a(64090).forwardRef)((r,e)=>{let{label:a,error:i,helperText:t,className:n="",...s}=r;return(0,o.jsxs)("div",{className:"mb-4",children:[a&&(0,o.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--cor-texto-principal)"},children:a}),(0,o.jsx)("input",{ref:e,className:"w-full input ".concat(i?"border-[var(--cor-erro)]":""," ").concat(n),...s}),i&&(0,o.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-erro)"},children:i}),t&&!i&&(0,o.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-texto-secundario)"},children:t})]})});i.displayName="Input",e.Z=i},79173:function(r,e,a){"use strict";var o=a(3827);let i=(0,a(64090).forwardRef)((r,e)=>{let{label:a,error:i,helperText:t,options:n,className:s="",...c}=r;return(0,o.jsxs)("div",{className:"mb-4",children:[a&&(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,o.jsxs)("select",{ref:e,className:"w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 \n            ".concat(i?"border-red-500":"border-gray-300"," \n            ").concat(s),...c,children:[(0,o.jsx)("option",{value:"",children:"Selecione..."}),n.map(r=>(0,o.jsx)("option",{value:r.value,children:r.label},r.value))]}),i&&(0,o.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i}),t&&!i&&(0,o.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:t})]})});i.displayName="Select",e.Z=i},93242:function(r,e,a){"use strict";var o=a(3827),i=a(64090);e.Z=r=>{let{message:e,onClose:a}=r;return((0,i.useEffect)(()=>{if(!e)return;let r=setTimeout(a,3e3);return()=>clearTimeout(r)},[e,a]),e)?(0,o.jsx)("div",{className:"fixed top-4 right-4 bg-[var(--cor-sucesso)] text-white px-4 py-2 rounded shadow",children:e}):null}},53018:function(r,e,a){"use strict";a.d(e,{D:function(){return s},u:function(){return c}});var o=a(64090),i=a(32355);let t=async()=>{try{console.log("\uD83D\uDD0D Buscando categorias de produtos...");let r=await fetch("/api/categorias",{headers:(0,i.g)()});if(console.log("\uD83D\uDCE1 Response status: ".concat(r.status)),!r.ok){let e=await r.text();throw console.error("❌ Erro na API categorias: ".concat(r.status," - ").concat(e)),Error("Erro ao buscar categorias: ".concat(r.status))}let e=await r.json();return console.log("✅ Categorias carregadas: ".concat(e.length)),e}catch(r){return console.error("❌ Erro ao buscar categorias da API:",r),[]}},n=[{id:"hortifruti",nome:"Hortifruti"},{id:"carnes",nome:"Carnes"},{id:"laticinios",nome:"Latic\xednios"},{id:"graos",nome:"Gr\xe3os e Cereais"},{id:"bebidas",nome:"Bebidas"},{id:"temperos",nome:"Temperos"},{id:"outros",nome:"Outros"}],s=()=>{let[r,e]=(0,o.useState)([]),[a,s]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{try{s(!0);let r=await t();if(0===r.length){for(let e of n)try{if(!r.find(r=>r.nome===e.nome)){let a=await fetch("/api/categorias",{method:"POST",headers:(0,i.g)(),body:JSON.stringify({nome:e.nome})});if(a.ok){let e=await a.json();r.push(e)}else 409===a.status&&console.log("Categoria '".concat(e.nome,"' j\xe1 existe, pulando..."))}}catch(r){console.error("Erro ao criar categoria padr\xe3o:",r)}r=await t()}console.log("Categorias loaded:",(null==r?void 0:r.length)||0),e(r)}catch(r){console.error("Erro ao carregar categorias:",r),e([])}finally{s(!1)}})()},[]);let c=async a=>{try{let o=await fetch("/api/categorias",{method:"POST",headers:(0,i.g)(),body:JSON.stringify({nome:a})});if(!o.ok)throw Error("Erro ao criar categoria");let t=await o.json(),n=[...r,t];return e(n),t}catch(r){return console.error("Erro ao adicionar categoria:",r),null}},l=async(a,o)=>{try{let t=await fetch("/api/categorias/".concat(a),{method:"PUT",headers:(0,i.g)(),body:JSON.stringify({nome:o})});if(!t.ok)throw Error("Erro ao atualizar categoria");let n=await t.json(),s=r.map(r=>r.id===a?n:r);return e(s),n}catch(r){return console.error("Erro ao atualizar categoria:",r),null}},u=async a=>{try{if(!(await fetch("/api/categorias/".concat(a),{method:"DELETE",headers:(0,i.g)()})).ok)throw Error("Erro ao deletar categoria");let o=r.filter(r=>r.id!==a);return e(o),!0}catch(r){return console.error("Erro ao remover categoria:",r),!1}};return{categorias:r,isLoading:a,adicionarCategoria:c,atualizarCategoria:l,removerCategoria:u,obterCategoriaPorId:e=>r.find(r=>r.id===e)}},c=async r=>{if(!r)return"N\xe3o informado";let e=(await t()).find(e=>e.id===r);return e?e.nome:r}},18061:function(r,e,a){"use strict";a.d(e,{x:function(){return s}});var o=a(64090),i=a(32355);let t=async()=>{try{let r=await fetch("/api/unidades",{headers:(0,i.g)()});if(!r.ok)return n;let e=await r.json(),a=[...n];return e.forEach(r=>{a.find(e=>e.id===r.id)||a.push(r)}),a}catch(r){return console.error("Erro ao buscar unidades da API:",r),n}},n=[{id:"g",nome:"Gramas (g)"},{id:"kg",nome:"Quilogramas (kg)"},{id:"ml",nome:"Mililitros (ml)"},{id:"l",nome:"Litros (l)"},{id:"un",nome:"Unidade"},{id:"cx",nome:"Caixa"},{id:"pct",nome:"Pacote"}],s=()=>{let[r,e]=(0,o.useState)([]),[a,s]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{try{s(!0);let r=await t();console.log("Unidades loaded:",(null==r?void 0:r.length)||0),e(r)}catch(r){console.error("Erro ao carregar unidades de medida:",r),e([])}finally{s(!1)}})()},[]);let c=async(a,o)=>{try{if(n.find(r=>r.id===a))throw Error("J\xe1 existe uma unidade padr\xe3o com esta sigla");let t=await fetch("/api/unidades",{method:"POST",headers:(0,i.g)(),body:JSON.stringify({id:a,nome:o})});if(!t.ok)throw Error("Erro ao criar unidade");let s=await t.json(),c=[...r,s];return e(c),s}catch(r){return console.error("Erro ao adicionar unidade:",r),null}},l=async(a,o)=>{try{if(n.find(r=>r.id===a))throw Error("N\xe3o \xe9 poss\xedvel editar unidades padr\xe3o do sistema");let t=await fetch("/api/unidades/".concat(a),{method:"PUT",headers:(0,i.g)(),body:JSON.stringify({nome:o})});if(!t.ok)throw Error("Erro ao atualizar unidade");let s=await t.json(),c=r.map(r=>r.id===a?s:r);return e(c),s}catch(r){return console.error("Erro ao atualizar unidade:",r),null}},u=async a=>{try{if(n.find(r=>r.id===a))throw Error("N\xe3o \xe9 poss\xedvel deletar unidades padr\xe3o do sistema");if(!(await fetch("/api/unidades/".concat(a),{method:"DELETE",headers:(0,i.g)()})).ok)throw Error("Erro ao deletar unidade");let o=r.filter(r=>r.id!==a);return e(o),!0}catch(r){return console.error("Erro ao remover unidade:",r),!1}};return{unidades:r,isLoading:a,adicionarUnidade:c,atualizarUnidade:l,removerUnidade:u,obterUnidadePorId:e=>r.find(r=>r.id===e)}}}},function(r){r.O(0,[249,971,655,744],function(){return r(r.s=70530)}),_N_E=r.O()}]);
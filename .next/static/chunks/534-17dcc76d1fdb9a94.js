"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[534],{41534:function(e,r,a){a.r(r);var t=a(3827),s=a(64090),o=a(20200),n=a(66651),l=a(70492),i=a(32278),c=a(14570);r.default=s.memo(function(){let{usuarios:e,isLoading:r,registrarUsuario:a,removerUsuario:d,alterarSenha:u,editarUsuario:m}=(0,c.G)(),{isOpen:h,openModal:x,closeModal:p}=(0,l.d)(),{isOpen:f,openModal:v,closeModal:g}=(0,l.d)(),{isOpen:y,openModal:j,closeModal:b}=(0,l.d)(),[w,N]=(0,s.useState)({nome:"",email:"",senha:"",confirmarSenha:"",role:"viewer"}),[C,S]=(0,s.useState)({id:"",nome:"",email:"",role:"viewer"}),[k,E]=(0,s.useState)({id:"",senha:"",confirmarSenha:""}),[D,Z]=(0,s.useState)(""),[z,A]=(0,s.useState)(""),[O,I]=(0,s.useState)(""),P=async e=>{if(e.preventDefault(),w.senha!==w.confirmarSenha){Z("Senhas n\xe3o conferem");return}if(!await a({nome:w.nome,email:w.email,senha:w.senha,role:w.role})){Z("Email j\xe1 cadastrado ou senha fraca");return}N({nome:"",email:"",senha:"",confirmarSenha:"",role:"viewer"}),Z(""),p()},_=e=>{S(e),Z(""),j()},M=e=>{E({id:e,senha:"",confirmarSenha:""}),A(""),v()},U=e.filter(e=>e.nome.toLowerCase().includes(O.toLowerCase())||e.email.toLowerCase().includes(O.toLowerCase()));return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Controle de Usu\xe1rios"}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(n.Z,{onClick:x,variant:"primary",children:"➕ Novo Usu\xe1rio"}),(0,t.jsx)("div",{className:"w-full sm:w-[220px]",children:(0,t.jsx)(i.Z,{label:"",placeholder:"Buscar...",value:O,onChange:e=>I(e.target.value),className:"h-[38px]"})})]}),(0,t.jsx)(o.ZP,{headers:["Nome","Email","Perfil","A\xe7\xf5es"],children:U.map(e=>(0,t.jsxs)(o.SC,{children:[(0,t.jsx)(o.pj,{children:e.nome}),(0,t.jsx)(o.pj,{children:e.email}),(0,t.jsx)(o.pj,{children:{admin:"Administrador",editor:"Editor",manager:"Gerente",viewer:"Visualizador"}[e.role]}),(0,t.jsxs)(o.pj,{className:"flex items-center space-x-2",children:[(0,t.jsx)(n.Z,{size:"sm",variant:"secondary",onClick:()=>_(e),children:"✏️ Editar"}),(0,t.jsx)(n.Z,{size:"sm",variant:"secondary",onClick:()=>M(e.id),children:"\uD83D\uDD12 Senha"}),(0,t.jsx)(n.Z,{size:"sm",variant:"danger",onClick:()=>d(e.id),children:"\uD83D\uDDD1️ Excluir"})]})]},e.id))}),(0,t.jsx)(l.Z,{isOpen:h,onClose:p,title:"Novo Usu\xe1rio",children:(0,t.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[D&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:D}),(0,t.jsx)(i.Z,{label:"Nome",value:w.nome,onChange:e=>N({...w,nome:e.target.value}),required:!0,className:"h-[38px]"}),(0,t.jsx)(i.Z,{label:"Email",type:"email",value:w.email,onChange:e=>N({...w,email:e.target.value}),required:!0,className:"h-[38px]"}),(0,t.jsx)(i.Z,{label:"Senha",type:"password",value:w.senha,onChange:e=>N({...w,senha:e.target.value}),required:!0,className:"h-[38px]"}),(0,t.jsx)(i.Z,{label:"Confirmar Senha",type:"password",value:w.confirmarSenha,onChange:e=>N({...w,confirmarSenha:e.target.value}),required:!0,className:"h-[38px]"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Perfil"}),(0,t.jsxs)("select",{className:"border border-[var(--cor-borda)] rounded-md p-2 w-full h-[38px]",value:w.role,onChange:e=>N({...w,role:e.target.value}),children:[(0,t.jsx)("option",{value:"viewer",children:"Visualizador"}),(0,t.jsx)("option",{value:"editor",children:"Editor"}),(0,t.jsx)("option",{value:"manager",children:"Gerente"}),(0,t.jsx)("option",{value:"admin",children:"Administrador"})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(n.Z,{type:"button",variant:"secondary",onClick:p,children:"Cancelar"}),(0,t.jsx)(n.Z,{type:"submit",variant:"primary",children:"Salvar"})]})]})}),(0,t.jsx)(l.Z,{isOpen:f,onClose:g,title:"Alterar Senha",children:(0,t.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),k.senha!==k.confirmarSenha){A("Senhas n\xe3o conferem");return}u(k.id,k.senha),g()},className:"space-y-4",children:[z&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:z}),(0,t.jsx)(i.Z,{label:"Nova Senha",type:"password",value:k.senha,onChange:e=>E({...k,senha:e.target.value}),required:!0,className:"h-[38px]"}),(0,t.jsx)(i.Z,{label:"Confirmar Senha",type:"password",value:k.confirmarSenha,onChange:e=>E({...k,confirmarSenha:e.target.value}),required:!0,className:"h-[38px]"}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(n.Z,{type:"button",variant:"secondary",onClick:g,children:"Cancelar"}),(0,t.jsx)(n.Z,{type:"submit",variant:"primary",children:"Salvar"})]})]})}),(0,t.jsx)(l.Z,{isOpen:y,onClose:b,title:"Editar Usu\xe1rio",children:(0,t.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!m(C.id,C)){Z("Email j\xe1 cadastrado");return}b()},className:"space-y-4",children:[D&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:D}),(0,t.jsx)(i.Z,{label:"Nome",value:C.nome,onChange:e=>S({...C,nome:e.target.value}),required:!0,className:"h-[38px]"}),(0,t.jsx)(i.Z,{label:"Email",type:"email",value:C.email,onChange:e=>S({...C,email:e.target.value}),required:!0,className:"h-[38px]"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Perfil"}),(0,t.jsxs)("select",{className:"border border-[var(--cor-borda)] rounded-md p-2 w-full h-[38px]",value:C.role,onChange:e=>S({...C,role:e.target.value}),children:[(0,t.jsx)("option",{value:"viewer",children:"Visualizador"}),(0,t.jsx)("option",{value:"editor",children:"Editor"}),(0,t.jsx)("option",{value:"manager",children:"Gerente"}),(0,t.jsx)("option",{value:"admin",children:"Administrador"})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(n.Z,{type:"button",variant:"secondary",onClick:b,children:"Cancelar"}),(0,t.jsx)(n.Z,{type:"submit",variant:"primary",children:"Salvar"})]})]})})]})})},66651:function(e,r,a){var t=a(3827);a(64090),r.Z=e=>{let{children:r,variant:a="primary",size:s="md",isLoading:o=!1,fullWidth:n=!1,className:l="",disabled:i,...c}=e,d=i||o?"opacity-50 cursor-not-allowed":"";return(0,t.jsxs)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-[var(--cor-acao)] text-white hover:brightness-90 focus:ring-[var(--cor-acao)]",secondary:"bg-[var(--cor-secundaria)] text-white hover:brightness-90 focus:ring-[var(--cor-secundaria)]",success:"bg-[var(--cor-sucesso)] text-white hover:brightness-90 focus:ring-[var(--cor-sucesso)]",danger:"bg-[var(--cor-erro)] text-white hover:brightness-90 focus:ring-[var(--cor-erro)]",outline:"bg-white text-[var(--cor-texto-principal)] border border-[var(--cor-borda)] hover:bg-gray-50 focus:ring-[var(--cor-acao)]"}[a]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[s]," ").concat(n?"w-full":""," ").concat(d," ").concat(l),disabled:i||o,...c,children:[o&&(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r]})}},32278:function(e,r,a){var t=a(3827);let s=(0,a(64090).forwardRef)((e,r)=>{let{label:a,error:s,helperText:o,className:n="",...l}=e;return(0,t.jsxs)("div",{className:"mb-4",children:[a&&(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--cor-texto-principal)"},children:a}),(0,t.jsx)("input",{ref:r,className:"w-full input ".concat(s?"border-[var(--cor-erro)]":""," ").concat(n),...l}),s&&(0,t.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-erro)"},children:s}),o&&!s&&(0,t.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--cor-texto-secundario)"},children:o})]})});s.displayName="Input",r.Z=s},70492:function(e,r,a){a.d(r,{d:function(){return o}});var t=a(3827),s=a(64090);let o=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],[r,a]=(0,s.useState)(e);return{isOpen:r,openModal:()=>a(!0),closeModal:()=>a(!1),toggleModal:()=>a(!r)}};r.Z=e=>{let{isOpen:r,onClose:a,title:o,children:n,footer:l,size:i="md"}=e,[c,d]=(0,s.useState)(!1);return((0,s.useEffect)(()=>(r?(d(!0),document.body.style.overflow="hidden"):(setTimeout(()=>{d(!1)},200),document.body.style.overflow="auto"),()=>{document.body.style.overflow="auto"}),[r]),c||r)?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 ".concat(r?"opacity-100":"opacity-0"," transition-opacity duration-200"),children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:a}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full ".concat({sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[i]," z-10 ").concat(r?"translate-y-0":"translate-y-4"," transition-transform duration-200"),children:[(0,t.jsxs)("div",{className:"flex justify-between items-center px-6 py-4 border-b",style:{borderColor:"var(--cor-borda)"},children:[(0,t.jsx)("h3",{className:"text-lg font-medium",style:{color:"var(--cor-texto-principal)"},children:o}),(0,t.jsxs)("button",{type:"button",className:"text-gray-400 hover:text-gray-500 focus:outline-none",onClick:a,children:[(0,t.jsx)("span",{className:"sr-only",children:"Fechar"}),(0,t.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,t.jsx)("div",{className:"px-6 py-4",children:n}),l&&(0,t.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-t flex justify-end space-x-3",style:{borderColor:"var(--cor-borda)"},children:l})]})]}):null}},20200:function(e,r,a){a.d(r,{SC:function(){return o},pj:function(){return n}});var t=a(3827),s=a(64090);let o=e=>{let{children:r,className:a="",...s}=e;return(0,t.jsx)("tr",{className:"odd:bg-gray-50 hover:bg-[var(--cor-secundaria)/10] hover:shadow-sm rounded-lg ".concat(a),...s,children:r})},n=e=>{let{children:r,className:a="",compact:s=!1}=e;return(0,t.jsx)("td",{className:"".concat(s?"px-2 py-2":"px-6 py-4"," text-sm ").concat(a),style:{color:"var(--cor-texto-secundario)"},children:r})};r.ZP=e=>{let{headers:r,children:a,className:o="",emptyMessage:n="Nenhum dado encontrado",isLoading:l=!1}=e;return(0,t.jsx)("div",{className:"w-full overflow-x-hidden rounded-lg border ".concat(o),style:{borderColor:"var(--cor-borda)"},children:(0,t.jsxs)("table",{className:"w-full table-fixed divide-y",style:{borderColor:"var(--cor-borda)"},children:[(0,t.jsx)("thead",{className:"bg-gray-100",children:(0,t.jsx)("tr",{children:r.map((e,r)=>(0,t.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--cor-texto-secundario)"},children:e},r))})}),(0,t.jsx)("tbody",{className:"bg-white divide-y",style:{borderColor:"var(--cor-borda)"},children:l?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:r.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:(0,t.jsxs)("div",{className:"flex justify-center items-center py-4",children:[(0,t.jsxs)("svg",{className:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,t.jsx)("span",{className:"ml-2",children:"Carregando..."})]})})}):s.Children.count(a)>0?a:(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:r.length,className:"px-6 py-4 text-center text-sm text-gray-500",children:n})})})]})})}},32355:function(e,r,a){a.d(r,{g:function(){return s}});let t=()=>localStorage.getItem("auth_token"),s=()=>{let e=t();return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}},14570:function(e,r,a){a.d(r,{G:function(){return l}});var t=a(64090),s=a(32355);let o=async()=>{try{console.log("\uD83D\uDCE1 Fazendo chamada para /api/auth/users...");let e=await fetch("/api/auth/users",{headers:(0,s.g)()});if(console.log("\uD83D\uDCE1 Response status: ".concat(e.status)),!e.ok){let r=await e.text();throw console.error("❌ Erro na API users: ".concat(e.status," - ").concat(r)),Error("Erro ao buscar usu\xe1rios: ".concat(e.status))}let r=await e.json();return console.log("✅ Usu\xe1rios da API: ".concat(r.length)),r.map(e=>({role:"viewer",...e}))}catch(e){return console.error("❌ Erro ao buscar usu\xe1rios da API:",e),[]}},n=e=>e.filter(e=>!e.oculto),l=()=>{let[e,r]=(0,t.useState)([]),[a,l]=(0,t.useState)(null),[i,c]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{try{c(!0),console.log("\uD83D\uDD0D Carregando usu\xe1rios...");let e=localStorage.getItem("auth_token"),a=localStorage.getItem("user_data");if(console.log("\uD83D\uDD10 Auth state:",{tokenExists:!!e,userDataExists:!!a}),e&&a&&"undefined"!==a){let e=JSON.parse(a);if(console.log("✅ Usu\xe1rio atual carregado:",e.email),l(e),"admin"===e.role){let e=await o();console.log("✅ Usu\xe1rios carregados:",(null==e?void 0:e.length)||0),r(e)}else console.log("\uD83D\uDC64 User is not admin, skipping users list"),r([])}else console.log("⚠️ No valid auth token or user data found"),l(null),r([])}catch(e){console.error("❌ Erro ao carregar usu\xe1rios:",e),r([]),l(null)}finally{c(!1)}})()},[]);let d=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{6,}$/.test(e),u=async a=>{if(e.some(e=>e.email===a.email)||!d(a.senha))return null;try{let t=await fetch("/api/auth/register",{method:"POST",headers:(0,s.g)(),body:JSON.stringify(a)}),o=await t.json();if(!t.ok)return console.error("Erro no registro:",o),null;let n=[...e,o];return r(n),o}catch(e){return console.error("Erro ao registrar usu\xe1rio:",e),null}},m=()=>{l(null),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")},h=async e=>{try{if(!(await fetch("/api/auth/users/".concat(e),{method:"DELETE",headers:(0,s.g)()})).ok)throw Error("Erro ao deletar usu\xe1rio");let t=await o();return r(n(t)),(null==a?void 0:a.id)===e&&m(),!0}catch(e){return console.error("Erro ao remover usu\xe1rio:",e),!1}},x=async(e,t)=>{try{if(!(await fetch("/api/auth/users/".concat(e,"/password"),{method:"PUT",headers:(0,s.g)(),body:JSON.stringify({novaSenha:t})})).ok)throw Error("Erro ao alterar senha");let i=await o();if(r(n(i)),(null==a?void 0:a.id)===e){let r=i.find(r=>r.id===e)||null;l(r)}return!0}catch(e){return console.error("Erro ao alterar senha:",e),!1}},p=async(e,t)=>{try{if((await o()).some(r=>r.email===t.email&&r.id!==e))return!1;if(!(await fetch("/api/auth/users/".concat(e),{method:"PUT",headers:(0,s.g)(),body:JSON.stringify(t)})).ok)throw Error("Erro ao editar usu\xe1rio");let i=await o();if(r(n(i)),(null==a?void 0:a.id)===e){let r=i.find(r=>r.id===e)||null;l(r),localStorage.setItem("user_data",JSON.stringify(r))}return!0}catch(e){return console.error("Erro ao editar usu\xe1rio:",e),!1}};return{usuarios:e,usuarioAtual:a,isLoading:i,registrarUsuario:u,login:async(e,a)=>{try{let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,senha:a})});if(!t.ok)return null;let{user:s,token:i}=await t.json();l(s),localStorage.setItem("auth_token",i),localStorage.setItem("user_data",JSON.stringify(s));let c=await o();if(!c.find(e=>e.id===s.id)){let e=[...c,s];r(n(e))}return s}catch(e){return null}},logout:m,removerUsuario:h,alterarSenha:x,editarUsuario:p}}}}]);
"use strict";(()=>{var e={};e.id=1585,e.ids=[1585],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},31320:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>g});var a={};t.r(a),t.d(a,{GET:()=>l});var s=t(95419),i=t(69108),n=t(99678),o=t(78070),u=t(69458),c=t(82002);async function l(e){try{if("phase-production-build"===process.env.NEXT_PHASE||!e.headers.get("host"))return o.Z.json({error:"Database not available during build"},{status:503});console.log("\uD83D\uDD10 Checking authentication for /api/auth/users"),await (0,c.MH)(e,["admin"]),console.log("✅ Authentication passed, fetching users");let r=(await (0,u.I7)()).map(e=>({id:e.id,nome:e.nome,email:e.email,role:e.role}));return console.log(`✅ Returning ${r.length} users`),o.Z.json(r)}catch(e){if(console.error("Users list error:",e),e instanceof Error){if("Authentication required"===e.message)return o.Z.json({error:"Token de autentica\xe7\xe3o necess\xe1rio"},{status:401});if("Insufficient permissions"===e.message)return o.Z.json({error:"Permiss\xf5es insuficientes"},{status:403})}return o.Z.json({error:"Erro interno do servidor"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/users/route",pathname:"/api/auth/users",filename:"route",bundlePath:"app/api/auth/users/route"},resolvedPagePath:"/workspaces/SistemaChef/src/app/api/auth/users/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:f,staticGenerationBailout:g}=d,w="/api/auth/users/route";function v(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},82002:(e,r,t)=>{t.d(r,{MH:()=>l,fT:()=>n,mk:()=>c});var a=t(46082),s=t.n(a),i=t(19631);let n=e=>s().sign(e,process.env.JWT_SECRET,{expiresIn:"24h"}),o=e=>s().verify(e,process.env.JWT_SECRET),u=async e=>{try{let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return null;let t=r.substring(7),a=o(t);return await i._.usuario.findUnique({where:{id:a.userId}})}catch(e){return null}},c=async e=>{let r=await u(e);if(!r)throw Error("Authentication required");return r},l=async(e,r)=>{let t=await c(e);if(!r.includes(t.role))throw Error("Insufficient permissions");return t}},19631:(e,r,t)=>{t.d(r,{_:()=>s});let a=require("@prisma/client"),s=globalThis.prisma??new a.PrismaClient},69458:(e,r,t)=>{t.d(r,{EO:()=>l,I7:()=>c,O5:()=>p,jZ:()=>u,mY:()=>d,nj:()=>n,rV:()=>o});var a=t(7529),s=t(19631);let i="rba1807@gmail.com",n=e=>a.ZP.hashSync(e,10),o=(e,r)=>a.ZP.compareSync(e,r),u=async()=>{"phase-production-build"!==process.env.NEXT_PHASE&&(await s._.usuario.findUnique({where:{email:i}})||await s._.usuario.create({data:{nome:"Admin",email:i,senhaHash:n("Rb180780@"),role:"admin",oculto:!0}}))},c=async()=>(await u(),await s._.usuario.findMany()),l=async e=>await s._.usuario.create({data:e}),d=async e=>(await u(),await s._.usuario.findUnique({where:{email:e}})),p=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/.test(e)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[1638,6206,6082,7529],()=>t(31320));module.exports=a})();
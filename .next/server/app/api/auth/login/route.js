"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},25735:(e,r,a)=>{a.r(r),a.d(r,{headerHooks:()=>f,originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>w});var t={};a.r(t),a.d(t,{POST:()=>d});var i=a(95419),n=a(69108),o=a(99678),s=a(78070),u=a(69458),l=a(82002);async function d(e){try{if("phase-production-build"===process.env.NEXT_PHASE)return s.Z.json({error:"Database not available during build"},{status:503});await (0,u.jZ)();let{email:r,senha:a}=await e.json(),t=await (0,u.mY)(r);if(!t||!(0,u.rV)(a,t.senhaHash))return s.Z.json({error:"Credenciais inv\xe1lidas"},{status:401});let i=(0,l.fT)({userId:t.id,email:t.email,role:t.role});return s.Z.json({user:{id:t.id,nome:t.nome,email:t.email,role:t.role},token:i})}catch(e){return console.error("Login error:",e),s.Z.json({error:"Erro interno do servidor"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/workspaces/SistemaChef/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:f,staticGenerationBailout:w}=c,g="/api/auth/login/route";function v(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},82002:(e,r,a)=>{a.d(r,{MH:()=>d,fT:()=>o,mk:()=>l});var t=a(46082),i=a.n(t),n=a(19631);let o=e=>i().sign(e,process.env.JWT_SECRET,{expiresIn:"24h"}),s=e=>i().verify(e,process.env.JWT_SECRET),u=async e=>{try{let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return null;let a=r.substring(7),t=s(a);return await n._.usuario.findUnique({where:{id:t.userId}})}catch(e){return null}},l=async e=>{let r=await u(e);if(!r)throw Error("Authentication required");return r},d=async(e,r)=>{let a=await l(e);if(!r.includes(a.role))throw Error("Insufficient permissions");return a}},19631:(e,r,a)=>{a.d(r,{_:()=>i});let t=require("@prisma/client"),i=globalThis.prisma??new t.PrismaClient},69458:(e,r,a)=>{a.d(r,{EO:()=>d,I7:()=>l,O5:()=>p,jZ:()=>u,mY:()=>c,nj:()=>o,rV:()=>s});var t=a(7529),i=a(19631);let n="rba1807@gmail.com",o=e=>t.ZP.hashSync(e,10),s=(e,r)=>t.ZP.compareSync(e,r),u=async()=>{"phase-production-build"!==process.env.NEXT_PHASE&&(await i._.usuario.findUnique({where:{email:n}})||await i._.usuario.create({data:{nome:"Admin",email:n,senhaHash:o("Rb180780@"),role:"admin",oculto:!0}}))},l=async()=>(await u(),await i._.usuario.findMany()),d=async e=>await i._.usuario.create({data:e}),c=async e=>(await u(),await i._.usuario.findUnique({where:{email:e}})),p=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/.test(e)}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[1638,6206,6082,7529],()=>a(25735));module.exports=t})();
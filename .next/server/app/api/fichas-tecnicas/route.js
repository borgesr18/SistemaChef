(()=>{var e={};e.id=6002,e.ids=[6002],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},33558:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>f});var i={};r.r(i),r.d(i,{GET:()=>c,POST:()=>l});var o=r(95419),n=r(69108),s=r(99678),a=r(78070),u=r(19631),d=r(82002);async function c(e){try{if("phase-production-build"===process.env.NEXT_PHASE)return a.Z.json({error:"Database not available during build"},{status:503});let t=await (0,d.requireAuth)(e),r=await u._.fichaTecnica.findMany({where:{userId:t.id},include:{ingredientes:{include:{produto:!0}}},orderBy:{nome:"asc"}});return a.Z.json(r)}catch(e){if(console.error("Get fichas t\xe9cnicas error:",e),e instanceof Error&&"Authentication required"===e.message)return a.Z.json({error:"Autentica\xe7\xe3o necess\xe1ria"},{status:401});return a.Z.json({error:"Erro interno do servidor"},{status:500})}}async function l(e){try{if("phase-production-build"===process.env.NEXT_PHASE)return a.Z.json({error:"Database not available during build"},{status:503});let t=await (0,d.requireAuth)(e),r=await e.json(),i=0,o=[];if(console.log("\uD83E\uDDEE Calculating costs for ingredients:",r.ingredientes?.length||0),r.ingredientes&&r.ingredientes.length>0)for(let e of r.ingredientes){let t=await u._.produto.findUnique({where:{id:e.produtoId}});if(t){let r=0,n=Number(e.quantidade)||0,s=Number(t.preco)||0;console.log(`ðŸ’° Produto: ${t.nome}, Quantidade: ${n}, Pre\xe7o: ${s}, Unidade: ${e.unidade}`),s>0&&n>0&&("kg"===e.unidade||"Quilograma"===e.unidade?r=n*s:"g"===e.unidade||"Grama"===e.unidade?r=n/1e3*s:"l"===e.unidade||"Litro"===e.unidade?r=n*s:"ml"===e.unidade||"Mililitro"===e.unidade?r=n/1e3*s:("unidade"===e.unidade||"Unidade"===e.unidade||e.unidade,r=n*s)),console.log(`ðŸ’µ Custo calculado para ${t.nome}: R$ ${r.toFixed(2)}`),i+=r,o.push({produtoId:e.produtoId,quantidade:e.quantidade,unidade:e.unidade,custo:r})}else console.log(`âŒ Produto n\xe3o encontrado: ${e.produtoId}`),o.push({produtoId:e.produtoId,quantidade:e.quantidade,unidade:e.unidade,custo:0})}console.log(`ðŸŽ¯ Custo total calculado: R$ ${i.toFixed(2)}`);let n=r.rendimentoTotal&&r.rendimentoTotal>0?i/r.rendimentoTotal:0,s=await u._.fichaTecnica.create({data:{nome:r.nome,descricao:r.descricao,categoria:r.categoria,modoPreparo:r.modoPreparo,tempoPreparo:r.tempoPreparo.toString(),rendimentoTotal:r.rendimentoTotal,unidadeRendimento:r.unidadeRendimento,custoTotal:i,custoPorcao:n,observacoes:r.observacoes,userId:t.id,ingredientes:{create:o}},include:{ingredientes:{include:{produto:!0}}}});return a.Z.json(s)}catch(e){if(console.error("Create ficha t\xe9cnica error:",e),e instanceof Error&&"Authentication required"===e.message)return a.Z.json({error:"Autentica\xe7\xe3o necess\xe1ria"},{status:401});return a.Z.json({error:"Erro interno do servidor"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/fichas-tecnicas/route",pathname:"/api/fichas-tecnicas",filename:"route",bundlePath:"app/api/fichas-tecnicas/route"},resolvedPagePath:"/workspaces/SistemaChef/src/app/api/fichas-tecnicas/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:h,headerHooks:x,staticGenerationBailout:f}=p,q="/api/fichas-tecnicas/route";function v(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},82002:(e,t,r)=>{"use strict";r(57699),r(7439),r(867)},19631:(e,t,r)=>{"use strict";r.d(t,{_:()=>o});let i=require("@prisma/client"),o=globalThis.prisma??new i.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[1638,6206,1971,7439,7699,867],()=>r(33558));module.exports=i})();